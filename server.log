2025-09-20 13:26:59 [info     ] ‚úÖ MarketDataCoordinator initialized with enterprise features
2025-09-20 13:26:59 [info     ] üö® Emergency Manager initialized with institutional protocols
2025-09-20 13:27:00 [warning  ] Supabase not configured - using mock mode
2025-09-20 13:27:02 [info     ] ChatAI Service initialized     model=gpt-4 temperature=0.7 timeout=30
2025-09-20 13:27:02 [info     ] ‚úÖ Dynamic Exchange Discovery initialized
2025-09-20 13:27:02 [info     ] üß† UNIFIED CHAT SERVICE INITIALIZED - All features preserved
2025-09-20 13:27:02 [info     ] ‚úÖ Enhanced chat engine initialized
2025-09-20 13:27:02 [info     ] üß† UNIFIED AI MONEY MANAGER INITIALIZING
2025-09-20 13:27:02 [info     ] üß† Unified AI brain connected to all interfaces
2025-09-20 13:27:02 [info     ] üí∞ API Cost Tracker initialized with enterprise monitoring
2025-09-20 13:27:02 [info     ] ab_testing.production_mode_enabled message=A/B Testing running in PRODUCTION MODE with Redis-backed storage for multi-worker safety
2025-09-20 13:27:02 [info     ] ab_testing.production_mode     message=Production mode enabled - database-backed storage required
[2m2025-09-20T07:57:03.043833Z[0m [[32m[1minfo     [0m] [1mCORS origins configured: ['http://localhost:3000', 'http://localhost:5173', 'https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000', 'http://127.0.0.1:3000', 'http://127.0.0.1:8000'][0m [[34m[1m__main__[0m] 
[2m2025-09-20T07:57:03.044142Z[0m [[32m[1minfo     [0m] [1mFrontend URL: https://cryptouniverse-frontend.onrender.com[0m [[34m[1m__main__[0m] 
[2m2025-09-20T07:57:03.044604Z[0m [[32m[1minfo     [0m] [1mBase URL: http://localhost:8000[0m [[34m[1m__main__[0m] 
[2m2025-09-20T07:57:03.044919Z[0m [[32m[1minfo     [0m] [1mEnvironment: development      [0m [[34m[1m__main__[0m] 
[2m2025-09-20T07:57:03.045140Z[0m [[32m[1minfo     [0m] [1mFinal CORS origins being used: ['https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000'][0m [[34m[1m__main__[0m] 
[2m2025-09-20T07:57:03.373005Z[0m [[32m[1minfo     [0m] [1müöÄ Starting CryptoUniverse Enterprise in development mode...[0m [[34m[1m__main__[0m] 
INFO:     Will watch for changes in these directories: ['/home/kopi/CryptoUniverse-fresh/app']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [215357] using WatchFiles
2025-09-20 13:27:05 [info     ] ‚úÖ MarketDataCoordinator initialized with enterprise features
2025-09-20 13:27:05 [info     ] üö® Emergency Manager initialized with institutional protocols
1 change detected
2025-09-20 13:27:06 [warning  ] Supabase not configured - using mock mode
2025-09-20 13:27:06 [info     ] ChatAI Service initialized     model=gpt-4 temperature=0.7 timeout=30
2025-09-20 13:27:06 [info     ] ‚úÖ Dynamic Exchange Discovery initialized
2025-09-20 13:27:06 [info     ] üß† UNIFIED CHAT SERVICE INITIALIZED - All features preserved
2025-09-20 13:27:07 [info     ] ‚úÖ Enhanced chat engine initialized
2025-09-20 13:27:07 [info     ] üß† UNIFIED AI MONEY MANAGER INITIALIZING
2025-09-20 13:27:07 [info     ] üß† Unified AI brain connected to all interfaces
2025-09-20 13:27:07 [info     ] üí∞ API Cost Tracker initialized with enterprise monitoring
1 change detected
2025-09-20 13:27:07 [info     ] ab_testing.production_mode_enabled message=A/B Testing running in PRODUCTION MODE with Redis-backed storage for multi-worker safety
2025-09-20 13:27:07 [info     ] ab_testing.production_mode     message=Production mode enabled - database-backed storage required
[2m2025-09-20T07:57:07.856742Z[0m [[32m[1minfo     [0m] [1mCORS origins configured: ['http://localhost:3000', 'http://localhost:5173', 'https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000', 'http://127.0.0.1:3000', 'http://127.0.0.1:8000'][0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:57:07.857001Z[0m [[32m[1minfo     [0m] [1mFrontend URL: https://cryptouniverse-frontend.onrender.com[0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:57:07.857102Z[0m [[32m[1minfo     [0m] [1mBase URL: http://localhost:8000[0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:57:07.857184Z[0m [[32m[1minfo     [0m] [1mEnvironment: development      [0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:57:07.857264Z[0m [[32m[1minfo     [0m] [1mFinal CORS origins being used: ['https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000'][0m [[34m[1m__mp_main__[0m] 
1 change detected
[2m2025-09-20T07:57:08.472681Z[0m [[32m[1minfo     [0m] [1mCORS origins configured: ['http://localhost:3000', 'http://localhost:5173', 'https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000', 'http://127.0.0.1:3000', 'http://127.0.0.1:8000'][0m [[34m[1mmain[0m] 
[2m2025-09-20T07:57:08.472857Z[0m [[32m[1minfo     [0m] [1mFrontend URL: https://cryptouniverse-frontend.onrender.com[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:57:08.472960Z[0m [[32m[1minfo     [0m] [1mBase URL: http://localhost:8000[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:57:08.473039Z[0m [[32m[1minfo     [0m] [1mEnvironment: development      [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:57:08.473113Z[0m [[32m[1minfo     [0m] [1mFinal CORS origins being used: ['https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000'][0m [[34m[1mmain[0m] 
INFO:     Started server process [215403]
INFO:     Waiting for application startup.
[2m2025-09-20T07:57:08.940890Z[0m [[32m[1minfo     [0m] [1müöÄ CryptoUniverse Enterprise starting up...[0m [[34m[1mmain[0m] [36menvironment[0m=[35mdevelopment[0m [36mis_primary[0m=[35mTrue[0m [36mversion[0m=[35m2.0.0[0m [36mworker_id[0m=[35m215403[0m
[2m2025-09-20T07:57:08.941434Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database connected          [0m [[34m[1mmain[0m] 
1 change detected
1 change detected
[2m2025-09-20T07:57:10.717709Z[0m [[32m[1minfo     [0m] [1mRedis connection pool created with enterprise settings[0m [[34m[1mapp.core.redis[0m] [36murl[0m=[35mredis://localhost:63...[0m
[2m2025-09-20T07:57:10.718087Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T07:57:10.718212Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è Redis connection failed - running in degraded mode[0m [[34m[1mmain[0m] [36merror[0m=[35m'NoneType' object has no attribute 'ping'[0m
[2m2025-09-20T07:57:10.718361Z[0m [[32m[1minfo     [0m] [1müöÄ Starting essential background services...[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:10.718517Z[0m [[32m[1minfo     [0m] [1müîß Initializing Enterprise Redis Manager...[0m [[34m[1mEnterpriseRedisManager[0m] 
[2m2025-09-20T07:57:10.718680Z[0m [[32m[1minfo     [0m] [1müîó Redis connection pool configured[0m [[34m[1mEnterpriseRedisManager[0m] [36mmax_connections[0m=[35m20[0m
[2m2025-09-20T07:57:10.720132Z[0m [[31m[1merror    [0m] [1m‚ùå Failed to initialize Redis Manager[0m [[34m[1mEnterpriseRedisManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:57:10.720394Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis client initialized through enterprise manager[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:10.720627Z[0m [[32m[1minfo     [0m] [1müöÄ health_monitor service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:10.720815Z[0m [[32m[1minfo     [0m] [1müöÄ rate_limit_cleanup service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:10.720964Z[0m [[32m[1minfo     [0m] [1m‚úÖ Essential background services started[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:57:10.721112Z[0m [[32m[1minfo     [0m] [1müìÖ Heavy services scheduled for deferred startup[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:57:10.721308Z[0m [[32m[1minfo     [0m] [1müìä System monitoring scheduled for delayed startup[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:57:10.721454Z[0m [[32m[1minfo     [0m] [1müéâ CryptoUniverse Enterprise is ready![0m [[34m[1mmain[0m] [36mapi_docs[0m=[35mhttp://localhost:8000/api/docs[0m
[2m2025-09-20T07:57:10.721687Z[0m [[32m[1minfo     [0m] [1m‚úÖ health_monitor service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:10.721873Z[0m [[32m[1minfo     [0m] [1müè• Health monitor service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:10.722676Z[0m [[32m[1minfo     [0m] [1m‚úÖ rate_limit_cleanup service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:10.722832Z[0m [[32m[1minfo     [0m] [1müö¶ Rate limit cleanup service started[0m [[34m[1mBackgroundServiceManager[0m] 
INFO:     Application startup complete.
[2m2025-09-20T07:57:10.725095Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T07:57:10.725646Z[0m [[31m[1merror    [0m] [1mFailed to initialize Redis connection pool[0m [[34m[1mapp.core.redis_pool[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m [36mtype[0m=[35mConnectionError[0m
[2m2025-09-20T07:57:10.725870Z[0m [[33m[1mwarning  [0m] [1mRate limiter initialized WITHOUT Redis - will fail open[0m [[34m[1mapp.services.rate_limit[0m] 
[2m2025-09-20T07:57:10.726248Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
INFO:     127.0.0.1:55268 - "GET / HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:43126 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:43134 - "GET /api/v1/market/symbols HTTP/1.1" 401 Unauthorized
1 change detected
INFO:     127.0.0.1:43144 - "GET /health HTTP/1.1" 200 OK
[2m2025-09-20T07:57:29.336783Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/auth/login[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mfdbd0c05[0m [36muser_agent[0m=[35mpython-requests/2.32.5[0m
[2m2025-09-20T07:57:29.351502Z[0m [[32m[1minfo     [0m] [1mLogin attempt                 [0m [[34m[1mapp.api.v1.endpoints.auth[0m] [36memail[0m=[35madmin@cryptouniverse.com[0m [36mip[0m=[35m127.0.0.1[0m
1 change detected
[2m2025-09-20T07:57:30.424793Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.39214611053466797[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:57:30.814385Z[0m [[31m[1merror    [0m] [1mUnexpected login error        [0m [[34m[1mapp.api.v1.endpoints.auth[0m] [36merror[0m=[35mlocal variable 'datetime' referenced before assignment[0m [36merror_type[0m=[35mUnboundLocalError[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/auth.py", line 361, in login
    current_time = datetime.utcnow()
UnboundLocalError: local variable 'datetime' referenced before assignment
[2m2025-09-20T07:57:30.863280Z[0m [[31m[1merror    [0m] [1mDatabase operation failed     [0m [[34m[1mapp.core.database[0m] [36merror[0m=[35m500[0m
[2m2025-09-20T07:57:30.864199Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mAuthentication service error: local variable 'datetime' referenced before assignment[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/auth/login[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T07:57:30.864694Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/auth/login[0m [36mprocess_time[0m=[35m1.528s[0m [36mrequest_id[0m=[35mfdbd0c05[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:43152 - "POST /api/v1/auth/login HTTP/1.1" 500 Internal Server Error
1 change detected
1 change detected
[2m2025-09-20T07:57:40.724464Z[0m [[32m[1minfo     [0m] [1müöÄ Starting deferred background services...[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:40.724971Z[0m [[32m[1minfo     [0m] [1müöÄ metrics_collector service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:40.725331Z[0m [[32m[1minfo     [0m] [1m‚úÖ metrics_collector service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:40.725606Z[0m [[32m[1minfo     [0m] [1müìä Metrics collector service started[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
[2m2025-09-20T07:57:40.828072Z[0m [[31m[1merror    [0m] [1mMetrics collector error       [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:57:42.725193Z[0m [[32m[1minfo     [0m] [1müöÄ cleanup_service service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:42.725541Z[0m [[32m[1minfo     [0m] [1m‚úÖ cleanup_service service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:42.725674Z[0m [[32m[1minfo     [0m] [1müßπ Cleanup service started     [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:42.726590Z[0m [[31m[1merror    [0m] [1mRedis cleanup failed          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:57:42.726833Z[0m [[32m[1minfo     [0m] [1m‚úÖ Cleanup cycle completed     [0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
1 change detected
[2m2025-09-20T07:57:44.725899Z[0m [[32m[1minfo     [0m] [1müöÄ autonomous_cycles service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:44.726169Z[0m [[32m[1minfo     [0m] [1m‚úÖ autonomous_cycles service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:44.726299Z[0m [[32m[1minfo     [0m] [1mü§ñ Autonomous cycles service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:44.727124Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
[2m2025-09-20T07:57:46.726165Z[0m [[32m[1minfo     [0m] [1müöÄ market_data_sync service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:46.726465Z[0m [[32m[1minfo     [0m] [1m‚úÖ market_data_sync service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:46.726624Z[0m [[32m[1minfo     [0m] [1müìà Market data sync service started[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
1 change detected
[2m2025-09-20T07:57:48.429803Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T07:57:48.726918Z[0m [[32m[1minfo     [0m] [1müöÄ balance_sync service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:48.727346Z[0m [[32m[1minfo     [0m] [1m‚úÖ balance_sync service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:48.727528Z[0m [[32m[1minfo     [0m] [1müí∞ Balance sync service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:48.728490Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T07:57:49.219216Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T07:57:49.324131Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2501227855682373[0m [36mstatement[0m=[35mSELECT DISTINCT exchange_accounts.user_id 
FROM exchange_accounts 
WHERE exchange_accounts.status = $1::exchangestatus AND exchange_accounts.trading_enabled = true[0m
[2m2025-09-20T07:57:49.606513Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:57:49.993025Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.373302698135376[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:57:50.007567Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:57:50.008080Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T07:57:50.273725Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24919819831848145[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:57:50.444332Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4185488224029541[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:57:50.575943Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_c0b0e116[0m
[2m2025-09-20T07:57:50.576195Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_f019ec58[0m
[2m2025-09-20T07:57:50.576333Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_e2ab119f[0m
[2m2025-09-20T07:57:50.727702Z[0m [[32m[1minfo     [0m] [1müöÄ risk_monitor service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:50.728263Z[0m [[32m[1minfo     [0m] [1m‚úÖ risk_monitor service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:50.728397Z[0m [[32m[1minfo     [0m] [1m‚ö†Ô∏è Risk monitor service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:57:50.931702Z[0m [[32m[1minfo     [0m] [1mKraken server time synced     [0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36moffset[0m=[35m0.4237024784088135[0m
[2m2025-09-20T07:57:50.934251Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355071357[0m [36mfallback_uses[0m=[35m1[0m [36mlocal_count[0m=[35m1[0m [36mnode_hash[0m=[35m13[0m [36mnonce[0m=[35m1758355071371[0m
1 change detected
[2m2025-09-20T07:57:51.003676Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m994.7710037231445[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2284.1499999999996[0m
[2m2025-09-20T07:57:51.289419Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:57:51.685097Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1676.0344505310059[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1766.39[0m
[2m2025-09-20T07:57:51.814217Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T07:57:52.000373Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:57:52.001727Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5274.8823165893555[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T07:57:52.740576Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T07:57:53.494364Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T07:57:53.891095Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T07:57:55.025503Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:57:55.026064Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m5016.927003860474[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T07:57:55.026498Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m5018.423795700073[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m5420.032978057861[0m [36mtotal_value_usd[0m=[35m4050.54[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:57:55.028476Z[0m [[33m[1mwarning  [0m] [1mBalance sync failed for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T07:57:55.724445Z[0m [[32m[1minfo     [0m] [1mSystem monitoring started     [0m [[34m[1mapp.services.system_monitoring[0m] [36minterval_seconds[0m=[35m120[0m
[2m2025-09-20T07:57:55.724758Z[0m [[32m[1minfo     [0m] [1m‚úÖ System monitoring started (delayed)[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:57:56.122580Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
/home/kopi/CryptoUniverse-fresh/app/services/market_data_feeds.py:313: RuntimeWarning: coroutine 'MarketDataFeeds._handle_api_failure' was never awaited
  self._handle_api_failure(api_name, str(e))
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
[2m2025-09-20T07:57:56.124608Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T07:57:56.124847Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T07:57:56.125008Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
[2m2025-09-20T07:57:57.094295Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T07:57:57.266030Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:57:57.267467Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5265.35701751709[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T07:57:58.984072Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T07:57:59.247972Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T07:58:01.595067Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T07:58:01.847153Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:58:01.848171Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4579.934597015381[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T07:58:03.426087Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
3 changes detected
WARNING:  WatchFiles detected changes in 'app/api/v1/endpoints/auth.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
[2m2025-09-20T07:58:03.655694Z[0m [[32m[1minfo     [0m] [1müîÑ CryptoUniverse Enterprise shutting down...[0m [[34m[1mmain[0m] [36mworker_id[0m=[35m215403[0m
[2m2025-09-20T07:58:03.656070Z[0m [[32m[1minfo     [0m] [1mSystem monitoring stopped     [0m [[34m[1mapp.services.system_monitoring[0m] 
[2m2025-09-20T07:58:03.656266Z[0m [[32m[1minfo     [0m] [1müìä System monitoring stopped   [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:03.656516Z[0m [[32m[1minfo     [0m] [1müîÑ Stopping background services...[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.656754Z[0m [[32m[1minfo     [0m] [1m‚úÖ health_monitor stopped      [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.656972Z[0m [[32m[1minfo     [0m] [1m‚úÖ rate_limit_cleanup stopped  [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.657171Z[0m [[32m[1minfo     [0m] [1m‚úÖ metrics_collector stopped   [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.657367Z[0m [[32m[1minfo     [0m] [1m‚úÖ cleanup_service stopped     [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.657553Z[0m [[32m[1minfo     [0m] [1m‚úÖ autonomous_cycles stopped   [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.658432Z[0m [[32m[1minfo     [0m] [1m‚úÖ market_data_sync stopped    [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.658717Z[0m [[32m[1minfo     [0m] [1m‚úÖ balance_sync stopped        [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.658946Z[0m [[32m[1minfo     [0m] [1m‚úÖ risk_monitor stopped        [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.666025Z[0m [[32m[1minfo     [0m] [1m‚úÖ All background services stopped[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:03.666417Z[0m [[32m[1minfo     [0m] [1m‚úÖ Background services stopped [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:03.666613Z[0m [[32m[1minfo     [0m] [1müß† AI Manager was not started - no shutdown needed[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:03.715380Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database disconnected       [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:03.716105Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis disconnected          [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:03.716360Z[0m [[32m[1minfo     [0m] [1müëã Shutdown complete in 0.06s  [0m [[34m[1mmain[0m] 
INFO:     Application shutdown complete.
INFO:     Finished server process [215403]
1 change detected
1 change detected
3 changes detected
2025-09-20 13:28:07 [info     ] ‚úÖ MarketDataCoordinator initialized with enterprise features
2025-09-20 13:28:07 [info     ] üö® Emergency Manager initialized with institutional protocols
2025-09-20 13:28:07 [warning  ] Supabase not configured - using mock mode
1 change detected
2025-09-20 13:28:08 [info     ] ChatAI Service initialized     model=gpt-4 temperature=0.7 timeout=30
2025-09-20 13:28:08 [info     ] ‚úÖ Dynamic Exchange Discovery initialized
2025-09-20 13:28:08 [info     ] üß† UNIFIED CHAT SERVICE INITIALIZED - All features preserved
2025-09-20 13:28:08 [info     ] ‚úÖ Enhanced chat engine initialized
2025-09-20 13:28:08 [info     ] üß† UNIFIED AI MONEY MANAGER INITIALIZING
2025-09-20 13:28:08 [info     ] üß† Unified AI brain connected to all interfaces
2025-09-20 13:28:08 [info     ] üí∞ API Cost Tracker initialized with enterprise monitoring
2025-09-20 13:28:08 [info     ] ab_testing.production_mode_enabled message=A/B Testing running in PRODUCTION MODE with Redis-backed storage for multi-worker safety
2025-09-20 13:28:08 [info     ] ab_testing.production_mode     message=Production mode enabled - database-backed storage required
1 change detected
[2m2025-09-20T07:58:09.177917Z[0m [[32m[1minfo     [0m] [1mCORS origins configured: ['http://localhost:3000', 'http://localhost:5173', 'https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000', 'http://127.0.0.1:3000', 'http://127.0.0.1:8000'][0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:09.178339Z[0m [[32m[1minfo     [0m] [1mFrontend URL: https://cryptouniverse-frontend.onrender.com[0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:09.178466Z[0m [[32m[1minfo     [0m] [1mBase URL: http://localhost:8000[0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:09.178554Z[0m [[32m[1minfo     [0m] [1mEnvironment: development      [0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:09.178641Z[0m [[32m[1minfo     [0m] [1mFinal CORS origins being used: ['https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000'][0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:09.628018Z[0m [[32m[1minfo     [0m] [1mCORS origins configured: ['http://localhost:3000', 'http://localhost:5173', 'https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000', 'http://127.0.0.1:3000', 'http://127.0.0.1:8000'][0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:09.628352Z[0m [[32m[1minfo     [0m] [1mFrontend URL: https://cryptouniverse-frontend.onrender.com[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:09.628551Z[0m [[32m[1minfo     [0m] [1mBase URL: http://localhost:8000[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:09.628707Z[0m [[32m[1minfo     [0m] [1mEnvironment: development      [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:09.628813Z[0m [[32m[1minfo     [0m] [1mFinal CORS origins being used: ['https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000'][0m [[34m[1mmain[0m] 
1 change detected
INFO:     Started server process [215816]
INFO:     Waiting for application startup.
[2m2025-09-20T07:58:09.990935Z[0m [[32m[1minfo     [0m] [1müöÄ CryptoUniverse Enterprise starting up...[0m [[34m[1mmain[0m] [36menvironment[0m=[35mdevelopment[0m [36mis_primary[0m=[35mTrue[0m [36mversion[0m=[35m2.0.0[0m [36mworker_id[0m=[35m215816[0m
[2m2025-09-20T07:58:09.991096Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database connected          [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:12.062361Z[0m [[32m[1minfo     [0m] [1mRedis connection pool created with enterprise settings[0m [[34m[1mapp.core.redis[0m] [36murl[0m=[35mredis://localhost:63...[0m
[2m2025-09-20T07:58:12.063154Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T07:58:12.063488Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è Redis connection failed - running in degraded mode[0m [[34m[1mmain[0m] [36merror[0m=[35m'NoneType' object has no attribute 'ping'[0m
[2m2025-09-20T07:58:12.064143Z[0m [[32m[1minfo     [0m] [1müöÄ Starting essential background services...[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:12.064737Z[0m [[32m[1minfo     [0m] [1müîß Initializing Enterprise Redis Manager...[0m [[34m[1mEnterpriseRedisManager[0m] 
[2m2025-09-20T07:58:12.065215Z[0m [[32m[1minfo     [0m] [1müîó Redis connection pool configured[0m [[34m[1mEnterpriseRedisManager[0m] [36mmax_connections[0m=[35m20[0m
[2m2025-09-20T07:58:12.067807Z[0m [[31m[1merror    [0m] [1m‚ùå Failed to initialize Redis Manager[0m [[34m[1mEnterpriseRedisManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:58:12.068230Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis client initialized through enterprise manager[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:12.068540Z[0m [[32m[1minfo     [0m] [1müöÄ health_monitor service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:12.068831Z[0m [[32m[1minfo     [0m] [1müöÄ rate_limit_cleanup service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:12.069034Z[0m [[32m[1minfo     [0m] [1m‚úÖ Essential background services started[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:12.069229Z[0m [[32m[1minfo     [0m] [1müìÖ Heavy services scheduled for deferred startup[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:12.069415Z[0m [[32m[1minfo     [0m] [1müìä System monitoring scheduled for delayed startup[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:12.069566Z[0m [[32m[1minfo     [0m] [1müéâ CryptoUniverse Enterprise is ready![0m [[34m[1mmain[0m] [36mapi_docs[0m=[35mhttp://localhost:8000/api/docs[0m
[2m2025-09-20T07:58:12.069817Z[0m [[32m[1minfo     [0m] [1m‚úÖ health_monitor service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:12.070006Z[0m [[32m[1minfo     [0m] [1müè• Health monitor service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:12.070834Z[0m [[32m[1minfo     [0m] [1m‚úÖ rate_limit_cleanup service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:12.071039Z[0m [[32m[1minfo     [0m] [1müö¶ Rate limit cleanup service started[0m [[34m[1mBackgroundServiceManager[0m] 
INFO:     Application startup complete.
[2m2025-09-20T07:58:12.087068Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T07:58:12.088701Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/auth/login[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mf0c77029[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:58:12.089554Z[0m [[31m[1merror    [0m] [1mFailed to initialize Redis connection pool[0m [[34m[1mapp.core.redis_pool[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m [36mtype[0m=[35mConnectionError[0m
[2m2025-09-20T07:58:12.089874Z[0m [[33m[1mwarning  [0m] [1mRate limiter initialized WITHOUT Redis - will fail open[0m [[34m[1mapp.services.rate_limit[0m] 
[2m2025-09-20T07:58:12.091869Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:58:12.121645Z[0m [[32m[1minfo     [0m] [1mLogin attempt                 [0m [[34m[1mapp.api.v1.endpoints.auth[0m] [36memail[0m=[35madmin@cryptouniverse.com[0m [36mip[0m=[35m127.0.0.1[0m
1 change detected
[2m2025-09-20T07:58:13.114511Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.30382609367370605[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
1 change detected
[2m2025-09-20T07:58:13.795578Z[0m [[32m[1minfo     [0m] [1mLogin successful              [0m [[34m[1mapp.api.v1.endpoints.auth[0m] [36memail[0m=[35madmin@cryptouniverse.com[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:13.797143Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/auth/login[0m [36mprocess_time[0m=[35m1.708s[0m [36mrequest_id[0m=[35mf0c77029[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:49428 - "POST /api/v1/auth/login HTTP/1.1" 200 OK
[2m2025-09-20T07:58:14.086350Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     ('127.0.0.1', 35930) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
[2m2025-09-20T07:58:14.487459Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:14.493002Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:14.507309Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m7657ae9a[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:58:14.512255Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:14.522332Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     ('127.0.0.1', 35970) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
[2m2025-09-20T07:58:14.525642Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m65eeb9a6[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
INFO:     connection open
[2m2025-09-20T07:58:14.530310Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:14.598681Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21321702003479004[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
1 change detected
[2m2025-09-20T07:58:15.003984Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.22011566162109375[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
INFO:     127.0.0.1:49428 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T07:58:15.173058Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:15.935283Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3051271438598633[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:15.936659Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35md025cd06-4658-4250-903c-f5c047cf50a8[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:15.939295Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m1.432s[0m [36mrequest_id[0m=[35m7657ae9a[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:35956 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T07:58:16.004729Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.32631611824035645[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:16.005861Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:35956 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T07:58:16.042951Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:16.110859Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:16.111492Z[0m [[31m[1merror    [0m] [1mFailed to load dynamic pricing config[0m [[34m[1mProfitSharingService[0m] [36merror[0m=[35m'NoneType' object has no attribute 'hset'[0m
[2m2025-09-20T07:58:16.111876Z[0m [[31m[1merror    [0m] [1mFailed to load strategy pricing[0m [[34m[1mProfitSharingService[0m] [36merror[0m=[35m'NoneType' object has no attribute 'hset'[0m
[2m2025-09-20T07:58:16.125479Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3839683532714844[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:16.130368Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable - operating in degraded mode[0m [[34m[1mMasterSystemController[0m] 
INFO:     127.0.0.1:35958 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T07:58:16.181083Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3904850482940674[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:16.183334Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:16.204866Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m6694930b[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:58:16.205743Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m6694930b[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:16.211568Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:35958 - "OPTIONS /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
INFO:     127.0.0.1:35938 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
INFO:     127.0.0.1:35958 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T07:58:16.300468Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:16.312458Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:16.430660Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.23284411430358887[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:16.435517Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:16.436056Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:16.453071Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.47208571434020996[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:16.454171Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35md534dead-856d-47b2-ad16-ae574d9929a1[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:16.455462Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m1.930s[0m [36mrequest_id[0m=[35m65eeb9a6[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:35962 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
3 changes detected
WARNING:  WatchFiles detected changes in 'app/api/v1/endpoints/auth.py'. Reloading...
[2m2025-09-20T07:58:16.748607Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24645042419433594[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
INFO:     Shutting down
[2m2025-09-20T07:58:16.758438Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
[2m2025-09-20T07:58:16.758961Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
INFO:     connection closed
[2m2025-09-20T07:58:16.805662Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.30007457733154297[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:16.808254Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.36855149269104004[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
INFO:     Waiting for connections to close. (CTRL+C to force quit)
INFO:     127.0.0.1:35938 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T07:58:17.096159Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.5552010536193848[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:17.102473Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.6618549823760986[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:17.338854Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_2053f084[0m
[2m2025-09-20T07:58:17.339263Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_23476c12[0m
[2m2025-09-20T07:58:17.339535Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_2d874ff1[0m
[2m2025-09-20T07:58:17.403626Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.30274105072021484[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:17.406449Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.6501317024230957[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
INFO:     127.0.0.1:35956 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T07:58:17.583066Z[0m [[32m[1minfo     [0m] [1mKraken server time synced     [0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36moffset[0m=[35m-0.33947181701660156[0m
[2m2025-09-20T07:58:17.583632Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355097244[0m [36mfallback_uses[0m=[35m1[0m [36mlocal_count[0m=[35m1[0m [36mnode_hash[0m=[35m582[0m [36mnonce[0m=[35m1758355097827[0m
[2m2025-09-20T07:58:17.819234Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1381.692886352539[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1766.3700000000001[0m
[2m2025-09-20T07:58:18.009570Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1572.3066329956055[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2284.35[0m
[2m2025-09-20T07:58:18.144264Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:19.353454Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:19.937775Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:19.938652Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m3.631s[0m [36mrequest_id[0m=[35mad16b7e4[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:35958 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:58:21.184136Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T07:58:21.188205Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T07:58:21.827306Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.22188186645507812[0m [36mstatement[0m=[35mSELECT exchange_accounts.id AS exchange_accounts_id, exchange_accounts.user_id AS exchange_accounts_user_id, exchange_accounts.exchange_name AS exchange_accounts_exchange_name, exchange_accounts.excha...[0m
[2m2025-09-20T07:58:21.830896Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m4001.7100000000005[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:22.540036Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T07:58:22.653749Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m8.182s[0m [36mrequest_id[0m=[35m4acf87e0[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:35946 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
INFO:     Waiting for background tasks to complete. (CTRL+C to force quit)
[2m2025-09-20T07:58:27.537449Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m12.153309345245361[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:27.538814Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m12.367s[0m [36mrequest_id[0m=[35m0cb91b8b[0m [36mstatus_code[0m=[35m200[0m
INFO:     Waiting for application shutdown.
[2m2025-09-20T07:58:27.768774Z[0m [[32m[1minfo     [0m] [1müîÑ CryptoUniverse Enterprise shutting down...[0m [[34m[1mmain[0m] [36mworker_id[0m=[35m215816[0m
[2m2025-09-20T07:58:27.769414Z[0m [[32m[1minfo     [0m] [1müîÑ Stopping background services...[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:27.769776Z[0m [[32m[1minfo     [0m] [1m‚úÖ health_monitor stopped      [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:27.770055Z[0m [[32m[1minfo     [0m] [1m‚úÖ rate_limit_cleanup stopped  [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:27.770387Z[0m [[32m[1minfo     [0m] [1m‚úÖ All background services stopped[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:27.770656Z[0m [[32m[1minfo     [0m] [1m‚úÖ Background services stopped [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:27.770829Z[0m [[32m[1minfo     [0m] [1müß† AI Manager was not started - no shutdown needed[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:28.028695Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database disconnected       [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:28.029022Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis disconnected          [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:28.029138Z[0m [[32m[1minfo     [0m] [1müëã Shutdown complete in 0.26s  [0m [[34m[1mmain[0m] 
INFO:     Application shutdown complete.
INFO:     Finished server process [215816]
3 changes detected
1 change detected
1 change detected
3 changes detected
2025-09-20 13:28:34 [info     ] ‚úÖ MarketDataCoordinator initialized with enterprise features
2025-09-20 13:28:34 [info     ] üö® Emergency Manager initialized with institutional protocols
2025-09-20 13:28:35 [warning  ] Supabase not configured - using mock mode
1 change detected
2025-09-20 13:28:36 [info     ] ChatAI Service initialized     model=gpt-4 temperature=0.7 timeout=30
2025-09-20 13:28:36 [info     ] ‚úÖ Dynamic Exchange Discovery initialized
2025-09-20 13:28:36 [info     ] üß† UNIFIED CHAT SERVICE INITIALIZED - All features preserved
2025-09-20 13:28:36 [info     ] ‚úÖ Enhanced chat engine initialized
2025-09-20 13:28:36 [info     ] üß† UNIFIED AI MONEY MANAGER INITIALIZING
2025-09-20 13:28:36 [info     ] üß† Unified AI brain connected to all interfaces
2025-09-20 13:28:36 [info     ] üí∞ API Cost Tracker initialized with enterprise monitoring
2025-09-20 13:28:36 [info     ] ab_testing.production_mode_enabled message=A/B Testing running in PRODUCTION MODE with Redis-backed storage for multi-worker safety
2025-09-20 13:28:36 [info     ] ab_testing.production_mode     message=Production mode enabled - database-backed storage required
1 change detected
[2m2025-09-20T07:58:37.530049Z[0m [[32m[1minfo     [0m] [1mCORS origins configured: ['http://localhost:3000', 'http://localhost:5173', 'https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000', 'http://127.0.0.1:3000', 'http://127.0.0.1:8000'][0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:37.530575Z[0m [[32m[1minfo     [0m] [1mFrontend URL: https://cryptouniverse-frontend.onrender.com[0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:37.531214Z[0m [[32m[1minfo     [0m] [1mBase URL: http://localhost:8000[0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:37.531836Z[0m [[32m[1minfo     [0m] [1mEnvironment: development      [0m [[34m[1m__mp_main__[0m] 
[2m2025-09-20T07:58:37.532269Z[0m [[32m[1minfo     [0m] [1mFinal CORS origins being used: ['https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000'][0m [[34m[1m__mp_main__[0m] 
1 change detected
[2m2025-09-20T07:58:38.199595Z[0m [[32m[1minfo     [0m] [1mCORS origins configured: ['http://localhost:3000', 'http://localhost:5173', 'https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000', 'http://127.0.0.1:3000', 'http://127.0.0.1:8000'][0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:38.199968Z[0m [[32m[1minfo     [0m] [1mFrontend URL: https://cryptouniverse-frontend.onrender.com[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:38.200098Z[0m [[32m[1minfo     [0m] [1mBase URL: http://localhost:8000[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:38.200191Z[0m [[32m[1minfo     [0m] [1mEnvironment: development      [0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:38.200378Z[0m [[32m[1minfo     [0m] [1mFinal CORS origins being used: ['https://cryptouniverse-frontend.onrender.com', 'https://cryptouniverse.onrender.com', 'http://localhost:3000', 'http://localhost:8000'][0m [[34m[1mmain[0m] 
INFO:     Started server process [215947]
INFO:     Waiting for application startup.
[2m2025-09-20T07:58:38.496524Z[0m [[32m[1minfo     [0m] [1müöÄ CryptoUniverse Enterprise starting up...[0m [[34m[1mmain[0m] [36menvironment[0m=[35mdevelopment[0m [36mis_primary[0m=[35mTrue[0m [36mversion[0m=[35m2.0.0[0m [36mworker_id[0m=[35m215947[0m
[2m2025-09-20T07:58:38.496679Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database connected          [0m [[34m[1mmain[0m] 
1 change detected
1 change detected
[2m2025-09-20T07:58:40.302287Z[0m [[32m[1minfo     [0m] [1mRedis connection pool created with enterprise settings[0m [[34m[1mapp.core.redis[0m] [36murl[0m=[35mredis://localhost:63...[0m
[2m2025-09-20T07:58:40.302684Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T07:58:40.302833Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è Redis connection failed - running in degraded mode[0m [[34m[1mmain[0m] [36merror[0m=[35m'NoneType' object has no attribute 'ping'[0m
[2m2025-09-20T07:58:40.302979Z[0m [[32m[1minfo     [0m] [1müöÄ Starting essential background services...[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:40.303143Z[0m [[32m[1minfo     [0m] [1müîß Initializing Enterprise Redis Manager...[0m [[34m[1mEnterpriseRedisManager[0m] 
[2m2025-09-20T07:58:40.303319Z[0m [[32m[1minfo     [0m] [1müîó Redis connection pool configured[0m [[34m[1mEnterpriseRedisManager[0m] [36mmax_connections[0m=[35m20[0m
[2m2025-09-20T07:58:40.305193Z[0m [[31m[1merror    [0m] [1m‚ùå Failed to initialize Redis Manager[0m [[34m[1mEnterpriseRedisManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:58:40.305483Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis client initialized through enterprise manager[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:40.305755Z[0m [[32m[1minfo     [0m] [1müöÄ health_monitor service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:40.305878Z[0m [[32m[1minfo     [0m] [1müöÄ rate_limit_cleanup service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:40.305968Z[0m [[32m[1minfo     [0m] [1m‚úÖ Essential background services started[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:40.306059Z[0m [[32m[1minfo     [0m] [1müìÖ Heavy services scheduled for deferred startup[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:40.306165Z[0m [[32m[1minfo     [0m] [1müìä System monitoring scheduled for delayed startup[0m [[34m[1mmain[0m] 
[2m2025-09-20T07:58:40.306249Z[0m [[32m[1minfo     [0m] [1müéâ CryptoUniverse Enterprise is ready![0m [[34m[1mmain[0m] [36mapi_docs[0m=[35mhttp://localhost:8000/api/docs[0m
[2m2025-09-20T07:58:40.306389Z[0m [[32m[1minfo     [0m] [1m‚úÖ health_monitor service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:40.306481Z[0m [[32m[1minfo     [0m] [1müè• Health monitor service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:40.307471Z[0m [[32m[1minfo     [0m] [1m‚úÖ rate_limit_cleanup service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:58:40.307786Z[0m [[32m[1minfo     [0m] [1müö¶ Rate limit cleanup service started[0m [[34m[1mBackgroundServiceManager[0m] 
INFO:     Application startup complete.
[2m2025-09-20T07:58:40.315320Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T07:58:40.315879Z[0m [[31m[1merror    [0m] [1mFailed to initialize Redis connection pool[0m [[34m[1mapp.core.redis_pool[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m [36mtype[0m=[35mConnectionError[0m
[2m2025-09-20T07:58:40.316164Z[0m [[33m[1mwarning  [0m] [1mRate limiter initialized WITHOUT Redis - will fail open[0m [[34m[1mapp.services.rate_limit[0m] 
[2m2025-09-20T07:58:40.321508Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:40.322788Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/exchanges/kucoin/balances[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35me0245b3f[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:58:40.324047Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
INFO:     ('127.0.0.1', 50940) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
[2m2025-09-20T07:58:40.329932Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     connection open
[2m2025-09-20T07:58:40.337304Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:40.344321Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/exchanges/kucoin/balances[0m [36mprocess_time[0m=[35m0.021s[0m [36mrequest_id[0m=[35me0245b3f[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:40.345587Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m78c20d75[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:58:40.349294Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:40.354870Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:40.360440Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:40.365841Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:40.372192Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     ('127.0.0.1', 51002) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
INFO:     127.0.0.1:36000 - "OPTIONS /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:58:40.388095Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T07:58:42.055543Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.8489973545074463[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
1 change detected
[2m2025-09-20T07:58:42.286433Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21512484550476074[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T07:58:42.513782Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2201380729675293[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:42.817791Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4639747142791748[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:42.847226Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.453171968460083[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:42.850950Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:42.867874Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4438657760620117[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:42.870630Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.47786879539489746[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:42.871292Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m1bd0a6b6-0bcf-4552-8ea0-aedbcdd1d51d[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:42.872544Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m2.527s[0m [36mrequest_id[0m=[35m78c20d75[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50950 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T07:58:42.912076Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.47866249084472656[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:42.917515Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.479891300201416[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:42.919079Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:50950 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T07:58:42.950541Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:42.950882Z[0m [[31m[1merror    [0m] [1mFailed to load dynamic pricing config[0m [[34m[1mProfitSharingService[0m] [36merror[0m=[35m'NoneType' object has no attribute 'hset'[0m
[2m2025-09-20T07:58:42.951061Z[0m [[31m[1merror    [0m] [1mFailed to load strategy pricing[0m [[34m[1mProfitSharingService[0m] [36merror[0m=[35m'NoneType' object has no attribute 'hset'[0m
[2m2025-09-20T07:58:42.980655Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35ma37a40a9[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:58:42.983606Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:43.040009Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:58:43.041763Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/balance[0m [36mprocess_time[0m=[35m2.672s[0m [36mrequest_id[0m=[35m4e27a443[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50986 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T07:58:43.093940Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.36716461181640625[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:43.095311Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable - operating in degraded mode[0m [[34m[1mMasterSystemController[0m] 
[2m2025-09-20T07:58:43.097566Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/status[0m [36mprocess_time[0m=[35m2.710s[0m [36mrequest_id[0m=[35m917568f2[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:43.122351Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:43.122792Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:36000 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:50986 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T07:58:43.201833Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:43.208119Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4243142604827881[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:43.210148Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:43.385487Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.31797170639038086[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:43.387926Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21047258377075195[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:43.388966Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m7dbe7db5-ae4a-4131-afae-b60a479de9a9[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:43.422577Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.442s[0m [36mrequest_id[0m=[35ma37a40a9[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50950 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T07:58:43.465777Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.332275390625[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:43.585941Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/list[0m [36mprocess_time[0m=[35m3.223s[0m [36mrequest_id[0m=[35m31d06bcf[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50982 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T07:58:43.618685Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:43.629603Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4953179359436035[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:43.742678Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_f9902cbb[0m
[2m2025-09-20T07:58:43.743128Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_000f0946[0m
[2m2025-09-20T07:58:43.743522Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_2c61bcb2[0m
[2m2025-09-20T07:58:43.755377Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.33402132987976074[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:43.775870Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:43.828572Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.6161506175994873[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:43.830010Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:43.830370Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:36000 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T07:58:44.088529Z[0m [[32m[1minfo     [0m] [1mKraken server time synced     [0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36moffset[0m=[35m0.256580114364624[0m
[2m2025-09-20T07:58:44.095959Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355124352[0m [36mfallback_uses[0m=[35m1[0m [36mlocal_count[0m=[35m1[0m [36mnode_hash[0m=[35m241[0m [36mnonce[0m=[35m1758355124594[0m
[2m2025-09-20T07:58:44.118992Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m989.0987873077393[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1766.6900000000003[0m
[2m2025-09-20T07:58:44.130546Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21880435943603516[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:44.151112Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2377638816833496[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:58:44.153932Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.32018256187438965[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:44.357075Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20635771751403809[0m [36mstatement[0m=[35mINSERT INTO exchange_balances (id, account_id, symbol, asset_type, total_balance, available_balance, locked_balance, usd_value, balance_change_24h, is_active, sync_enabled, created_at, updated_at, las...[0m
[2m2025-09-20T07:58:44.363171Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1233.5410118103027[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2283.9399999999996[0m
[2m2025-09-20T07:58:44.409655Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.5748326778411865[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:44.518445Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_448f8b1d[0m
[2m2025-09-20T07:58:44.518683Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_50d9af1f[0m
[2m2025-09-20T07:58:44.518808Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355124775[0m [36mfallback_uses[0m=[35m2[0m [36mlocal_count[0m=[35m2[0m [36mnode_hash[0m=[35m648[0m [36mnonce[0m=[35m1758355125425[0m
1 change detected
[2m2025-09-20T07:58:44.583857Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4509165287017822[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T07:58:44.588451Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.43480539321899414[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T07:58:44.610667Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:44.752270Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:44.900682Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.31111645698547363[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:45.069605Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1238.5549545288086[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2283.87[0m
[2m2025-09-20T07:58:45.110706Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21037626266479492[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:45.114718Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2171788215637207[0m [36mstatement[0m=[35mINSERT INTO exchange_balances (id, account_id, symbol, asset_type, total_balance, available_balance, locked_balance, usd_value, balance_change_24h, is_active, sync_enabled, created_at, updated_at, las...[0m
INFO:     127.0.0.1:50982 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T07:58:45.164100Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1332.6406478881836[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1766.6600000000003[0m
1 change detected
[2m2025-09-20T07:58:45.819593Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:46.083615Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:46.169457Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:46.170761Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m5.852s[0m [36mrequest_id[0m=[35m753f509d[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:46.171951Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.47043490409851074[0m [36mstatement[0m=[35mINSERT INTO exchange_balances (id, account_id, symbol, asset_type, total_balance, available_balance, locked_balance, usd_value, balance_change_24h, is_active, sync_enabled, created_at, updated_at, las...[0m
1 change detected
[2m2025-09-20T07:58:47.816629Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:47.818927Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m4.202s[0m [36mrequest_id[0m=[35m48a11f67[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50950 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:58:47.842264Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:47.880608Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:47.922021Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T07:58:47.924733Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T07:58:48.211036Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T07:58:48.212227Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T07:58:48.376936Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m4001.2400000000007[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T07:58:48.425297Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3065342903137207[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T07:58:48.855988Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.36705446243286133[0m [36mstatement[0m=[35mSELECT exchange_balances.id, exchange_balances.account_id, exchange_balances.symbol, exchange_balances.asset_type, exchange_balances.total_balance, exchange_balances.available_balance, exchange_balanc...[0m
[2m2025-09-20T07:58:48.868679Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.32700562477111816[0m [36mstatement[0m=[35mSELECT portfolios.total_value_usd, portfolios.created_at 
FROM portfolios 
WHERE portfolios.user_id = $1::UUID AND portfolios.created_at >= $2::TIMESTAMP WITHOUT TIME ZONE AND portfolios.created_at <=...[0m
[2m2025-09-20T07:58:48.966489Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m4001.2400000000007[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:49.369296Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T07:58:49.498438Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m9.147s[0m [36mrequest_id[0m=[35m0b945ba1[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50958 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T07:58:49.567932Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T07:58:49.866928Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:50.000856Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:50.001359Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:50.338713Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2149190902709961[0m [36mstatement[0m=[35mINSERT INTO exchange_balances (id, account_id, symbol, asset_type, total_balance, available_balance, locked_balance, usd_value, balance_change_24h, is_active, sync_enabled, created_at, updated_at, las...[0m
[2m2025-09-20T07:58:50.401831Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2545175552368164[0m [36mstatement[0m=[35mUPDATE exchange_balances SET is_active=$1::BOOLEAN, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE exchange_balances.account_id = $3::UUID AND (exchange_balances.symbol NOT IN ($4::VARCHAR, $5::VARC...[0m
[2m2025-09-20T07:58:50.410989Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.33264875411987305[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:50.548178Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:50.558710Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kucoin/balances[0m [36mprocess_time[0m=[35m2.687s[0m [36mrequest_id[0m=[35md7255c21[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50982 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:58:50.627066Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.547715425491333[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:50.800147Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_d92f8053[0m
[2m2025-09-20T07:58:50.800404Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_4842a795[0m
[2m2025-09-20T07:58:50.800531Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355131057[0m [36mfallback_uses[0m=[35m3[0m [36mlocal_count[0m=[35m3[0m [36mnode_hash[0m=[35m971[0m [36mnonce[0m=[35m1758355132031[0m
[2m2025-09-20T07:58:50.817225Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35md7d9ae57[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:58:50.818914Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m0.002s[0m [36mrequest_id[0m=[35md7d9ae57[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50982 - "OPTIONS /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:58:50.834778Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T07:58:51.115405Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:51.118205Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1074.2120742797852[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2283.8799999999997[0m
[2m2025-09-20T07:58:51.159150Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1114.5751476287842[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1766.6600000000003[0m
[2m2025-09-20T07:58:51.436598Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_7e7593d7[0m
[2m2025-09-20T07:58:51.437031Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_9843206a[0m
[2m2025-09-20T07:58:51.437258Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355131693[0m [36mfallback_uses[0m=[35m4[0m [36mlocal_count[0m=[35m4[0m [36mnode_hash[0m=[35m731[0m [36mnonce[0m=[35m1758355132428[0m
[2m2025-09-20T07:58:51.576008Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:51.577953Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m3.738s[0m [36mrequest_id[0m=[35mdab4f854[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50950 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:58:51.635312Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:51.671115Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T07:58:51.762361Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m11.430s[0m [36mrequest_id[0m=[35md7cfead3[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:52.172939Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T07:58:52.398823Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
INFO:     127.0.0.1:43260 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:43266 - "GET /api/v1/market/symbols HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:43270 - "GET /health HTTP/1.1" 200 OK
[2m2025-09-20T07:58:52.868675Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/auth/login[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m4a3bfc01[0m [36muser_agent[0m=[35mpython-requests/2.32.5[0m
[2m2025-09-20T07:58:52.886358Z[0m [[32m[1minfo     [0m] [1mLogin attempt                 [0m [[34m[1mapp.api.v1.endpoints.auth[0m] [36memail[0m=[35madmin@cryptouniverse.com[0m [36mip[0m=[35m127.0.0.1[0m
1 change detected
[2m2025-09-20T07:58:53.567905Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.43120765686035156[0m [36mstatement[0m=[35mINSERT INTO exchange_balances (id, account_id, symbol, asset_type, total_balance, available_balance, locked_balance, usd_value, balance_change_24h, is_active, sync_enabled, created_at, updated_at, las...[0m
[2m2025-09-20T07:58:53.719876Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:53.721430Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kucoin/balances[0m [36mprocess_time[0m=[35m2.090s[0m [36mrequest_id[0m=[35meda63c6c[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50950 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:58:53.846021Z[0m [[32m[1minfo     [0m] [1mLogin successful              [0m [[34m[1mapp.api.v1.endpoints.auth[0m] [36memail[0m=[35madmin@cryptouniverse.com[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:53.847450Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/auth/login[0m [36mprocess_time[0m=[35m0.979s[0m [36mrequest_id[0m=[35m4a3bfc01[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:43286 - "POST /api/v1/auth/login HTTP/1.1" 200 OK
[2m2025-09-20T07:58:53.857487Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:53.908609Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:54.067032Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:54.110885Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:54.111284Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:54.138796Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m11.319782495498657[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:54.140430Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m13.813s[0m [36mrequest_id[0m=[35mf8cc37a6[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:54.344520Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.22693347930908203[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:54.516804Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3985433578491211[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
1 change detected
[2m2025-09-20T07:58:54.621965Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_a2fc2f86[0m
[2m2025-09-20T07:58:54.622540Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_4fb73482[0m
[2m2025-09-20T07:58:54.622941Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355134879[0m [36mfallback_uses[0m=[35m5[0m [36mlocal_count[0m=[35m5[0m [36mnode_hash[0m=[35m689[0m [36mnonce[0m=[35m1758355135573[0m
[2m2025-09-20T07:58:54.630682Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m11.717374563217163[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:54.632713Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m14.274s[0m [36mrequest_id[0m=[35m6993744d[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:54.644932Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:50966 - "GET /api/v1/trading/market-overview HTTP/1.1" 200 OK
[2m2025-09-20T07:58:54.686410Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:54.686947Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4642.667770385742[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T07:58:54.703524Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4702.024221420288[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4836.5607261657715[0m [36mtotal_value_usd[0m=[35m4050.54[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:54.706146Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T07:58:54.740575Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:54.873036Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:54.918938Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:55.045266Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:55.046127Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:55.048384Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m935.8117580413818[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1766.6600000000003[0m
[2m2025-09-20T07:58:55.388076Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4105408191680908[0m [36mstatement[0m=[35mSELECT exchange_balances.id, exchange_balances.account_id, exchange_balances.symbol, exchange_balances.asset_type, exchange_balances.total_balance, exchange_balances.available_balance, exchange_balanc...[0m
[2m2025-09-20T07:58:55.391385Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1279.1290283203125[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2284.14[0m
[2m2025-09-20T07:58:55.435958Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3842461109161377[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:55.665192Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.6123864650726318[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:58:56.010021Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_e3e5af37[0m
[2m2025-09-20T07:58:56.010281Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_852b3e83[0m
[2m2025-09-20T07:58:56.010406Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355136266[0m [36mfallback_uses[0m=[35m6[0m [36mlocal_count[0m=[35m6[0m [36mnode_hash[0m=[35m756[0m [36mnonce[0m=[35m1758355137028[0m
[2m2025-09-20T07:58:56.012855Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.6215224266052246[0m [36mstatement[0m=[35mSELECT exchange_accounts.id AS exchange_accounts_id, exchange_accounts.user_id AS exchange_accounts_user_id, exchange_accounts.exchange_name AS exchange_accounts_exchange_name, exchange_accounts.excha...[0m
[2m2025-09-20T07:58:56.019536Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3998.9400000000005[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:56.052618Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:58:56.110310Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m1.191681146621704[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
1 change detected
[2m2025-09-20T07:58:56.331166Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:56.333235Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:56.333604Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:56.334657Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1287.264347076416[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1766.7100000000003[0m
[2m2025-09-20T07:58:56.335376Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1288.1624698638916[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2284.14[0m
[2m2025-09-20T07:58:56.459693Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:56.462499Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m5.629s[0m [36mrequest_id[0m=[35m9f6d798a[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:56.873767Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_a5ed415a[0m
[2m2025-09-20T07:58:56.874648Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_4149b45f[0m
[2m2025-09-20T07:58:56.875195Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355137131[0m [36mfallback_uses[0m=[35m7[0m [36mlocal_count[0m=[35m7[0m [36mnode_hash[0m=[35m436[0m [36mnonce[0m=[35m1758355137574[0m
[2m2025-09-20T07:58:56.919305Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2460472583770752[0m [36mstatement[0m=[35mSELECT exchange_balances.id, exchange_balances.account_id, exchange_balances.symbol, exchange_balances.asset_type, exchange_balances.total_balance, exchange_balances.available_balance, exchange_balanc...[0m
[2m2025-09-20T07:58:56.919879Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T07:58:57.020412Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m7.455s[0m [36mrequest_id[0m=[35m82207699[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:58:57.107164Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T07:58:58.095418Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:58.337484Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:58.614529Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:58:58.614895Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4502.410411834717[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T07:58:58.615135Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4503.87167930603[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4548.113107681274[0m [36mtotal_value_usd[0m=[35m4050.8[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:58.615405Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
1 change detected
[2m2025-09-20T07:58:58.879410Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3998.9400000000005[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:59.400380Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T07:58:59.486120Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m5.631s[0m [36mrequest_id[0m=[35ma5acf9d1[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:43288 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T07:58:59.497666Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T07:58:59.776608Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:59.889008Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:58:59.917257Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T07:58:59.917911Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T07:59:00.000956Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:43312 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T07:59:00.025791Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:59:00.050927Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:59:00.332097Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3998.9400000000005[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:43316 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T07:59:00.474607Z[0m [[33m[1mwarning  [0m] [1mRequest completed with client error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/market/data[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m9bbfc26f[0m [36mstatus_code[0m=[35m405[0m
INFO:     127.0.0.1:43322 - "GET /api/v1/market/data HTTP/1.1" 405 Method Not Allowed
[2m2025-09-20T07:59:00.482118Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:59:00.548641Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:59:00.678350Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:59:00.679617Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.636s[0m [36mrequest_id[0m=[35m76639e4e[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:43298 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:59:00.708115Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:43332 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T07:59:01.042609Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T07:59:01.136483Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.498s[0m [36mrequest_id[0m=[35m5e95516e[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50950 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T07:59:01.401835Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_ccd807fb[0m
[2m2025-09-20T07:59:01.402192Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_dd44391b[0m
[2m2025-09-20T07:59:01.402389Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355141658[0m [36mfallback_uses[0m=[35m8[0m [36mlocal_count[0m=[35m8[0m [36mnode_hash[0m=[35m332[0m [36mnonce[0m=[35m1758355141998[0m
[2m2025-09-20T07:59:01.605200Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T07:59:02.834825Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
INFO:     127.0.0.1:42226 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T07:59:05.058657Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:59:05.261651Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/paper-trading/setup[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35me2c39be8[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:59:05.262938Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:59:05.287946Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:59:05.290615Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.587s[0m [36mrequest_id[0m=[35m62d7a62f[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:43298 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
[2m2025-09-20T07:59:05.471876Z[0m [[32m[1minfo     [0m] [1müìù Paper trading account created for 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPaperTradingEngine[0m] [36mvirtual_balance[0m=[35m10000.0[0m
[2m2025-09-20T07:59:05.472995Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/paper-trading/setup[0m [36mprocess_time[0m=[35m0.211s[0m [36mrequest_id[0m=[35me2c39be8[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:42226 - "POST /api/v1/paper-trading/setup HTTP/1.1" 200 OK
[2m2025-09-20T07:59:05.549355Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/paper-trading/stats[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mc8428520[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:59:05.550449Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/paper-trading/stats[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35mc8428520[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:59:05.560543Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35me7bd02b8[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:59:05.563195Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:42226 - "OPTIONS /api/v1/paper-trading/stats HTTP/1.1" 200 OK
[2m2025-09-20T07:59:05.598683Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/paper-trading/stats[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m80cc49b6[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:59:05.602183Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/paper-trading/stats[0m [36mprocess_time[0m=[35m0.003s[0m [36mrequest_id[0m=[35m80cc49b6[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:42226 - "OPTIONS /api/v1/paper-trading/stats HTTP/1.1" 200 OK
[2m2025-09-20T07:59:05.635668Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:59:05.821854Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35mdbcd9e3e-845d-4d67-a65e-fdd21ef272d4[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:05.824489Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.264s[0m [36mrequest_id[0m=[35me7bd02b8[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:43298 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
INFO:     127.0.0.1:42226 - "GET /api/v1/paper-trading/stats HTTP/1.1" 200 OK
[2m2025-09-20T07:59:05.948493Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
INFO:     127.0.0.1:42226 - "GET /api/v1/paper-trading/stats HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T07:59:07.615045Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m11.503404378890991[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:07.616713Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m12.879s[0m [36mrequest_id[0m=[35ma7a2b46b[0m [36mstatus_code[0m=[35m200[0m
1 change detected
1 change detected
[2m2025-09-20T07:59:10.054853Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mc6f52b7d[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T07:59:10.064461Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:59:10.310449Z[0m [[32m[1minfo     [0m] [1müöÄ Starting deferred background services...[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:10.311043Z[0m [[32m[1minfo     [0m] [1müöÄ metrics_collector service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:10.311456Z[0m [[32m[1minfo     [0m] [1m‚úÖ metrics_collector service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:10.311709Z[0m [[32m[1minfo     [0m] [1müìä Metrics collector service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:10.415121Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m5dd935b1-8251-44f2-a268-d6880e7c61ec[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:10.417773Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.363s[0m [36mrequest_id[0m=[35mc6f52b7d[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T07:59:10.421165Z[0m [[31m[1merror    [0m] [1mMetrics collector error       [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
INFO:     127.0.0.1:42226 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T07:59:11.516623Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m11.257489919662476[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:11.517821Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m11.468s[0m [36mrequest_id[0m=[35m1de7c577[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:43318 - "GET /api/v1/trading/market-overview HTTP/1.1" 200 OK
[2m2025-09-20T07:59:12.311980Z[0m [[32m[1minfo     [0m] [1müöÄ cleanup_service service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:12.312272Z[0m [[32m[1minfo     [0m] [1m‚úÖ cleanup_service service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:12.312398Z[0m [[32m[1minfo     [0m] [1müßπ Cleanup service started     [0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:12.313191Z[0m [[31m[1merror    [0m] [1mRedis cleanup failed          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:59:12.313356Z[0m [[32m[1minfo     [0m] [1m‚úÖ Cleanup cycle completed     [0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
[2m2025-09-20T07:59:13.388527Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:59:13.390878Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T07:59:13.599399Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:13.684916Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:13.767465Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:33118 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T07:59:14.312430Z[0m [[32m[1minfo     [0m] [1müöÄ autonomous_cycles service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:14.312698Z[0m [[32m[1minfo     [0m] [1m‚úÖ autonomous_cycles service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:14.312826Z[0m [[32m[1minfo     [0m] [1mü§ñ Autonomous cycles service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:14.313631Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T07:59:16.312425Z[0m [[32m[1minfo     [0m] [1müöÄ market_data_sync service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:16.312691Z[0m [[32m[1minfo     [0m] [1m‚úÖ market_data_sync service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:16.312817Z[0m [[32m[1minfo     [0m] [1müìà Market data sync service started[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
[2m2025-09-20T07:59:18.293990Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T07:59:18.312838Z[0m [[32m[1minfo     [0m] [1müöÄ balance_sync service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:18.313184Z[0m [[32m[1minfo     [0m] [1m‚úÖ balance_sync service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:18.313312Z[0m [[32m[1minfo     [0m] [1müí∞ Balance sync service started[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
[2m2025-09-20T07:59:18.918953Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:18.968738Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:18.968995Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:19.212768Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.23894429206848145[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:59:19.421201Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.44663000106811523[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T07:59:19.553031Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_76b94a3e[0m
[2m2025-09-20T07:59:19.553349Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_8529bf3f[0m
[2m2025-09-20T07:59:19.556567Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355159813[0m [36mfallback_uses[0m=[35m9[0m [36mlocal_count[0m=[35m9[0m [36mnode_hash[0m=[35m392[0m [36mnonce[0m=[35m1758355160214[0m
[2m2025-09-20T07:59:19.795454Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T07:59:19.829015Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:59:19.856338Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m885.7645988464355[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1767.0300000000002[0m
[2m2025-09-20T07:59:20.098388Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1128.9699077606201[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2285.1299999999997[0m
1 change detected
[2m2025-09-20T07:59:20.313769Z[0m [[32m[1minfo     [0m] [1müöÄ risk_monitor service started (deferred)[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:20.314121Z[0m [[32m[1minfo     [0m] [1m‚úÖ risk_monitor service started successfully[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:20.314353Z[0m [[32m[1minfo     [0m] [1m‚ö†Ô∏è Risk monitor service started[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T07:59:21.141975Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T07:59:21.809674Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T07:59:21.982814Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:59:21.983641Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5670.650482177734[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T07:59:23.400822Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T07:59:23.401763Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4432.0807456970215[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T07:59:23.402433Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4433.336973190308[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4483.484268188477[0m [36mtotal_value_usd[0m=[35m4052.16[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:23.405469Z[0m [[33m[1mwarning  [0m] [1mBalance sync failed for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:59:23.785056Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T07:59:24.111866Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T07:59:25.309720Z[0m [[32m[1minfo     [0m] [1mSystem monitoring started     [0m [[34m[1mapp.services.system_monitoring[0m] [36minterval_seconds[0m=[35m120[0m
[2m2025-09-20T07:59:25.309967Z[0m [[32m[1minfo     [0m] [1m‚úÖ System monitoring started (delayed)[0m [[34m[1mmain[0m] 
1 change detected
[2m2025-09-20T07:59:25.729629Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
/home/kopi/CryptoUniverse-fresh/app/services/market_data_feeds.py:313: RuntimeWarning: coroutine 'MarketDataFeeds._handle_api_failure' was never awaited
  self._handle_api_failure(api_name, str(e))
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
[2m2025-09-20T07:59:25.732280Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T07:59:25.732603Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T07:59:25.732808Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T07:59:26.538548Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T07:59:26.714372Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:59:26.715665Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4731.56213760376[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T07:59:28.342140Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T07:59:28.644094Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T07:59:30.099700Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T07:59:30.274195Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:59:30.276769Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3560.2004528045654[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T07:59:32.106561Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T07:59:32.430687Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T07:59:34.531806Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T07:59:34.684399Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:59:34.686160Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4408.565282821655[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
INFO:     127.0.0.1:34050 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T07:59:36.470691Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T07:59:36.774361Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T07:59:36.956161Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T07:59:37.389697Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2822391986846924[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T07:59:37.391091Z[0m [[31m[1merror    [0m] [1mFailed to load strategy pricing[0m [[34m[1mStrategyMarketplaceService[0m] [36merror[0m=[35m'NoneType' object has no attribute 'hset'[0m
1 change detected
[2m2025-09-20T07:59:38.690776Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T07:59:38.877772Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:59:38.878595Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4191.354036331177[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T07:59:39.787801Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 39, 216837), datetime.datetime(2025, 9, 20, 7, 59, 39, 216837), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:39.788273Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
1 change detected
[2m2025-09-20T07:59:41.089884Z[0m [[32m[1minfo     [0m] [1m‚úÖ Initialized real market data connections[0m [[34m[1mRealMarketDataService[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken', 'coinbase'][0m
[2m2025-09-20T07:59:41.090597Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfutures_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
1 change detected
[2m2025-09-20T07:59:41.717859Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T07:59:42.208088Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T07:59:43.781335Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:43.826502Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T07:59:43.826862Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.827028Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.827153Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:43.827381Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:43.827535Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.827641Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.827825Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:43.828055Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:43.828204Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.828306Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.828407Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:43.828587Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:43.828716Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.828825Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.828925Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:43.829153Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:43.829291Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.829389Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.829505Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:43.829772Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:43.829905Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.830030Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:43.830133Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:44.113145Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T07:59:44.327372Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:44.406435Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 44, 90153), datetime.datetime(2025, 9, 20, 7, 59, 44, 90153), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:44.406728Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:44.407027Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:44.407320Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:44.407456Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.407570Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.407668Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:44.407887Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:44.408010Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.408101Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.408192Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:44.408353Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:44.408469Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.408556Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.408644Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:44.408800Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:44.408913Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.409002Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.409089Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:44.409302Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:44.409423Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.409510Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.409597Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:44.409780Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:44.409904Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.410000Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:44.410096Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:44.412485Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T07:59:44.494627Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:59280 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T07:59:45.020725Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 44, 683519), datetime.datetime(2025, 9, 20, 7, 59, 44, 683519), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'perpetual_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:45.021220Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:45.021667Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mperpetual_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:45.022045Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.022613Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.022797Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.022948Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.023216Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.023494Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.023606Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.023701Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.024074Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.024208Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.024301Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.024422Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.024598Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.024739Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.024836Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.024935Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.025107Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.025232Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.025327Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.025527Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.025731Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.025878Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.026100Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.026311Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.028126Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T07:59:45.207864Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T07:59:45.208847Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m6329.872608184814[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T07:59:45.209303Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
[2m2025-09-20T07:59:45.583937Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 45, 276082), datetime.datetime(2025, 9, 20, 7, 59, 45, 276082), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'leverage_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:45.584269Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:45.584892Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mleverage_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:45.585906Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.586887Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.587336Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.587719Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.588243Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.588528Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.588675Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.588838Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.589297Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.589547Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.589689Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.589818Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.590060Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.590223Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.590340Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.590457Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.590759Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.590922Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.591037Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.591152Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:45.591356Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:45.591507Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.591622Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:45.591823Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.132155Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 45, 806671), datetime.datetime(2025, 9, 20, 7, 59, 45, 806671), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'complex_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:46.132452Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:46.132740Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcomplex_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:46.133030Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.133168Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.133268Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.133366Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.133542Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.133729Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.133865Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.134060Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.134404Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.134637Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.134832Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.135036Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.135467Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.135710Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.136015Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.136354Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.137321Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.137874Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.138197Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.138520Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.139048Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.139384Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.139645Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.140087Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:46.671233Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 46, 349215), datetime.datetime(2025, 9, 20, 7, 59, 46, 349215), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'margin_status')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:46.672080Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:46.673139Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmargin_status[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:46.673847Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.674223Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.674422Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.674594Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.674905Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.675114Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.675273Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.675428Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.675703Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.676097Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.676272Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.676432Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.676712Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.676910Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.677061Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.677211Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.677477Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.677670Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.677821Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.677970Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:46.678424Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:46.678648Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.678803Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:46.678955Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:47.399921Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 46, 897476), datetime.datetime(2025, 9, 20, 7, 59, 46, 897476), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'funding_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:47.400203Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:47.400591Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfunding_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:47.400968Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:47.401241Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.401442Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.401780Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:47.402535Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:47.403089Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.403432Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.403563Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:47.403886Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:47.404204Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.404378Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.404556Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:47.404876Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:47.405076Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.405233Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.405387Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:47.405631Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:47.405812Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.405962Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.406101Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:47.406343Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:47.406530Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.406677Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:47.406816Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.167560Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 47, 655223), datetime.datetime(2025, 9, 20, 7, 59, 47, 655223), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'basis_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:48.168270Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:48.169532Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mbasis_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:48.170412Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.170845Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.171079Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.171295Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.171896Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.172530Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.172918Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.173120Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.173606Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.173836Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.174030Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.174201Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.174488Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.174697Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.174858Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.175023Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.175300Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.175502Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.175695Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.175997Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.176281Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.176483Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.176656Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.176811Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:48.761346Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 48, 399100), datetime.datetime(2025, 9, 20, 7, 59, 48, 399100), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_chain')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:48.761781Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:48.762162Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_chain[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:48.762519Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.762673Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.762783Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.762885Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.763062Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.763186Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.763281Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.763376Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.763544Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.763665Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.763830Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.763951Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.764118Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.764230Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.764317Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.764405Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.764561Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.764674Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.764776Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.764880Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:48.765043Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:48.765160Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.765250Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:48.765341Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:49.365103Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 49, 9148), datetime.datetime(2025, 9, 20, 7, 59, 49, 9148), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'calculate_greeks')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:49.365622Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:49.366095Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcalculate_greeks[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:49.366500Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:49.366747Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.366916Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.367077Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:49.367513Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:49.375507Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.376045Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.376294Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:49.376697Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:49.376925Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.377090Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.377248Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:49.377528Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:49.377729Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.377883Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.378033Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:49.378301Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:49.378498Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.378648Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.378795Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:49.379057Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:49.379248Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.379395Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:49.379539Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:50.174087Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 49, 744320), datetime.datetime(2025, 9, 20, 7, 59, 49, 744320), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'liquidation_price')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:50.174718Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:50.175844Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mliquidation_price[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:50.176749Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:50.177147Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.177595Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.177937Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:50.178613Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:50.179147Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.179392Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.179634Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:50.180133Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:50.180440Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.180711Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.181052Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:50.181471Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:50.181750Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.181981Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.182265Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:50.182679Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:50.182997Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.183290Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.183527Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:50.183969Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:50.184255Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.184513Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:50.184715Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:51.070663Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 50, 558700), datetime.datetime(2025, 9, 20, 7, 59, 50, 558700), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'hedge_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:51.071051Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:51.071586Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mhedge_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:51.072292Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.072513Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.072666Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.072811Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.073007Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.073132Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.073229Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.073323Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.073491Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.073613Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.073708Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.073799Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.073960Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.074078Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.074214Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.074372Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.074580Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.074703Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.074795Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.074886Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.075046Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.075164Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.075257Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.075349Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:51.637849Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 51, 316833), datetime.datetime(2025, 9, 20, 7, 59, 51, 316833), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:51.638941Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:51.640164Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_momentum_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:51.640914Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.641307Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.641590Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.641852Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.642257Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.642499Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.642629Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.642750Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.643012Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.643448Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.643694Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.644024Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.644528Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.644852Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.645099Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.645403Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.645936Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.646235Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.646467Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.646691Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:51.647083Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:51.647362Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.647587Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:51.647927Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.210724Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 51, 896036), datetime.datetime(2025, 9, 20, 7, 59, 51, 896036), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_mean_reversion')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:52.211177Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:52.211634Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_mean_reversion[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:52.212161Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.212422Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.212626Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.212820Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.213153Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.213402Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.213622Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.213847Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.214174Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.214417Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.214617Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.214817Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.215161Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.215406Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.215605Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.215845Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.216176Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.216410Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.216599Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.216783Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.217101Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.217352Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.217571Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.217796Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:52.872167Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 52, 447626), datetime.datetime(2025, 9, 20, 7, 59, 52, 447626), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_breakout_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:52.872771Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:52.873200Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_breakout_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:52.873603Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.873839Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.874011Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.874179Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.874472Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.874679Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.874844Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.875014Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.875306Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.875514Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.875689Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.876079Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.876397Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.876617Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.876780Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.876941Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.877218Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.877420Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.877583Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.877746Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:52.878024Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:52.878222Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.878379Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:52.878538Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:53.445777Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 53, 112423), datetime.datetime(2025, 9, 20, 7, 59, 53, 112423), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'algorithmic_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:53.446082Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:53.446407Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35malgorithmic_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:53.446693Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:53.446837Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.446941Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.447038Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:53.447216Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:53.447338Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.447433Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.447525Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:53.447690Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:53.447930Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.448035Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.448132Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:53.448316Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:53.448438Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.448531Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.448648Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:53.448963Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:53.449153Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.449340Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.449546Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:53.449904Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:53.450169Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.450354Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:53.450558Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.203660Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 53, 756275), datetime.datetime(2025, 9, 20, 7, 59, 53, 756275), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:54.204252Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:54.205094Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mpairs_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:54.205734Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.206032Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.206219Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.206409Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.206758Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.206985Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.207164Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.207347Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.207668Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.208098Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.208288Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.208478Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.208786Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.208980Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.209134Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.209285Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.209589Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.209783Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.209935Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.210091Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.210356Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.210553Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.210711Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.210900Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:54.992516Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 54, 465878), datetime.datetime(2025, 9, 20, 7, 59, 54, 465878), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:54.992982Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:54.993305Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstatistical_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:54.993603Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.993876Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.993991Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.994093Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.994299Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.994453Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.994550Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.994643Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.994807Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.994927Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.995020Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.995123Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.995290Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.995407Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.995499Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.995588Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.995853Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.996502Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.996642Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.996752Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:54.996980Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:54.997114Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.997214Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:54.997311Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:55.547968Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 55, 250743), datetime.datetime(2025, 9, 20, 7, 59, 55, 250743), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:55.548540Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:55.549033Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmarket_making[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:55.549640Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:55.549983Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.550369Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.550610Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:55.551317Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:55.552620Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.553132Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.553653Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:55.554202Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:55.554579Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.555450Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.556017Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:55.556617Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:55.556970Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.557199Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.557441Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:55.557853Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:55.558126Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.558371Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.558650Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:55.560183Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:55.560830Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.561053Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:55.561186Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.077267Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 55, 779420), datetime.datetime(2025, 9, 20, 7, 59, 55, 779420), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'scalping_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:56.077725Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:56.078200Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mscalping_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:56.078664Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.078957Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.079162Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.079365Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.079716Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.080070Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.080268Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.080475Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.080855Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.081268Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.081513Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.081718Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.082048Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.082285Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.082472Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.082664Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.083042Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.083285Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.083597Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.083906Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.084504Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.085198Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.085989Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.086307Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:56.596275Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 56, 292403), datetime.datetime(2025, 9, 20, 7, 59, 56, 292403), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'swing_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:56.596685Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:56.597251Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mswing_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:56.597627Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.597847Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.598021Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.598188Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.598472Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.598722Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.599023Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.599232Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.599677Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.600119Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.600418Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.600638Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.601241Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.601745Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.602615Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.603008Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.603582Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.604086Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.604384Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.604864Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:56.605433Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:56.605799Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.606093Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:56.606315Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.112823Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 56, 820323), datetime.datetime(2025, 9, 20, 7, 59, 56, 820323), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'position_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:57.113164Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:57.113488Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mposition_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:57.113780Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.113926Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.114030Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.114129Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.114303Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.114427Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.114522Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.114616Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.114779Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.114900Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.114994Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.115085Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.115248Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.115368Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.115462Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.115553Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.115855Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.116000Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.116097Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.116189Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.116355Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.116476Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.116569Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.116785Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:57.621442Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 57, 327222), datetime.datetime(2025, 9, 20, 7, 59, 57, 327222), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:57.621715Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:57.621997Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mrisk_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:57.622271Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.622413Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.622515Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.622614Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.622787Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.622911Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.623005Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.623097Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.623260Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.623381Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.623473Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.623564Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.623818Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.624033Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.624222Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.624353Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.624554Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.624690Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.624793Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.624894Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:57.625070Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:57.625199Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.625300Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:57.625440Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.133748Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 57, 836822), datetime.datetime(2025, 9, 20, 7, 59, 57, 836822), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:58.134424Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:58.135650Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mportfolio_optimization[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:58.136616Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.136906Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.137060Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.137291Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.137878Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.138439Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.138702Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.139019Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.139411Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.139620Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.139874Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.140081Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.140361Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.140554Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.140704Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.140853Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.141133Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.141323Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.141474Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.141625Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.141879Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.142063Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.142216Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.142373Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T07:59:58.654429Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 7, 59, 58, 354487), datetime.datetime(2025, 9, 20, 7, 59, 58, 354487), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'strategy_performance')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T07:59:58.654942Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T07:59:58.655304Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstrategy_performance[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T07:59:58.655569Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.655711Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.655983Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.656163Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.656366Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.656493Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.656621Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.656752Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.656983Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.657163Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.657266Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.657367Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.657546Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.657673Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.657785Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.657884Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.658060Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.658184Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.658279Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.658374Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.658544Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T07:59:58.658667Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.658762Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T07:59:58.658856Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T07:59:58.930907Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/strategies/marketplace[0m [36mprocess_time[0m=[35m21.978s[0m [36mrequest_id[0m=[35me41d54fe[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34050 - "GET /api/v1/strategies/marketplace?sort_by=performance&include_performance=true HTTP/1.1" 200 OK
INFO:     127.0.0.1:40312 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:00:14.314890Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:00:14.827513Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:00:14.834942Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:00:15.051706Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:00:15.094211Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:00:15.176655Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:53990 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:00:22.639708Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/unified-strategies/portfolio[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m6e49918f[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:00:22.640785Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/unified-strategies/portfolio[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m6e49918f[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:40566 - "OPTIONS /api/v1/unified-strategies/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T08:00:22.657077Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:00:22.868121Z[0m [[32m[1minfo     [0m] [1müè¢ ENTERPRISE PORTFOLIO REQUEST[0m [[34m[1mUnifiedStrategyService[0m] [36moperation_id[0m=[35mportfolio_7a1ee8cd[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36muser_role[0m=[35madmin[0m
[2m2025-09-20T08:00:22.868417Z[0m [[32m[1minfo     [0m] [1müîë ADMIN FULL ACCESS           [0m [[34m[1mUnifiedStrategyService[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:00:23.411525Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 23, 105984), datetime.datetime(2025, 9, 20, 8, 0, 23, 105984), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:23.411931Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
1 change detected
[2m2025-09-20T08:00:23.989409Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 23, 697270), datetime.datetime(2025, 9, 20, 8, 0, 23, 697270), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:23.989868Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:24.489214Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 24, 200424), datetime.datetime(2025, 9, 20, 8, 0, 24, 200424), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:24.489531Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:24.489831Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mfutures_arbitrage[0m
1 change detected
[2m2025-09-20T08:00:24.833916Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 24, 489925), datetime.datetime(2025, 9, 20, 8, 0, 24, 489925), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:24.834337Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:24.834854Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35moptions_strategies[0m
[2m2025-09-20T08:00:25.123439Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 24, 834984), datetime.datetime(2025, 9, 20, 8, 0, 24, 834984), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_strategies')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:25.124025Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
1 change detected
[2m2025-09-20T08:00:25.631626Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 25, 344499), datetime.datetime(2025, 9, 20, 8, 0, 25, 344499), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:25.632647Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:26.166859Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 25, 874619), datetime.datetime(2025, 9, 20, 8, 0, 25, 874619), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:26.167383Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
1 change detected
[2m2025-09-20T08:00:26.668804Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 26, 375474), datetime.datetime(2025, 9, 20, 8, 0, 26, 375474), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:26.670075Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:26.671408Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mvolatility_trading[0m
[2m2025-09-20T08:00:27.011112Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 26, 672072), datetime.datetime(2025, 9, 20, 8, 0, 26, 672072), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'volatility_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:27.011493Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:27.011863Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mnews_sentiment[0m
[2m2025-09-20T08:00:27.305831Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 27, 11979), datetime.datetime(2025, 9, 20, 8, 0, 27, 11979), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'news_sentiment')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:27.306200Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
1 change detected
[2m2025-09-20T08:00:27.540481Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2283613681793213[0m [36mstatement[0m=[35mSELECT CAST($1 AS TEXT) AS anon_1, CAST($2 AS VARCHAR(50)) AS anon_2, CAST($3 AS JSON) AS anon_3, trading_strategies.id, trading_strategies.user_id, trading_strategies.name, trading_strategies.descrip...[0m
[2m2025-09-20T08:00:27.640827Z[0m [[31m[1merror    [0m] [1m‚ùå ENTERPRISE PORTFOLIO FAILED [0m [[34m[1mUnifiedStrategyService[0m] [36merror[0m=[35mgreenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)[0m [36mexecution_time_seconds[0m=[35m4.772738[0m [36moperation_id[0m=[35mportfolio_7a1ee8cd[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 229, in get_user_strategy_portfolio
    return await self._get_portfolio_with_db(user_id, user_role, db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 281, in _get_portfolio_with_db
    portfolio = await self._get_admin_full_portfolio(user_id, db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 325, in _get_admin_full_portfolio
    community_strategies = await self._get_community_strategies_for_admin(db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 510, in _get_community_strategies_for_admin
    "publisher_name": getattr(strategy.user, 'display_name', strategy.user.email.split('@')[0]) if strategy.user else "Anonymous",
  File "/home/kopi/CryptoUniverse-fresh/app/models/user.py", line 184, in display_name
    if self.profile:
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2346, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 116, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
[2m2025-09-20T08:00:27.701814Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/unified-strategies/portfolio[0m [36mprocess_time[0m=[35m5.046s[0m [36mrequest_id[0m=[35m19264f32[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:00:27.711206Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:00:27.933729Z[0m [[32m[1minfo     [0m] [1müè¢ ENTERPRISE PORTFOLIO REQUEST[0m [[34m[1mUnifiedStrategyService[0m] [36moperation_id[0m=[35mportfolio_7a1ee8cd[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36muser_role[0m=[35madmin[0m
[2m2025-09-20T08:00:27.934194Z[0m [[32m[1minfo     [0m] [1müîë ADMIN FULL ACCESS           [0m [[34m[1mUnifiedStrategyService[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:00:28.475485Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 28, 137630), datetime.datetime(2025, 9, 20, 8, 0, 28, 137630), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:28.476342Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:28.978655Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 28, 689273), datetime.datetime(2025, 9, 20, 8, 0, 28, 689273), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:28.979198Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
1 change detected
[2m2025-09-20T08:00:29.518076Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 29, 182807), datetime.datetime(2025, 9, 20, 8, 0, 29, 182807), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:29.519584Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:29.521615Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mfutures_arbitrage[0m
[2m2025-09-20T08:00:29.825519Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 29, 522255), datetime.datetime(2025, 9, 20, 8, 0, 29, 522255), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:29.825978Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:29.826447Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35moptions_strategies[0m
[2m2025-09-20T08:00:30.113161Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 29, 826623), datetime.datetime(2025, 9, 20, 8, 0, 29, 826623), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_strategies')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:30.113442Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
1 change detected
[2m2025-09-20T08:00:30.682208Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 30, 327545), datetime.datetime(2025, 9, 20, 8, 0, 30, 327545), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:30.682840Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:31.228651Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 30, 908279), datetime.datetime(2025, 9, 20, 8, 0, 30, 908279), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:31.228891Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:31.785495Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 31, 444803), datetime.datetime(2025, 9, 20, 8, 0, 31, 444803), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:31.785821Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:31.786150Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mvolatility_trading[0m
[2m2025-09-20T08:00:32.081322Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 31, 786250), datetime.datetime(2025, 9, 20, 8, 0, 31, 786250), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'volatility_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:32.082116Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:32.082868Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mnews_sentiment[0m
1 change detected
[2m2025-09-20T08:00:32.375294Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 0, 32, 83130), datetime.datetime(2025, 9, 20, 8, 0, 32, 83130), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'news_sentiment')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:00:32.375590Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:00:32.589673Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21281003952026367[0m [36mstatement[0m=[35mSELECT CAST($1 AS TEXT) AS anon_1, CAST($2 AS VARCHAR(50)) AS anon_2, CAST($3 AS JSON) AS anon_3, trading_strategies.id, trading_strategies.user_id, trading_strategies.name, trading_strategies.descrip...[0m
[2m2025-09-20T08:00:32.674270Z[0m [[31m[1merror    [0m] [1m‚ùå ENTERPRISE PORTFOLIO FAILED [0m [[34m[1mUnifiedStrategyService[0m] [36merror[0m=[35mgreenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)[0m [36mexecution_time_seconds[0m=[35m4.740589[0m [36moperation_id[0m=[35mportfolio_7a1ee8cd[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 229, in get_user_strategy_portfolio
    return await self._get_portfolio_with_db(user_id, user_role, db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 281, in _get_portfolio_with_db
    portfolio = await self._get_admin_full_portfolio(user_id, db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 325, in _get_admin_full_portfolio
    community_strategies = await self._get_community_strategies_for_admin(db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 510, in _get_community_strategies_for_admin
    "publisher_name": getattr(strategy.user, 'display_name', strategy.user.email.split('@')[0]) if strategy.user else "Anonymous",
  File "/home/kopi/CryptoUniverse-fresh/app/models/user.py", line 184, in display_name
    if self.profile:
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2346, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 116, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
[2m2025-09-20T08:00:32.675350Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/unified-strategies/portfolio[0m [36mprocess_time[0m=[35m4.966s[0m [36mrequest_id[0m=[35m8ec64f4c[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:40570 - "GET /api/v1/unified-strategies/portfolio HTTP/1.1" 200 OK
1 change detected
1 change detected
INFO:     127.0.0.1:40570 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:00:40.325777Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:00:40.326493Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:00:45.522389Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:00:45.526078Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:00:45.760614Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:00:45.807553Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:00:45.890785Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:59588 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:01:03.019943Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:03.264382Z[0m [[32m[1minfo     [0m] [1müè¢ ENTERPRISE PORTFOLIO REQUEST[0m [[34m[1mUnifiedStrategyService[0m] [36moperation_id[0m=[35mportfolio_7a1ee8cd[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36muser_role[0m=[35madmin[0m
[2m2025-09-20T08:01:03.264763Z[0m [[32m[1minfo     [0m] [1müîë ADMIN FULL ACCESS           [0m [[34m[1mUnifiedStrategyService[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:01:03.765634Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 3, 473613), datetime.datetime(2025, 9, 20, 8, 1, 3, 473613), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:03.766220Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:04.263143Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 3, 974911), datetime.datetime(2025, 9, 20, 8, 1, 3, 974911), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:04.263636Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
1 change detected
INFO:     127.0.0.1:39466 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:01:04.799050Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 4, 479060), datetime.datetime(2025, 9, 20, 8, 1, 4, 479060), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:04.799641Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:04.800278Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mfutures_arbitrage[0m
[2m2025-09-20T08:01:05.091275Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 4, 800452), datetime.datetime(2025, 9, 20, 8, 1, 4, 800452), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:05.091668Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:05.092231Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35moptions_strategies[0m
1 change detected
[2m2025-09-20T08:01:05.402704Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 5, 92381), datetime.datetime(2025, 9, 20, 8, 1, 5, 92381), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_strategies')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:05.403382Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:05.938565Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 5, 616105), datetime.datetime(2025, 9, 20, 8, 1, 5, 616105), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:05.939049Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:06.438270Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 6, 142231), datetime.datetime(2025, 9, 20, 8, 1, 6, 142231), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:06.439036Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:06.948629Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 6, 651614), datetime.datetime(2025, 9, 20, 8, 1, 6, 651614), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:06.949181Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:06.949660Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mvolatility_trading[0m
1 change detected
[2m2025-09-20T08:01:07.247054Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 6, 949826), datetime.datetime(2025, 9, 20, 8, 1, 6, 949826), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'volatility_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:07.247923Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:07.248688Z[0m [[33m[1mwarning  [0m] [1mPlatform strategy UUID not found for performance lookup[0m [[34m[1mStrategyMarketplaceService[0m] [36mstrategy_function[0m=[35mnews_sentiment[0m
[2m2025-09-20T08:01:07.550031Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 1, 7, 248958), datetime.datetime(2025, 9, 20, 8, 1, 7, 248958), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'news_sentiment')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:01:07.550698Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:01:07.800152Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24724221229553223[0m [36mstatement[0m=[35mSELECT CAST($1 AS TEXT) AS anon_1, CAST($2 AS VARCHAR(50)) AS anon_2, CAST($3 AS JSON) AS anon_3, trading_strategies.id, trading_strategies.user_id, trading_strategies.name, trading_strategies.descrip...[0m
[2m2025-09-20T08:01:07.901039Z[0m [[31m[1merror    [0m] [1m‚ùå ENTERPRISE PORTFOLIO FAILED [0m [[34m[1mUnifiedStrategyService[0m] [36merror[0m=[35mgreenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)[0m [36mexecution_time_seconds[0m=[35m4.63671[0m [36moperation_id[0m=[35mportfolio_7a1ee8cd[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 229, in get_user_strategy_portfolio
    return await self._get_portfolio_with_db(user_id, user_role, db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 281, in _get_portfolio_with_db
    portfolio = await self._get_admin_full_portfolio(user_id, db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 325, in _get_admin_full_portfolio
    community_strategies = await self._get_community_strategies_for_admin(db)
  File "/home/kopi/CryptoUniverse-fresh/app/services/unified_strategy_service.py", line 510, in _get_community_strategies_for_admin
    "publisher_name": getattr(strategy.user, 'display_name', strategy.user.email.split('@')[0]) if strategy.user else "Anonymous",
  File "/home/kopi/CryptoUniverse-fresh/app/models/user.py", line 184, in display_name
    if self.profile:
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/strategies.py", line 967, in _load_for_state
    return self._emit_lazyload(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/strategies.py", line 1130, in _emit_lazyload
    result = session.execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2346, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "/home/kopi/.local/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 116, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
[2m2025-09-20T08:01:07.902049Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/unified-strategies/portfolio[0m [36mprocess_time[0m=[35m4.883s[0m [36mrequest_id[0m=[35m5e1c0282[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:39462 - "GET /api/v1/unified-strategies/portfolio HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:01:14.316688Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:01:16.226036Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:01:16.226381Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 5 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:01:16.227051Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:01:16.229763Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:01:16.442842Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:16.489979Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:16.580060Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:50124 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:01:16.632693Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
[2m2025-09-20T08:01:16.635479Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
[2m2025-09-20T08:01:18.396750Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m0b2f2fef[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:01:18.399429Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:18.418656Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mc0955365[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:01:18.430783Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     ('127.0.0.1', 50138) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 50146) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
[2m2025-09-20T08:01:18.618033Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35mec026338-1211-4b69-a11f-07f2449f8384[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:18.618720Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.222s[0m [36mrequest_id[0m=[35m0b2f2fef[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50124 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T08:01:18.656843Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m83801d8d-45f0-4c3e-a4e8-f95b03b5c4df[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:18.657398Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.239s[0m [36mrequest_id[0m=[35mc0955365[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50126 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T08:01:18.673957Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:18.723095Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:18.744228Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:18.755144Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:18.769651Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:50186 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
INFO:     127.0.0.1:50186 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:01:18.967650Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:50170 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T08:01:18.982165Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:19.068813Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:19.071276Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:19.081728Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:19.112388Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:50124 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T08:01:19.316031Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:19.323355Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.23873376846313477[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
1 change detected
[2m2025-09-20T08:01:19.432917Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:50126 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:01:19.458355Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:19.484384Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.39911913871765137[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:01:19.595083Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_db15883c[0m
[2m2025-09-20T08:01:19.595451Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_34bf86ba[0m
[2m2025-09-20T08:01:19.595624Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355279852[0m [36mfallback_uses[0m=[35m10[0m [36mlocal_count[0m=[35m10[0m [36mnode_hash[0m=[35m134[0m [36mnonce[0m=[35m1758355279996[0m
[2m2025-09-20T08:01:19.597974Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.27527713775634766[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
INFO:     127.0.0.1:50170 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T08:01:19.887596Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:20.065338Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m983.0751419067383[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2284.4299999999994[0m
INFO:     127.0.0.1:50124 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:01:20.781114Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1698.4891891479492[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1766.41[0m
[2m2025-09-20T08:01:20.879418Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3157308101654053[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:01:21.116674Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2337203025817871[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T08:01:21.173171Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:01:23.380667Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:23.381256Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4298.605680465698[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T08:01:23.381674Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4299.926996231079[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4414.036750793457[0m [36mtotal_value_usd[0m=[35m4050.8399999999992[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:23.382175Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T08:01:23.472590Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:23.473582Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m4.161s[0m [36mrequest_id[0m=[35ma1f55267[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50186 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:01:23.485530Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:23.688918Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3999.51[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:23.825273Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:24.064552Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.251157283782959[0m [36mstatement[0m=[35mSELECT portfolios.total_value_usd, portfolios.created_at 
FROM portfolios 
WHERE portfolios.user_id = $1::UUID AND portfolios.created_at >= $2::TIMESTAMP WITHOUT TIME ZONE AND portfolios.created_at <=...[0m
1 change detected
[2m2025-09-20T08:01:24.638882Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.22197651863098145[0m [36mstatement[0m=[35mSELECT exchange_balances.id, exchange_balances.account_id, exchange_balances.symbol, exchange_balances.asset_type, exchange_balances.total_balance, exchange_balances.available_balance, exchange_balanc...[0m
[2m2025-09-20T08:01:24.640875Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T08:01:24.735881Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m5.994s[0m [36mrequest_id[0m=[35m3f22fd75[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50160 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T08:01:24.785163Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:25.004405Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:25.088420Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:25.088680Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:25.296266Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20621943473815918[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
1 change detected
[2m2025-09-20T08:01:25.488623Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.39827585220336914[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:01:25.584246Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_72458c5d[0m
[2m2025-09-20T08:01:25.584489Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_e514c0b0[0m
[2m2025-09-20T08:01:25.584608Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355285841[0m [36mfallback_uses[0m=[35m11[0m [36mlocal_count[0m=[35m11[0m [36mnode_hash[0m=[35m43[0m [36mnonce[0m=[35m1758355285895[0m
[2m2025-09-20T08:01:25.870380Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:25.957447Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m868.3559894561768[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1765.6800000000003[0m
[2m2025-09-20T08:01:26.053443Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21458673477172852[0m [36mstatement[0m=[35mUPDATE exchange_balances SET is_active=$1::BOOLEAN, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE exchange_balances.account_id = $3::UUID AND (exchange_balances.symbol NOT IN ($4::VARCHAR, $5::VARC...[0m
[2m2025-09-20T08:01:26.108157Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:26.110315Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kucoin/balances[0m [36mprocess_time[0m=[35m2.286s[0m [36mrequest_id[0m=[35mb37eb73b[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:60520 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:01:26.137867Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:26.299329Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24402451515197754[0m [36mstatement[0m=[35mSELECT 1[0m
[2m2025-09-20T08:01:26.302044Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1212.9411697387695[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2284.1599999999994[0m
[2m2025-09-20T08:01:26.349797Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
/home/kopi/CryptoUniverse-fresh/app/services/market_data_feeds.py:313: RuntimeWarning: coroutine 'MarketDataFeeds._handle_api_failure' was never awaited
  self._handle_api_failure(api_name, str(e))
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
[2m2025-09-20T08:01:26.350245Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:01:26.350428Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:01:26.350548Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:01:26.631625Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_dfbd912f[0m
[2m2025-09-20T08:01:26.632067Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_8aaa28bb[0m
[2m2025-09-20T08:01:26.632231Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355286888[0m [36mfallback_uses[0m=[35m12[0m [36mlocal_count[0m=[35m12[0m [36mnode_hash[0m=[35m525[0m [36mnonce[0m=[35m1758355287425[0m
1 change detected
[2m2025-09-20T08:01:26.915483Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:26.953913Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:26.954919Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m3.471s[0m [36mrequest_id[0m=[35m54035118[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50186 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:01:26.993332Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:27.091243Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:01:28.117532Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:28.857002Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
INFO:     127.0.0.1:50186 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:01:29.348211Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:29.349079Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4259.994745254517[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T08:01:29.349509Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4260.754346847534[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4345.087289810181[0m [36mtotal_value_usd[0m=[35m4049.8399999999997[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:29.352955Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T08:01:29.656561Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3998.27[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:29.787599Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:29.996124Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:01:30.100645Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:30.101177Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:30.434059Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T08:01:30.437645Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:30.478946Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.37358641624450684[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:01:30.598711Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_659a79db[0m
[2m2025-09-20T08:01:30.599009Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_8afdee95[0m
[2m2025-09-20T08:01:30.599143Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355290855[0m [36mfallback_uses[0m=[35m13[0m [36mlocal_count[0m=[35m13[0m [36mnode_hash[0m=[35m61[0m [36mnonce[0m=[35m1758355290929[0m
[2m2025-09-20T08:01:30.649047Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:30.650176Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.513s[0m [36mrequest_id[0m=[35m79577673[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:60520 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:01:30.668963Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m5.885s[0m [36mrequest_id[0m=[35m1a24150e[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:01:30.674724Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:01:30.854298Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:31.094314Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_0a274059[0m
[2m2025-09-20T08:01:31.094616Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_e2915962[0m
[2m2025-09-20T08:01:31.094747Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355291351[0m [36mfallback_uses[0m=[35m14[0m [36mlocal_count[0m=[35m14[0m [36mnode_hash[0m=[35m334[0m [36mnonce[0m=[35m1758355291699[0m
1 change detected
[2m2025-09-20T08:01:31.279442Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1177.2937774658203[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1765.6800000000003[0m
[2m2025-09-20T08:01:31.281384Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1179.513931274414[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2283.9899999999993[0m
[2m2025-09-20T08:01:31.304017Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:31.595589Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m12.608548879623413[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:31.597441Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m12.837s[0m [36mrequest_id[0m=[35m86055bd8[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50176 - "GET /api/v1/trading/market-overview HTTP/1.1" 200 OK
[2m2025-09-20T08:01:31.649721Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:01:32.184595Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:32.721331Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
1 change detected
[2m2025-09-20T08:01:34.565993Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:34.567619Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4465.616464614868[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T08:01:34.568870Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4467.602491378784[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4572.772741317749[0m [36mtotal_value_usd[0m=[35m4049.6699999999996[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:34.569642Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T08:01:34.863476Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3998.27[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:35.025189Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:35.109315Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:01:35.110329Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.436s[0m [36mrequest_id[0m=[35m1efa1ef5[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:60520 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:01:35.376604Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T08:01:35.468112Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m5.682s[0m [36mrequest_id[0m=[35m0da086f7[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50186 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T08:01:36.653497Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:01:42.962638Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m11.098576784133911[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:42.964722Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m11.316s[0m [36mrequest_id[0m=[35ma7541e6d[0m [36mstatus_code[0m=[35m200[0m
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:01:48.415863Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m11.535962104797363[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m7[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:48.416830Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m11.765s[0m [36mrequest_id[0m=[35m265ac080[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50186 - "GET /api/v1/trading/market-overview HTTP/1.1" 200 OK
INFO:     127.0.0.1:50186 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:01:49.465549Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:01:49.684983Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:49.726547Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:01:49.813681Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:50186 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:02:04.240680Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m9f451f2e[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:02:04.241610Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m9f451f2e[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:35228 - "OPTIONS /api/v1/trading/autonomous/toggle HTTP/1.1" 200 OK
[2m2025-09-20T08:02:04.249975Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m1fc19008[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:02:04.252309Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:02:04.461989Z[0m [[32m[1minfo     [0m] [1mAutonomous mode configuration [0m [[34m[1mapp.api.v1.endpoints.trading[0m] [36menable[0m=[35mTrue[0m [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:04.503486Z[0m [[32m[1minfo     [0m] [1mü§ñ Starting autonomous mode for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mMasterSystemController[0m] [36mmode[0m=[35mbalanced[0m
[2m2025-09-20T08:02:04.503818Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable - storing autonomous config in memory[0m [[34m[1mMasterSystemController[0m] 
[2m2025-09-20T08:02:04.504073Z[0m [[32m[1minfo     [0m] [1mAutonomous mode started       [0m [[34m[1mUnifiedAIManager[0m] [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:04.504648Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mprocess_time[0m=[35m0.255s[0m [36mrequest_id[0m=[35m1fc19008[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:35228 - "POST /api/v1/trading/autonomous/toggle HTTP/1.1" 200 OK
[2m2025-09-20T08:02:14.318579Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:02:16.712486Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m181ed557[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:02:16.715564Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:02:16.953718Z[0m [[32m[1minfo     [0m] [1mAutonomous mode configuration [0m [[34m[1mapp.api.v1.endpoints.trading[0m] [36menable[0m=[35mFalse[0m [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:16.954010Z[0m [[32m[1minfo     [0m] [1müõë Stopping autonomous mode for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mMasterSystemController[0m] 
[2m2025-09-20T08:02:16.954187Z[0m [[31m[1merror    [0m] [1mFailed to stop autonomous mode[0m [[34m[1mUnifiedAIManager[0m] [36merror[0m=[35m'str' object has no attribute 'value'[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:16.955223Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mprocess_time[0m=[35m0.243s[0m [36mrequest_id[0m=[35m181ed557[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:41338 - "POST /api/v1/trading/autonomous/toggle HTTP/1.1" 200 OK
1 change detected
INFO:     127.0.0.1:41338 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:02:19.831143Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:02:20.046561Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:20.133139Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:20.221534Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:41338 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:02:26.726071Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mfa0b9145[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:02:26.728310Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:02:26.941120Z[0m [[32m[1minfo     [0m] [1mAutonomous mode configuration [0m [[34m[1mapp.api.v1.endpoints.trading[0m] [36menable[0m=[35mTrue[0m [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:27.006957Z[0m [[32m[1minfo     [0m] [1mü§ñ Starting autonomous mode for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mMasterSystemController[0m] [36mmode[0m=[35mbalanced[0m
[2m2025-09-20T08:02:27.007388Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable - storing autonomous config in memory[0m [[34m[1mMasterSystemController[0m] 
[2m2025-09-20T08:02:27.007634Z[0m [[32m[1minfo     [0m] [1mAutonomous mode started       [0m [[34m[1mUnifiedAIManager[0m] [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:27.008689Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mprocess_time[0m=[35m0.283s[0m [36mrequest_id[0m=[35mfa0b9145[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:43478 - "POST /api/v1/trading/autonomous/toggle HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:02:35.393588Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/paper-trading/setup[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m09954d0b[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:02:35.395417Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:02:35.600646Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/paper-trading/setup[0m [36mprocess_time[0m=[35m0.207s[0m [36mrequest_id[0m=[35m09954d0b[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:39900 - "POST /api/v1/paper-trading/setup HTTP/1.1" 200 OK
[2m2025-09-20T08:02:35.656297Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mde62d6b4[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:02:35.659240Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:02:35.669357Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:39904 - "GET /api/v1/paper-trading/stats HTTP/1.1" 200 OK
[2m2025-09-20T08:02:35.918063Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m8a2ff43e-fc5d-425a-ab45-7d9f0563aba9[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:35.919066Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.263s[0m [36mrequest_id[0m=[35mde62d6b4[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:39900 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T08:02:35.949696Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
INFO:     127.0.0.1:39904 - "GET /api/v1/paper-trading/stats HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:02:40.327507Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:02:40.328331Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:02:47.363279Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:02:47.869953Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
INFO:     127.0.0.1:57276 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:02:50.241140Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:02:50.461304Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:02:50.467686Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:50.512924Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:50.603021Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:57276 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:02:50.667339Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:02:50.671019Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5460.581302642822[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:02:51.784882Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35meef1fc12[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:02:51.787879Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:02:52.098555Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m3adf1d8c-2040-4635-a538-cb9b03f9e369[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:02:52.099160Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.314s[0m [36mrequest_id[0m=[35meef1fc12[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:57276 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:02:52.632494Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:02:52.997290Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:02:55.209578Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:02:55.475371Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:02:55.476599Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4804.173231124878[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:02:57.025668Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:02:57.278559Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
[2m2025-09-20T08:02:59.448900Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:02:59.605780Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:02:59.607591Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4130.155563354492[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:03:01.457307Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:03:01.818474Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
[2m2025-09-20T08:03:03.222447Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:03:03.405645Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:03:03.406934Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3797.6112365722656[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:03:04.781976Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:03:05.081925Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:03:11.966778Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:03:12.256215Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:03:12.258169Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m8850.505590438843[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:03:13.917042Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:03:14.230768Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:03:14.321025Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:03:15.825173Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:03:15.997842Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:03:15.998859Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3739.9187088012695[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:03:16.000025Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:58488 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:03:20.639473Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:03:20.845473Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:03:20.888777Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:03:20.972900Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:58488 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:03:26.736573Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:03:26.736933Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:03:26.737130Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:03:26.737312Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
INFO:     127.0.0.1:35744 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:03:50.986249Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:03:51.409887Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:03:51.458118Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:03:51.553241Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:35744 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:04:14.322807Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:55866 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:04:21.566779Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:04:21.931066Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:04:21.973452Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:04:22.060088Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:55866 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:04:40.330052Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:04:40.331065Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:60826 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:04:52.088239Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:04:52.298716Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:04:52.339249Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:04:52.421081Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:60826 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:05:14.325311Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:47720 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:05:22.444826Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:05:22.682416Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:05:22.731673Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:05:22.831917Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:47720 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:05:27.127004Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:05:27.127560Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:05:27.128101Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:05:27.128422Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
INFO:     127.0.0.1:42022 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:05:53.170006Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:05:53.386044Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:05:53.428177Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:05:53.510415Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:52864 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:06:14.326452Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:06:17.930506Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:06:18.359354Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:06:18.565550Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:06:18.566062Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 6 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:06:18.567103Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
INFO:     127.0.0.1:40838 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:06:21.083459Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:06:21.280086Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:06:21.281373Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5273.268938064575[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:06:23.294494Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:06:23.540149Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:06:23.728128Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:06:23.790185Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:06:23.838454Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:06:23.944847Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:40838 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:06:26.240655Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:06:26.528228Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:06:26.529728Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5248.010873794556[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:06:28.073279Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:06:28.329952Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:06:31.832197Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:06:32.010743Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:06:32.012251Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5481.667757034302[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:06:33.670014Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:06:34.022684Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:06:36.130630Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:06:36.647386Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:06:36.648781Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4635.625123977661[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:06:38.422721Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:06:38.710009Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:06:40.333499Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:06:40.335117Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:06:40.857960Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:06:41.029643Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:06:41.030428Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4379.4145584106445[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:06:42.579650Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:06:43.025254Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:06:45.672773Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:06:45.851851Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:06:45.853086Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4822.011470794678[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:06:45.853653Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:38482 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:06:53.972014Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:06:54.185646Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:06:54.228911Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:06:54.321003Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:38498 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:07:14.328165Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:60230 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:07:24.333799Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:07:24.763094Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:07:24.808829Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:07:24.892988Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:60242 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:07:27.516673Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:07:27.516924Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:07:27.517029Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:07:27.517252Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:35894 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:07:54.915655Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:07:55.232777Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:07:55.317733Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:07:55.409088Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:35896 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:08:14.332809Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:49628 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:08:40.336723Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:08:40.337631Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
INFO:     127.0.0.1:49636 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:09:10.529959Z[0m [[31m[1merror    [0m] [1mMetrics collector error       [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:09:14.335282Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
[2m2025-09-20T08:09:24.136989Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:09:24.198785Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:09:24.199013Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:09:24.559399Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3584136962890625[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:09:24.648783Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_05a373ab[0m
[2m2025-09-20T08:09:24.649093Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_eecd2fe4[0m
[2m2025-09-20T08:09:24.649221Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_c79d506b[0m
1 change detected
[2m2025-09-20T08:09:24.953073Z[0m [[32m[1minfo     [0m] [1mKraken server time synced     [0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36moffset[0m=[35m0.3508141040802002[0m
[2m2025-09-20T08:09:24.953517Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758355765304[0m [36mfallback_uses[0m=[35m15[0m [36mlocal_count[0m=[35m15[0m [36mnode_hash[0m=[35m264[0m [36mnonce[0m=[35m1758355765583[0m
[2m2025-09-20T08:09:25.037794Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m838.4888172149658[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2280.7000000000007[0m
[2m2025-09-20T08:09:25.163037Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:09:25.176256Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m976.9127368927002[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1762.6499999999999[0m
1 change detected
[2m2025-09-20T08:09:26.414274Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
1 change detected
[2m2025-09-20T08:09:27.949393Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:09:27.949772Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:09:27.949993Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:09:27.950188Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:09:28.664654Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:09:28.664959Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4465.613126754761[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T08:09:28.665172Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4466.130495071411[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4528.201580047607[0m [36mtotal_value_usd[0m=[35m4043.3500000000004[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:09:28.666550Z[0m [[33m[1mwarning  [0m] [1mBalance sync failed for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:09:47.533027Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:09:48.043139Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:09:50.161837Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
INFO:     127.0.0.1:59280 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:09:50.356828Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:09:50.357584Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4500.54144859314[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:09:52.118237Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:09:52.674699Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:09:55.309770Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:09:55.482242Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:09:55.483022Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5125.159740447998[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:09:56.940612Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:09:57.215962Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:09:59.282351Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:09:59.462299Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:09:59.463906Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3980.5028438568115[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:10:01.025134Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:10:01.304716Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:10:03.338202Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:10:03.641866Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:10:03.643399Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4178.902387619019[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:10:06.354728Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:10:06.650937Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:10:08.532780Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:10:08.729307Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:10:08.730900Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5086.63010597229[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:10:12.263867Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:10:12.776886Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
[2m2025-09-20T08:10:14.336467Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:10:14.827004Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:10:15.004853Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:10:15.006287Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m6274.9183177948[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:10:15.006840Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
[2m2025-09-20T08:10:40.339790Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:10:40.340782Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:59292 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:11:14.337221Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:11:28.052728Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:11:28.052946Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 7 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:11:28.053256Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:11:28.300175Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:11:28.300443Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:11:28.300572Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:11:28.300678Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
INFO:     127.0.0.1:44598 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:12:14.338181Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:12:40.342306Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:12:40.343094Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:44610 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:13:14.338842Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:13:16.633236Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:13:17.086849Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:13:19.636439Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:13:19.791630Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:13:19.792807Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4782.870531082153[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:13:21.257396Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:13:21.681381Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
[2m2025-09-20T08:13:24.795274Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:13:24.970552Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:13:24.971615Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5178.520917892456[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:13:26.395698Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:13:27.067624Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:13:28.659450Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:13:28.660592Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:13:28.661006Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:13:28.661311Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:13:28.971679Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:13:29.149529Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:13:29.150457Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4178.385972976685[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:13:30.731580Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:13:31.009256Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:13:32.968703Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:13:33.261070Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:13:33.262179Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4111.366748809814[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:13:34.741803Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:13:35.032838Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:13:37.260696Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:13:37.541491Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:13:37.542559Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4279.878377914429[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:13:38.943094Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:13:39.188575Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:13:41.152841Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:13:41.313394Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:13:41.314478Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3771.4383602142334[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:13:41.314902Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
INFO:     127.0.0.1:54566 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:14:14.340643Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:14:40.344600Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:14:40.345548Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:40212 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:15:14.342343Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:15:29.145721Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:15:29.146043Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:15:29.146285Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:15:29.146426Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
INFO:     127.0.0.1:40228 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:16:14.343406Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:16:40.348054Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:16:40.348858Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:16:42.925305Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:16:43.400781Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:16:45.964286Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:16:46.157031Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:16:46.157805Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4840.996980667114[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:16:47.716723Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:16:48.083906Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:16:50.324331Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:16:50.324767Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 8 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:16:50.325328Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
INFO:     127.0.0.1:43636 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:16:50.413594Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:16:50.616493Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:16:50.617153Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4459.137678146362[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:16:52.134085Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:16:52.410939Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:16:53.937388Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:16:54.096113Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:16:54.097021Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3479.557514190674[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:16:55.571901Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:16:55.838362Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
[2m2025-09-20T08:17:01.174470Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:17:01.330331Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:17:01.332183Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m7234.759569168091[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:17:02.888629Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:17:03.148970Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:17:04.646517Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:17:04.797582Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:17:04.798414Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3465.014696121216[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:17:06.509916Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:17:06.778707Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:17:08.664716Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:17:08.813985Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:17:08.814732Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4015.977382659912[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:17:08.815037Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
1 change detected
[2m2025-09-20T08:17:14.344817Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:17:29.576422Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:17:29.576649Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:17:29.576747Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:17:29.576832Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:43648 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:18:14.346163Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:18:24.502920Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
[2m2025-09-20T08:18:24.504298Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
1 change detected
[2m2025-09-20T08:41:02.976883Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:41:02.977258Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 9 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:41:02.977803Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
INFO:     127.0.0.1:56604 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:41:07.365043Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:41:07.367014Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
INFO:     ('127.0.0.1', 58842) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 58856) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
1 change detected
[2m2025-09-20T08:41:14.431912Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m21bf3254[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:41:14.435193Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:14.450000Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m30a24a14[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:41:14.453298Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:14.504749Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:58888 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:41:14.642393Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:14.676234Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:14.696373Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:17.832351Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3169083595275879[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:41:17.871422Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3189244270324707[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:41:17.873058Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m20b8df71-8bed-4ed8-bd10-76a76ab7a63d[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:17.874575Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m3.425s[0m [36mrequest_id[0m=[35m30a24a14[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:58874 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T08:41:17.940136Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:18.015541Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3512740135192871[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:41:18.066131Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.36685681343078613[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:41:18.073063Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/status[0m [36mprocess_time[0m=[35m3.570s[0m [36mrequest_id[0m=[35m8dd6162f[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:58876 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T08:41:18.113057Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3673112392425537[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:41:18.115099Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:18.123147Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.37299013137817383[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:41:18.134794Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m857a06a6-ab09-481b-baec-734bc3d18eda[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:18.136604Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m3.705s[0m [36mrequest_id[0m=[35m21bf3254[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:58862 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
INFO:     127.0.0.1:58876 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:41:18.216553Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:18.248954Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:18.262979Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24396896362304688[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T08:41:18.268122Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:18.363990Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:41:18.367819Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/balance[0m [36mprocess_time[0m=[35m3.673s[0m [36mrequest_id[0m=[35m2f48dd58[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:58912 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:41:18.406664Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:18.407099Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:18.475903Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20987462997436523[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:18.827800Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.338681697845459[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:18.873204Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.45203375816345215[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:19.365455Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.525334358215332[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:19.368363Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.8937008380889893[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:41:19.384416Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/list[0m [36mprocess_time[0m=[35m4.744s[0m [36mrequest_id[0m=[35m740027ab[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:41:19.451950Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m1.0294990539550781[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:19.745810Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_1d9a6052[0m
[2m2025-09-20T08:41:19.746184Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_15f3118d[0m
[2m2025-09-20T08:41:19.746487Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_b102ff18[0m
INFO:     127.0.0.1:58902 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
INFO:     127.0.0.1:58862 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T08:41:19.776861Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:19.818334Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:41:19.996290Z[0m [[32m[1minfo     [0m] [1mKraken server time synced     [0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36moffset[0m=[35m1.2536039352416992[0m
[2m2025-09-20T08:41:19.997333Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758357681250[0m [36mfallback_uses[0m=[35m16[0m [36mlocal_count[0m=[35m16[0m [36mnode_hash[0m=[35m734[0m [36mnonce[0m=[35m1758357682000[0m
[2m2025-09-20T08:41:20.236070Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1828.0856609344482[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2275.12[0m
[2m2025-09-20T08:41:20.328171Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:20.339914Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2531721591949463[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T08:41:20.392242Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.27796244621276855[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T08:41:20.562475Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21955585479736328[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:20.614415Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.22024965286254883[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:20.895365Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3290255069732666[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:21.004837Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m2596.9643592834473[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1759.3200000000002[0m
INFO:     127.0.0.1:58902 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:41:21.684206Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:22.997740Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:23.219212Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T08:41:23.220155Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T08:41:23.267440Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:23.461304Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:23.463504Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m3.656s[0m [36mrequest_id[0m=[35ma3506fee[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:58862 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:41:23.481071Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20580053329467773[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:23.483449Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:23.483853Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:23.507877Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:23.826871Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:23.834989Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3474705219268799[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:24.050857Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.45844054222106934[0m [36mstatement[0m=[35mSELECT exchange_accounts.id AS exchange_accounts_id, exchange_accounts.user_id AS exchange_accounts_user_id, exchange_accounts.exchange_name AS exchange_accounts_exchange_name, exchange_accounts.excha...[0m
[2m2025-09-20T08:41:24.054781Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3989.21[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:24.114460Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.625159740447998[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:24.562837Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_e830e373[0m
[2m2025-09-20T08:41:24.563446Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_8e031f6c[0m
[2m2025-09-20T08:41:24.563785Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758357685817[0m [36mfallback_uses[0m=[35m17[0m [36mlocal_count[0m=[35m17[0m [36mnode_hash[0m=[35m174[0m [36mnonce[0m=[35m1758357686008[0m
[2m2025-09-20T08:41:24.607631Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.5458686351776123[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
1 change detected
[2m2025-09-20T08:41:25.446367Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.6021018028259277[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:25.750100Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:25.789071Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m2304.340362548828[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1759.2800000000002[0m
[2m2025-09-20T08:41:26.060509Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m2575.5794048309326[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2274.84[0m
1 change detected
[2m2025-09-20T08:41:27.094895Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:27.218249Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T08:41:27.251747Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:27.255049Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kucoin/balances[0m [36mprocess_time[0m=[35m3.430s[0m [36mrequest_id[0m=[35m90734bce[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:37566 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:41:27.341344Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m9.403s[0m [36mrequest_id[0m=[35m81140278[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:41:27.364963Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:27.882434Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_2b4545c2[0m
[2m2025-09-20T08:41:27.882920Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_95fea500[0m
[2m2025-09-20T08:41:27.883203Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758357689136[0m [36mfallback_uses[0m=[35m18[0m [36mlocal_count[0m=[35m18[0m [36mnode_hash[0m=[35m331[0m [36mnonce[0m=[35m1758357689485[0m
[2m2025-09-20T08:41:28.110498Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:28.268043Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T08:41:28.268830Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
1 change detected
[2m2025-09-20T08:41:28.616804Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:28.619555Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m5.127s[0m [36mrequest_id[0m=[35m49f5bdbc[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:41:28.812273Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:28.874520Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2584571838378906[0m [36mstatement[0m=[35mSELECT exchange_accounts.id AS exchange_accounts_id, exchange_accounts.user_id AS exchange_accounts_user_id, exchange_accounts.exchange_name AS exchange_accounts_exchange_name, exchange_accounts.excha...[0m
[2m2025-09-20T08:41:28.880193Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3982.6300000000006[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:29.400643Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.27027058601379395[0m [36mstatement[0m=[35mSELECT exchange_balances.balance_change_24h, exchange_balances.usd_value 
FROM exchange_balances JOIN exchange_accounts ON exchange_accounts.id = exchange_balances.account_id 
WHERE exchange_accounts....[0m
[2m2025-09-20T08:41:29.411571Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:41:29.770917Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T08:41:29.859927Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.874s[0m [36mrequest_id[0m=[35mac33284d[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:58902 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T08:41:29.984201Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:30.207812Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:30.258963Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:30.259339Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:30.532889Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24599361419677734[0m [36mstatement[0m=[35mINSERT INTO exchange_balances (id, account_id, symbol, asset_type, total_balance, available_balance, locked_balance, usd_value, balance_change_24h, is_active, sync_enabled, created_at, updated_at, las...[0m
[2m2025-09-20T08:41:30.583590Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3200085163116455[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:30.779749Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.5146563053131104[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:30.974470Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_0179a849[0m
[2m2025-09-20T08:41:30.974760Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_a5f12522[0m
[2m2025-09-20T08:41:30.974903Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758357692228[0m [36mfallback_uses[0m=[35m19[0m [36mlocal_count[0m=[35m19[0m [36mnode_hash[0m=[35m874[0m [36mnonce[0m=[35m1758357693121[0m
[2m2025-09-20T08:41:30.983037Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24483919143676758[0m [36mstatement[0m=[35mINSERT INTO exchange_balances (id, account_id, symbol, asset_type, total_balance, available_balance, locked_balance, usd_value, balance_change_24h, is_active, sync_enabled, created_at, updated_at, las...[0m
1 change detected
[2m2025-09-20T08:41:31.267298Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1007.0092678070068[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1759.13[0m
[2m2025-09-20T08:41:31.415395Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:31.416719Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1156.5790176391602[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2274.8500000000004[0m
[2m2025-09-20T08:41:31.794080Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:31.891685Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:31.893265Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.531s[0m [36mrequest_id[0m=[35m5c2d359a[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:37566 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:41:32.344079Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:32.346147Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m3.536s[0m [36mrequest_id[0m=[35mbd33788a[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50678 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:41:32.383145Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:33.014754Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m15.181008577346802[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m8[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:33.016182Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m18.350s[0m [36mrequest_id[0m=[35m03e68d5c[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:58888 - "GET /api/v1/trading/market-overview HTTP/1.1" 200 OK
[2m2025-09-20T08:41:33.050027Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:33.075676Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:33.446105Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2430269718170166[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
1 change detected
[2m2025-09-20T08:41:34.523948Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:34.526207Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kucoin/balances[0m [36mprocess_time[0m=[35m2.144s[0m [36mrequest_id[0m=[35ma246dbbb[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50678 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:41:34.696880Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:34.986588Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:35.295394Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_90fdbe10[0m
[2m2025-09-20T08:41:35.295909Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_359dfa66[0m
[2m2025-09-20T08:41:35.296167Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758357696549[0m [36mfallback_uses[0m=[35m20[0m [36mlocal_count[0m=[35m20[0m [36mnode_hash[0m=[35m123[0m [36mnonce[0m=[35m1758357696692[0m
[2m2025-09-20T08:41:35.298828Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T08:41:35.299615Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T08:41:35.446616Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:35.568580Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:35.569161Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:35.619821Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:41:35.746115Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3982.230000000001[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:35.793475Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21553254127502441[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:35.936729Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.35792970657348633[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:36.129542Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_f7abd676[0m
[2m2025-09-20T08:41:36.130023Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_31f2f056[0m
[2m2025-09-20T08:41:36.131577Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758357697385[0m [36mfallback_uses[0m=[35m21[0m [36mlocal_count[0m=[35m21[0m [36mnode_hash[0m=[35m782[0m [36mnonce[0m=[35m1758357698188[0m
[2m2025-09-20T08:41:36.481622Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m910.6643199920654[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1759.1[0m
[2m2025-09-20T08:41:36.482349Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m911.8144512176514[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2274.83[0m
[2m2025-09-20T08:41:36.491686Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:36.724366Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T08:41:36.823464Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.840s[0m [36mrequest_id[0m=[35m0ddd6a7d[0m [36mstatus_code[0m=[35m200[0m
1 change detected
[2m2025-09-20T08:41:37.171561Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:37.648373Z[0m [[31m[1merror    [0m] [1mMetrics collector error       [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:41:37.693924Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:41:38.399833Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:41:39.824518Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:39.973782Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:39.974592Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m5.279s[0m [36mrequest_id[0m=[35m546515d8[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50678 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:41:40.046310Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:40.048185Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4477.2889614105225[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T08:41:40.048690Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4479.542016983032[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4602.096796035767[0m [36mtotal_value_usd[0m=[35m4033.93[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:40.049602Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
1 change detected
[2m2025-09-20T08:41:40.458752Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3982.230000000001[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:41.139222Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T08:41:41.230994Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.246s[0m [36mrequest_id[0m=[35m4732ed6d[0m [36mstatus_code[0m=[35m200[0m
1 change detected
INFO:     127.0.0.1:37566 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T08:41:41.361840Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
INFO:     127.0.0.1:37566 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:41:44.852007Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m11.40401315689087[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m9[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:44.853663Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m11.780s[0m [36mrequest_id[0m=[35m6e2ebcbb[0m [36mstatus_code[0m=[35m200[0m
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:41:48.722876Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:41:48.959271Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:49.058579Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m10.446327209472656[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m10[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:49.059891Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:49.062307Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m10.664s[0m [36mrequest_id[0m=[35maa6dc3aa[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50688 - "GET /api/v1/trading/market-overview HTTP/1.1" 200 OK
[2m2025-09-20T08:41:49.155927Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:57744 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:41:56.318229Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:56.362689Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:56.362948Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:41:56.823468Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.45896291732788086[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:41:56.974191Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_346e991e[0m
[2m2025-09-20T08:41:56.974654Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_99ac2a90[0m
[2m2025-09-20T08:41:56.974877Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758357718228[0m [36mfallback_uses[0m=[35m22[0m [36mlocal_count[0m=[35m22[0m [36mnode_hash[0m=[35m8[0m [36mnonce[0m=[35m1758357718258[0m
[2m2025-09-20T08:41:57.198995Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:41:57.266547Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m903.0764102935791[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1759.15[0m
[2m2025-09-20T08:41:57.272495Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:41:57.272788Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:41:57.272929Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:41:57.273054Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
[2m2025-09-20T08:41:57.407028Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1043.823480606079[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2275.0900000000006[0m
[2m2025-09-20T08:41:58.882226Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:42:01.339007Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:42:01.339901Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4976.587772369385[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T08:42:01.341083Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4977.996826171875[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m5022.849798202515[0m [36mtotal_value_usd[0m=[35m4034.2400000000007[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:42:01.343743Z[0m [[33m[1mwarning  [0m] [1mBalance sync failed for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:36996 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:42:19.490807Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:42:19.731334Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:42:19.780628Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:42:19.879021Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:34688 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:42:37.489643Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:42:38.205194Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:42:40.697179Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:42:40.902989Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:42:40.904303Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5074.944734573364[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:42:41.367847Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:42:42.505973Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:42:42.848832Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
INFO:     127.0.0.1:38700 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:42:44.918002Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:42:45.074980Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:42:45.076498Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4171.826362609863[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:42:46.805732Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:42:47.082633Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:42:49.033759Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:42:49.225081Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:42:49.226153Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4148.967266082764[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:42:50.405036Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:42:50.614343Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:42:50.705992Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:42:50.815198Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:56272 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:42:51.496704Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:42:51.768450Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:42:54.355849Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:42:54.699840Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:42:54.701199Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5474.605083465576[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:42:56.594672Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:42:57.241972Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:42:59.672315Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:42:59.854245Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:42:59.855962Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5153.891324996948[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:43:01.491479Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:43:01.623409Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/chat/message[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m68e9945c[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:43:01.624101Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/chat/message[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m68e9945c[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:57296 - "OPTIONS /api/v1/chat/message HTTP/1.1" 200 OK
[2m2025-09-20T08:43:01.640881Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/message[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m03a0272e[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:43:01.680222Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:43:01.925316Z[0m [[32m[1minfo     [0m] [1mProcessing unified chat message[0m [[34m[1mUnifiedChatService[0m] [36minterface[0m=[35mweb_chat[0m [36mmessage_length[0m=[35m31[0m [36mmode[0m=[35mlive_trading[0m [36msession_id[0m=[35m68c992f6-003d-4395-9125-14b49e6da889[0m [36mstream[0m=[35mFalse[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:01.926849Z[0m [[32m[1minfo     [0m] [1mGetting portfolio summary using UI method[0m [[34m[1mapp.services.chat_service_adapters_fixed[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:01.927149Z[0m [[32m[1minfo     [0m] [1mPortfolio request for user    [0m [[34m[1mapp.services.chat_service_adapters_fixed[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:01.927514Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:43:02.474609Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:43:02.688797Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:02.689058Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:03.022213Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.33068299293518066[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:43:03.237735Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.5453536510467529[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:43:03.458955Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_a41716f5[0m
[2m2025-09-20T08:43:03.459406Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_90d320f5[0m
[2m2025-09-20T08:43:03.460324Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758357784713[0m [36mfallback_uses[0m=[35m23[0m [36mlocal_count[0m=[35m23[0m [36mnode_hash[0m=[35m424[0m [36mnonce[0m=[35m1758357785160[0m
1 change detected
[2m2025-09-20T08:43:03.819652Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:43:03.942615Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1252.9520988464355[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1758.7599999999998[0m
[2m2025-09-20T08:43:03.948284Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1258.7306499481201[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2274.0200000000004[0m
[2m2025-09-20T08:43:04.772453Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:43:04.942037Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:43:04.950127Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5093.420505523682[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:43:04.951722Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T08:43:05.036838Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:43:07.370015Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:43:07.371483Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:43:07.898398Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:43:07.898996Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m5209.341764450073[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T08:43:07.899644Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m5210.481405258179[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m5972.113370895386[0m [36mtotal_value_usd[0m=[35m4032.78[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:07.948796Z[0m [[32m[1minfo     [0m] [1mReal portfolio data retrieved [0m [[34m[1mapp.services.chat_service_adapters_fixed[0m] [36mbalance_count[0m=[35m38[0m [36mexchange_count[0m=[35m3[0m [36mtotal_value[0m=[35m4032.78[0m
[2m2025-09-20T08:43:07.949389Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m4032.78[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:08.255854Z[0m [[32m[1minfo     [0m] [1mP&L calculation completed     [0m [[34m[1mapp.services.chat_service_adapters_fixed[0m] [36mduration_ms[0m=[35m306.56699999999995[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:08.259804Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for XRP from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.260343Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for ADA from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.260629Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for USDC from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.261094Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for DOGE from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.261309Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for REEF from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.261596Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for LAYER from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.262022Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for SHELL from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.262234Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for PLUME from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.262404Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for SOMI from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.262791Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for TREE from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.262993Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for TOWNS from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.263178Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for PROVE from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.263567Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for MITO from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.263777Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for DOLO from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.263961Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for OPEN from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.264342Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for LINEA from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.264536Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for HOLO from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.264734Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for ZKC from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.265189Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for AVNT from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.265379Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for BARD from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.265704Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for AAVE from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.266168Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for SOL from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.266410Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for XRP from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.266581Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for KCS from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.266913Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for SHIB from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.267082Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for ETHW from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.267241Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for VTHO from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.267559Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for ADA from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.267725Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for VTHO from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.267876Z[0m [[33m[1mwarning  [0m] [1mFailed to get volatility for KCS from market analysis: 'PortfolioRiskServiceExtended' object has no attribute 'market_analysis'[0m [[34m[1mapp.services.portfolio_risk_core[0m] 
[2m2025-09-20T08:43:08.268339Z[0m [[32m[1minfo     [0m] [1mRisk analysis completed       [0m [[34m[1mapp.services.chat_service_adapters_fixed[0m] [36mduration_ms[0m=[35m12.116999999999999[0m [36mrisk_level[0m=[35mLOW[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:08.268536Z[0m [[32m[1minfo     [0m] [1mENTERPRISE Portfolio: $4,032.78 across 2 exchanges, Risk: LOW[0m [[34m[1mapp.services.chat_service_adapters_fixed[0m] 
[2m2025-09-20T08:43:08.269922Z[0m [[32m[1minfo     [0m] [1müîç ENTERPRISE User Opportunity Discovery Starting[0m [[34m[1mUserOpportunityDiscoveryService[0m] [36mforce_refresh[0m=[35mFalse[0m [36mscan_id[0m=[35muser_discovery_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758357788[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:08.272348Z[0m [[32m[1minfo     [0m] [1mRedis client initialized for opportunity discovery[0m [[34m[1mUserOpportunityDiscoveryService[0m] 
[2m2025-09-20T08:43:08.274479Z[0m [[32m[1minfo     [0m] [1müîç Starting comprehensive exchange discovery[0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] 
[2m2025-09-20T08:43:08.794644Z[0m [[33m[1mwarning  [0m] [1mCoinMarketCap API key not configured[0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] 
1 change detected
[2m2025-09-20T08:43:09.533513Z[0m [[33m[1mwarning  [0m] [1mSource returned error         [0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] [36msource[0m=[35mcoinmarketcap_exchanges[0m [36mstatus[0m=[35m401[0m
1 change detected
1 change detected
[2m2025-09-20T08:43:11.902865Z[0m [[33m[1mwarning  [0m] [1mSource returned error         [0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] [36msource[0m=[35mexchange_registry[0m [36mstatus[0m=[35m404[0m
[2m2025-09-20T08:43:11.903478Z[0m [[32m[1minfo     [0m] [1müß™ Testing exchange compatibility[0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] [36mmax_concurrent[0m=[35m10[0m [36mtotal_exchanges[0m=[35m239[0m
1 change detected
1 change detected
INFO:     127.0.0.1:40160 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:43:21.271270Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:43:21.702670Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:21.755853Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:21.856548Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:42944 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:43:29.681587Z[0m [[32m[1minfo     [0m] [1m‚úÖ Compatibility testing completed[0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] [36mcompatible[0m=[35m0[0m [36mtested[0m=[35m239[0m
[2m2025-09-20T08:43:29.681895Z[0m [[33m[1mwarning  [0m] [1mFailed to cache discovery results[0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] [36merror[0m=[35m'NoneType' object has no attribute 'set'[0m
[2m2025-09-20T08:43:29.682019Z[0m [[32m[1minfo     [0m] [1m‚úÖ Exchange discovery completed[0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] [36mcompatible[0m=[35m0[0m [36mtotal[0m=[35m239[0m
[2m2025-09-20T08:43:29.682654Z[0m [[32m[1minfo     [0m] [1müîÑ Dynamic exchange query completed[0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] [36mfilters_applied[0m=[35mTrue[0m [36mtotal_available[0m=[35m95[0m
[2m2025-09-20T08:43:29.683295Z[0m [[32m[1minfo     [0m] [1m‚úÖ Exchange loading completed with static priority[0m [[34m[1mEnterpriseAssetFilter[0m] [36mdynamic_exchanges[0m=[35m53[0m [36mstatic_exchanges[0m=[35m10[0m [36mtotal_exchanges[0m=[35m60[0m
[2m2025-09-20T08:43:29.683490Z[0m [[32m[1minfo     [0m] [1m‚úÖ Dynamic exchange loading completed[0m [[34m[1mEnterpriseAssetFilter[0m] [36mdynamic_count[0m=[35m53[0m [36mtotal_loaded[0m=[35m60[0m
[2m2025-09-20T08:43:29.683665Z[0m [[32m[1minfo     [0m] [1müîß Enterprise Asset Filter initialized with dynamic exchanges[0m [[34m[1mEnterpriseAssetFilter[0m] [36mtotal_exchanges[0m=[35m60[0m
[2m2025-09-20T08:43:29.683876Z[0m [[32m[1minfo     [0m] [1müéØ User Opportunity Discovery Service initialized[0m [[34m[1mUserOpportunityDiscoveryService[0m] 
[2m2025-09-20T08:43:29.684623Z[0m [[31m[1merror    [0m] [1mFailed to get user strategy portfolio[0m [[34m[1mStrategyMarketplaceService[0m] [36merror[0m=[35mmodule 'asyncio' has no attribute 'timeout'[0m
[2m2025-09-20T08:43:29.688384Z[0m [[32m[1minfo     [0m] [1mUser has no active strategies, triggering automatic onboarding[0m [[34m[1mUserOpportunityDiscoveryService[0m] [36mscan_id[0m=[35muser_discovery_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758357788[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:29.899794Z[0m [[31m[1merror    [0m] [1mOnboarding status check failed[0m [[34m[1mUserOnboardingService[0m] [36merror[0m=[35m'CreditAccount' object has no attribute 'total_earned_credits'[0m
[2m2025-09-20T08:43:29.900509Z[0m [[32m[1minfo     [0m] [1mTriggering automatic onboarding[0m [[34m[1mUserOnboardingService[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:29.900930Z[0m [[32m[1minfo     [0m] [1müöÄ ENTERPRISE User Onboarding Starting[0m [[34m[1mUserOnboardingService[0m] [36monboarding_id[0m=[35monboard_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758338009[0m [36mpackage[0m=[35mstandard[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:43:30.278674Z[0m [[32m[1minfo     [0m] [1mUser already onboarded, skipping[0m [[34m[1mUserOnboardingService[0m] [36monboarding_id[0m=[35monboard_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758338009[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:30.279172Z[0m [[32m[1minfo     [0m] [1müéØ User automatically onboarded with free strategies[0m [[34m[1mUserOpportunityDiscoveryService[0m] [36mscan_id[0m=[35muser_discovery_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758357788[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:30.279354Z[0m [[32m[1minfo     [0m] [1müîç ENTERPRISE User Opportunity Discovery Starting[0m [[34m[1mUserOpportunityDiscoveryService[0m] [36mforce_refresh[0m=[35mTrue[0m [36mscan_id[0m=[35muser_discovery_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758357810[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:30.279545Z[0m [[32m[1minfo     [0m] [1mRedis client initialized for opportunity discovery[0m [[34m[1mUserOpportunityDiscoveryService[0m] 
Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x773b545fb880>
[2m2025-09-20T08:43:30.281330Z[0m [[32m[1minfo     [0m] [1müîÑ Dynamic exchange query completed[0m [[34m[1mapp.services.dynamic_exchange_discovery[0m] [36mfilters_applied[0m=[35mTrue[0m [36mtotal_available[0m=[35m95[0m
[2m2025-09-20T08:43:30.282787Z[0m [[32m[1minfo     [0m] [1m‚úÖ Exchange loading completed with static priority[0m [[34m[1mEnterpriseAssetFilter[0m] [36mdynamic_exchanges[0m=[35m53[0m [36mstatic_exchanges[0m=[35m10[0m [36mtotal_exchanges[0m=[35m60[0m
[2m2025-09-20T08:43:30.283206Z[0m [[32m[1minfo     [0m] [1m‚úÖ Dynamic exchange loading completed[0m [[34m[1mEnterpriseAssetFilter[0m] [36mdynamic_count[0m=[35m53[0m [36mtotal_loaded[0m=[35m60[0m
[2m2025-09-20T08:43:30.283444Z[0m [[32m[1minfo     [0m] [1müîß Enterprise Asset Filter initialized with dynamic exchanges[0m [[34m[1mEnterpriseAssetFilter[0m] [36mtotal_exchanges[0m=[35m60[0m
[2m2025-09-20T08:43:30.283721Z[0m [[32m[1minfo     [0m] [1müéØ User Opportunity Discovery Service initialized[0m [[34m[1mUserOpportunityDiscoveryService[0m] 
[2m2025-09-20T08:43:30.284338Z[0m [[31m[1merror    [0m] [1mFailed to get user strategy portfolio[0m [[34m[1mStrategyMarketplaceService[0m] [36merror[0m=[35mmodule 'asyncio' has no attribute 'timeout'[0m
[2m2025-09-20T08:43:30.284770Z[0m [[32m[1minfo     [0m] [1mUser has no active strategies, triggering automatic onboarding[0m [[34m[1mUserOpportunityDiscoveryService[0m] [36mscan_id[0m=[35muser_discovery_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758357810[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:30.537595Z[0m [[31m[1merror    [0m] [1mOnboarding status check failed[0m [[34m[1mUserOnboardingService[0m] [36merror[0m=[35m'CreditAccount' object has no attribute 'total_earned_credits'[0m
[2m2025-09-20T08:43:30.538084Z[0m [[32m[1minfo     [0m] [1mTriggering automatic onboarding[0m [[34m[1mUserOnboardingService[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:30.538416Z[0m [[32m[1minfo     [0m] [1müöÄ ENTERPRISE User Onboarding Starting[0m [[34m[1mUserOnboardingService[0m] [36monboarding_id[0m=[35monboard_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758338010[0m [36mpackage[0m=[35mstandard[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:30.855233Z[0m [[32m[1minfo     [0m] [1mUser already onboarded, skipping[0m [[34m[1mUserOnboardingService[0m] [36monboarding_id[0m=[35monboard_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758338010[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:30.855807Z[0m [[32m[1minfo     [0m] [1müéØ User automatically onboarded with free strategies[0m [[34m[1mUserOpportunityDiscoveryService[0m] [36mscan_id[0m=[35muser_discovery_7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af_1758357810[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:43:41.369293Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:50310 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:43:46.125749Z[0m [[32m[1minfo     [0m] [1mChatGPT response generated    [0m [[34m[1mChatAIService[0m] [36mcost[0m=[35m$0.0308[0m [36melapsed_time[0m=[35m15.27s[0m [36mmodel[0m=[35mgpt-4[0m [36mtokens[0m=[35m665[0m
[2m2025-09-20T08:43:46.126288Z[0m [[31m[1merror    [0m] [1mFailed to save conversation   [0m [[34m[1mUnifiedChatService[0m] [36merror[0m=[35m'ChatMemoryService' object has no attribute 'add_message'[0m
[2m2025-09-20T08:43:46.127728Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/message[0m [36mprocess_time[0m=[35m44.487s[0m [36mrequest_id[0m=[35m03a0272e[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:57296 - "POST /api/v1/chat/message HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:43:52.220698Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:43:52.437277Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:52.478909Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:43:52.563972Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:38920 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:43:57.756457Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:43:57.756700Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:43:57.756822Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:43:57.756930Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:38558 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:44:22.619911Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:44:22.826849Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:44:22.867943Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:44:22.952905Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:38562 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:44:41.371187Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:58724 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:44:52.992510Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:44:53.230733Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:44:53.278630Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:44:53.372581Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:58732 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:45:07.373214Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:45:07.374707Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:33658 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:45:23.707172Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:45:23.954884Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:45:24.050872Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:45:24.146992Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:41632 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:45:41.372778Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:51136 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:45:54.488948Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:45:54.699806Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:45:54.742266Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:45:54.824250Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:50508 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:45:58.145921Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:45:58.146481Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:45:58.146694Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:45:58.146855Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:45:59.452168Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:46:00.281085Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 45, 59, 943732), datetime.datetime(2025, 9, 20, 8, 45, 59, 943732), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:00.282178Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:00.282868Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfutures_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:00.283500Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.283784Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.283985Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.284177Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.284556Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.284841Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.285029Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.285215Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.285669Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.285972Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.286183Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.286384Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.286763Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.287033Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.287257Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.287460Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.287815Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.288072Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.288265Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.288454Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.288800Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.289061Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.289255Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.289516Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:00.896344Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 0, 542902), datetime.datetime(2025, 9, 20, 8, 46, 0, 542902), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:00.896842Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:00.897747Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:00.898386Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.898755Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.899777Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.900196Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.900864Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.901073Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.901180Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.901286Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.901633Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.901839Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.901942Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.902038Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.902216Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.902341Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.902431Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.902521Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.902690Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.902813Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.902903Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.902991Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:00.903156Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:00.903295Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.903386Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:00.903475Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:01.486301Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 1, 144207), datetime.datetime(2025, 9, 20, 8, 46, 1, 144207), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'perpetual_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:01.486593Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:01.486891Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mperpetual_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:01.487180Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:01.487338Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.487522Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.487635Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:01.487870Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:01.488015Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.488119Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.488219Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:01.488411Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:01.488548Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.488648Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.488745Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:01.488930Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:01.489064Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.489162Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.489258Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:01.489508Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:01.489667Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.489767Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.489865Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:01.490052Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:01.490185Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.490283Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:01.490380Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:02.044423Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 1, 700929), datetime.datetime(2025, 9, 20, 8, 46, 1, 700929), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'leverage_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:02.045834Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:02.047163Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mleverage_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:02.047891Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.048234Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.048457Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.048735Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.049871Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.050490Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.050733Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.050858Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.051106Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.051246Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.051344Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.051439Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.051680Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.051817Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.051910Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.052002Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.052174Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.052300Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.052405Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.052503Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.052686Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.052820Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.052918Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.053147Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.624069Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 2, 289479), datetime.datetime(2025, 9, 20, 8, 46, 2, 289479), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'complex_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:02.624556Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:02.625127Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcomplex_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:02.626004Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.626511Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.626839Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.627077Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.627577Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.627973Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.630154Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.631085Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.631514Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.631694Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.631803Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.631908Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.632098Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.632232Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.632331Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.632427Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.632604Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.632733Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.632832Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.632945Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:02.633122Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:02.633247Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.633341Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:02.633616Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:03.199063Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 2, 844040), datetime.datetime(2025, 9, 20, 8, 46, 2, 844040), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'margin_status')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:03.199636Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:03.210478Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmargin_status[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:03.213250Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:46:03.214712Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 10 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:46:03.215848Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:46:03.216312Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.217064Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.217709Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.218039Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.218608Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.218978Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.219181Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.219375Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.219689Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.219905Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.220063Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.220252Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.220532Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.220721Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.220878Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.221028Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.221290Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.221612Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.221767Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.221937Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.222207Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.222413Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.222562Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.222714Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:03.804535Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 3, 464167), datetime.datetime(2025, 9, 20, 8, 46, 3, 464167), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'funding_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:03.805100Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:03.805817Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfunding_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:03.806387Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.806697Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.806904Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.807105Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.807561Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.807836Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.808078Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.808275Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.808649Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.808913Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.809103Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.809288Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.809818Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.810107Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.810299Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.810623Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.811325Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.812252Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.812970Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.814460Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:03.815066Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:03.815387Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.815609Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:03.815820Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.371221Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 4, 30032), datetime.datetime(2025, 9, 20, 8, 46, 4, 30032), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'basis_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:04.371612Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:04.371965Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mbasis_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:04.372290Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.372448Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.372557Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.372662Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.372858Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.372996Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.373096Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.373195Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.373381Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.373598Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.373694Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.373784Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.373959Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.374082Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.374186Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.374276Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.374444Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.374604Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.374768Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.374962Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.375312Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.375561Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.375750Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.375935Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:04.975134Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 4, 627408), datetime.datetime(2025, 9, 20, 8, 46, 4, 627408), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_chain')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:04.975629Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:04.976163Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_chain[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:04.976450Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.976601Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.976707Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.976807Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.977069Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.977386Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.977969Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.978454Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.979452Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.979870Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.980163Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.980467Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.981121Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.981677Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.982000Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.982299Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.982921Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.983254Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.983389Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.983504Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:04.983933Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:04.984559Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.984753Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:04.984883Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:05.936183Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 5, 217955), datetime.datetime(2025, 9, 20, 8, 46, 5, 217955), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'calculate_greeks')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:05.936513Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:05.936818Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcalculate_greeks[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:05.937844Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:05.938523Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.938767Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.938964Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:05.939379Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:05.939660Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.939842Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.940183Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:05.940833Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:05.941176Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.941554Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.941801Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:05.942285Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:05.942567Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.942772Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.949738Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:05.951228Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:05.952156Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.952475Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.952832Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:05.953346Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:05.953770Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.953979Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:05.954185Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:06.539349Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:46:06.646838Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 6, 279192), datetime.datetime(2025, 9, 20, 8, 46, 6, 279192), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'liquidation_price')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:06.647410Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:06.647990Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mliquidation_price[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:06.648576Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:06.648871Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.649066Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.649253Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:06.649728Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:06.650013Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.650215Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.650423Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:06.650835Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:06.651110Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.651335Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.651537Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:06.651906Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:06.652168Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.652370Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.652574Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:06.652992Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:06.653253Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.653510Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.653724Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:06.655276Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:06.656280Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.656630Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:06.656869Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.200234Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 6, 861079), datetime.datetime(2025, 9, 20, 8, 46, 6, 861079), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'hedge_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:07.200897Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:07.201565Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mhedge_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:07.202085Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.202347Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.202534Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.202714Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.203043Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.203278Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.203589Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.203792Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.204167Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.204654Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.204949Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.205146Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.205542Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.205822Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.206022Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.206217Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.206575Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.206842Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.207038Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.207289Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.207666Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.207911Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.208089Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.208264Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.274861Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:46:07.877320Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 7, 482952), datetime.datetime(2025, 9, 20, 8, 46, 7, 482952), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:07.878435Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:07.880000Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_momentum_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:07.880757Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.881274Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.881712Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.881998Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.883012Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.884087Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.884461Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.884761Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.885142Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.885378Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.885590Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.885770Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.886187Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.886501Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.886716Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.886933Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.887392Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.887685Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.887949Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.888158Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:07.888555Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:07.889281Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.889644Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:07.889887Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:08.486860Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.47188496589660645[0m [36mstatement[0m=[35mSELECT trades.id, trades.user_id, trades.exchange_account_id, trades.strategy_id, trades.position_id, trades.symbol, trades.action, trades.status, trades.quantity, trades.price, trades.executed_quanti...[0m
[2m2025-09-20T08:46:08.832747Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 8, 488273), datetime.datetime(2025, 9, 20, 8, 46, 8, 488273), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_mean_reversion')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:08.833208Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:08.833723Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_mean_reversion[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:08.834174Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:08.834428Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.834611Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.834794Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:08.835159Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:08.835396Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.835575Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.835757Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:08.836087Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:08.836329Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.836515Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.836695Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:08.837020Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:08.837254Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.837483Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.837706Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:08.838097Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:08.838360Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.838552Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.838743Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:08.839091Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:08.839909Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.840140Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:08.840350Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:09.422272Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 9, 81674), datetime.datetime(2025, 9, 20, 8, 46, 9, 81674), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_breakout_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:09.422635Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:09.422947Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_breakout_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:09.423213Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:09.423358Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.423475Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.423659Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:09.423879Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:09.424021Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.424122Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.424222Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:09.424438Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:09.424578Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.424677Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.424775Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:09.424989Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:09.425124Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.425221Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.425316Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:09.425578Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:09.425739Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.425839Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.425936Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:09.426124Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:09.426257Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.426354Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.426450Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:09.995304Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 9, 644484), datetime.datetime(2025, 9, 20, 8, 46, 9, 644484), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'algorithmic_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:09.996565Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:09.997122Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35malgorithmic_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:09.997875Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:09.998328Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.998612Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:09.999132Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:09.999868Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.000373Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.000611Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.000806Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.001175Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.001520Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.001764Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.001956Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.002327Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.002580Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.002763Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.002941Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.003274Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.003519Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.003700Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.003897Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.004223Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.004734Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.004981Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.005183Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.096159Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:46:10.274936Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:46:10.275899Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5321.267604827881[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:46:10.586538Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 10, 248172), datetime.datetime(2025, 9, 20, 8, 46, 10, 248172), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:10.587148Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:10.587706Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mpairs_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:10.588216Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.588506Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.588706Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.588915Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.589289Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.589646Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.589870Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.590071Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.590476Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.590799Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.590996Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.591189Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.591538Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.591770Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.591948Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.592133Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.592477Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.592824Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.593048Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.593259Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:10.595919Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:10.596667Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.597037Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:10.597211Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:11.501795Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 10, 802330), datetime.datetime(2025, 9, 20, 8, 46, 10, 802330), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:11.502111Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:11.502384Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstatistical_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:11.502689Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:11.502942Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.503056Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.503179Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:11.503418Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:11.503575Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.503675Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.503771Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:11.503955Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:11.504088Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.504183Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.504280Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:11.504464Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:11.505005Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.505114Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.505216Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:11.505506Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:11.505793Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.505967Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.506138Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:11.506433Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:11.506643Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.506805Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:11.506972Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:12.145330Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 11, 757657), datetime.datetime(2025, 9, 20, 8, 46, 11, 757657), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:12.146947Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:12.147519Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmarket_making[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:12.148134Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.148546Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.148711Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.148861Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.149360Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.150444Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.150779Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.151100Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.151522Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.151781Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.151974Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.152159Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.152532Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.152784Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.152974Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.153164Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.153551Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.153828Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.154025Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.154217Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.154578Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.154826Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.155010Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.155195Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.274490Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:46:12.758303Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 12, 417262), datetime.datetime(2025, 9, 20, 8, 46, 12, 417262), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'scalping_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:12.758761Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:12.759206Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mscalping_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:12.759866Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.760195Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.760408Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.760624Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.761617Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.762039Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.762250Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.762433Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.762828Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.763163Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.763460Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.763696Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.764393Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.764796Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.765116Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.765333Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.765888Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.767765Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.768057Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.768275Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.768726Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:12.768988Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.769187Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:12.769375Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:12.872964Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:46:13.392494Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 13, 21220), datetime.datetime(2025, 9, 20, 8, 46, 13, 21220), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'swing_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:13.392871Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:13.393631Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mswing_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:13.394367Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:13.394796Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.395754Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.396293Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:13.396773Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:13.397091Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.397278Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.397553Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:13.397921Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:13.398182Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.398353Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.398518Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:13.398822Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:13.399068Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.399220Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.399370Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:13.399675Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:13.399914Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.400088Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.400241Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:13.400627Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:13.400879Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.401108Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:13.401283Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:13.998011Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 13, 607862), datetime.datetime(2025, 9, 20, 8, 46, 13, 607862), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'position_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:13.998504Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:13.999033Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mposition_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:13.999764Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.000034Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.000356Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.000531Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.000786Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.001061Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.001284Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.001553Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.001954Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.002259Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.002415Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.002526Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.002740Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.002875Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.002970Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.003063Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.003244Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.003373Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.003467Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.003559Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.003739Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.003865Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.003958Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.004049Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
INFO:     127.0.0.1:53446 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:46:14.595603Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 14, 250692), datetime.datetime(2025, 9, 20, 8, 46, 14, 250692), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:14.596161Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:14.596702Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mrisk_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:14.597346Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.597947Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.598339Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.598648Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.599067Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.599442Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.599684Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.600080Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.600790Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.601145Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.601385Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.601700Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.602101Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.602408Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.602649Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.602872Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.603296Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.603560Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.603765Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.603961Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.604286Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:14.604598Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.604817Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:14.605026Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:14.675855Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:46:14.854650Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:46:14.855962Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4579.665422439575[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:46:15.157710Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 14, 813835), datetime.datetime(2025, 9, 20, 8, 46, 14, 813835), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:15.158483Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:15.159122Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mportfolio_optimization[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:15.159893Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:15.160335Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.160691Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.161290Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:15.162194Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:15.162561Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.162795Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.163074Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:15.163621Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:15.164002Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.164264Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.164484Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:15.164872Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:15.165090Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.165263Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.165488Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:15.166087Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:15.166532Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.166761Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.166992Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:15.167447Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:15.167782Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.168046Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:15.168480Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:16.186812Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 46, 15, 410236), datetime.datetime(2025, 9, 20, 8, 46, 15, 410236), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'strategy_performance')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:46:16.187234Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:46:16.187655Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstrategy_performance[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:46:16.188090Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:16.188312Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.188494Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.188691Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:16.189053Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:16.189307Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.189564Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.189782Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:16.190105Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:16.190292Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.190402Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.190498Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:16.190718Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:16.190857Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.190951Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.191042Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:16.191219Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:16.191346Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.191486Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.191582Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:46:16.191757Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:46:16.191881Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.191970Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:46:16.192059Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:46:16.643857Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20786809921264648[0m [36mstatement[0m=[35mSELECT CAST($1 AS TEXT) AS anon_1, CAST($2 AS VARCHAR(50)) AS anon_2, CAST($3 AS JSON) AS anon_3, trading_strategies.id, trading_strategies.user_id, trading_strategies.name, trading_strategies.descrip...[0m
[2m2025-09-20T08:46:16.675328Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/strategies/marketplace[0m [36mprocess_time[0m=[35m17.225s[0m [36mrequest_id[0m=[35ma2ede671[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:50508 - "GET /api/v1/strategies/marketplace?sort_by=performance&include_performance=true HTTP/1.1" 200 OK
[2m2025-09-20T08:46:16.811226Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:46:17.220751Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:46:20.438334Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:46:20.600678Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:46:20.603941Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5747.091770172119[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:46:22.915329Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:46:23.255850Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:46:25.167764Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:46:25.294119Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:46:25.497176Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:46:25.498789Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4893.922328948975[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:46:25.616029Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:46:25.680309Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:46:25.785586Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:39100 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:46:27.020548Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:46:27.281936Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:46:29.743004Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:46:29.920935Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:46:29.922362Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4422.903776168823[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:46:31.732948Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:46:32.178235Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:46:34.102586Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:46:34.423300Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:46:34.425496Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4502.399921417236[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:46:34.426952Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T08:46:41.373455Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:39102 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:46:56.147704Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:46:56.575390Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:46:56.623893Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:46:56.722867Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:46896 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:47:07.376066Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:47:07.376922Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:46902 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:47:16.710466Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:47:18.158346Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 17, 640965), datetime.datetime(2025, 9, 20, 8, 47, 17, 640965), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:18.158903Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:18.159313Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfutures_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:18.159646Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.159802Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.159908Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.160027Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.160229Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.160365Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.160527Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.160640Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.160839Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.160978Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.161131Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.161296Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.161700Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.161975Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.162157Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.162318Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.162620Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.162848Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.163007Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.163165Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.163458Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.163678Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.163841Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.164008Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:18.782556Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 18, 451845), datetime.datetime(2025, 9, 20, 8, 47, 18, 451845), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:18.783059Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:18.783600Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:18.784095Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.784398Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.784603Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.784801Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.785148Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.785487Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.786266Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.786528Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.786956Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.787277Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.787509Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.787736Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.788091Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.788322Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.788498Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.788661Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.788938Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.789145Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.789299Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.789509Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:18.789853Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:18.790073Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.790217Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:18.790377Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.280617Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 18, 993567), datetime.datetime(2025, 9, 20, 8, 47, 18, 993567), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'perpetual_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:19.281074Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:19.281569Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mperpetual_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:19.282045Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.282305Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.282518Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.282699Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.283059Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.283301Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.283479Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.283734Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.284094Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.284345Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.284536Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.284724Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.285067Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.285318Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.285541Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.285733Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.286085Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.286339Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.286528Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.286718Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.287068Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.287389Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.287661Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.287920Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:19.853038Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 19, 524846), datetime.datetime(2025, 9, 20, 8, 47, 19, 524846), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'leverage_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:19.853606Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:19.854101Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mleverage_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:19.854671Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.855057Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.855337Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.855551Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.855893Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.856125Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.856304Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.856492Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.856719Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.856860Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.856958Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.857054Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.857231Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.857360Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.857559Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.857824Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.858346Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.858707Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.858991Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.859213Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:19.859955Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:19.860617Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.861055Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:19.861360Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.368554Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 20, 62276), datetime.datetime(2025, 9, 20, 8, 47, 20, 62276), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'complex_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:20.369030Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:20.369542Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcomplex_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:20.370151Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.370610Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.370990Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.371343Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.372257Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.372727Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.372989Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.373352Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.374013Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.374357Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.374678Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.374941Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.375522Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.375995Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.376906Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.377162Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.377684Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.378057Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.378294Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.378481Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.379035Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.379304Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.379604Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.379830Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:20.966762Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 20, 625375), datetime.datetime(2025, 9, 20, 8, 47, 20, 625375), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'margin_status')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:20.967219Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:20.967692Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmargin_status[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:20.968179Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.968471Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.968686Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.968897Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.969270Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.969652Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.969894Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.970215Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.970788Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.971265Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.971911Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.972245Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.972849Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.973431Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.973809Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.974004Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.974286Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.974458Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.974567Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.974675Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:20.975050Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:20.975205Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.975303Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:20.975401Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:21.476332Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 21, 180946), datetime.datetime(2025, 9, 20, 8, 47, 21, 180946), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'funding_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:21.476777Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:21.477197Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfunding_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:21.477757Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:21.478010Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.478192Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.478370Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:21.478694Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:21.478925Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.479100Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.479276Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:21.479594Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:21.479824Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.479997Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.480172Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:21.480486Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:21.480740Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.480916Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.481086Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:21.481446Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:21.481719Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.481927Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.482149Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:21.482500Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:21.482750Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.482935Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:21.483120Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:22.119582Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 21, 719959), datetime.datetime(2025, 9, 20, 8, 47, 21, 719959), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'basis_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:22.119874Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:22.120342Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mbasis_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:22.120981Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.121604Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.122027Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.122296Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.122767Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.123119Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.123348Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.123590Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.124062Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.124566Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.124831Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.125057Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.125580Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.125906Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.126104Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.126298Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.126717Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.126970Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.127159Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.127348Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.127695Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.128014Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.128214Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.128406Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.620035Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 22, 331202), datetime.datetime(2025, 9, 20, 8, 47, 22, 331202), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_chain')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:22.620717Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:22.621230Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_chain[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:22.621782Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.622034Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.622216Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.622399Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.622747Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.622981Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.623154Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.623327Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.623642Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.623870Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.624043Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.624215Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.624528Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.624753Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.624930Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.625107Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.625473Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.625779Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.625959Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.626136Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:22.626421Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:22.626645Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.626882Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:22.627042Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:23.206934Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 22, 868183), datetime.datetime(2025, 9, 20, 8, 47, 22, 868183), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'calculate_greeks')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:23.207347Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:23.207704Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcalculate_greeks[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:23.208029Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.208210Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.208493Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.208610Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.208824Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.208969Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.209074Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.209173Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.209364Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.209681Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.209790Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.209908Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.210107Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.210245Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.210343Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.210439Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.210623Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.210757Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.210855Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.210950Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.211130Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.211262Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.211358Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.211453Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:23.702025Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 23, 415915), datetime.datetime(2025, 9, 20, 8, 47, 23, 415915), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'liquidation_price')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:23.702339Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:23.702629Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mliquidation_price[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:23.702925Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.703123Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.703247Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.703436Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.703750Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.703890Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.703984Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.704075Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.704250Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.704388Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.704478Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.704570Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.704751Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.704877Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.704967Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.705057Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.705231Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.705353Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.705505Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.705601Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:23.705774Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:23.705900Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.706048Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:23.706249Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.278293Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 23, 947059), datetime.datetime(2025, 9, 20, 8, 47, 23, 947059), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'hedge_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:24.278828Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:24.279280Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mhedge_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:24.279775Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.280066Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.280250Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.280430Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.280788Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.281036Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.281234Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.281442Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.281806Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.282057Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.282237Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.282418Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.282748Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.282977Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.283149Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.283321Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.283635Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.283893Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.284124Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.284316Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.284657Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.284857Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.285093Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.285328Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:24.785888Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 24, 493568), datetime.datetime(2025, 9, 20, 8, 47, 24, 493568), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:24.786234Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:24.786687Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_momentum_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:24.787132Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.787313Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.787430Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.787543Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.787746Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.787895Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.788001Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.788106Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.788298Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.788466Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.788572Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.788676Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.788889Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.789050Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.789251Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.789483Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.789851Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.790035Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.790165Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.790291Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:24.790493Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:24.790624Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.790762Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:24.790957Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.372247Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 25, 33303), datetime.datetime(2025, 9, 20, 8, 47, 25, 33303), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_mean_reversion')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:25.372872Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:25.373716Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_mean_reversion[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:25.374191Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.374513Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.374739Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.374965Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.375366Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.375646Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.375818Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.375988Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.376269Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.376414Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.376513Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.376606Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.376781Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.376906Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.376996Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.377085Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.377270Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.377424Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.377565Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.377661Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.377837Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.377960Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.378049Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.378138Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:25.887210Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 25, 588606), datetime.datetime(2025, 9, 20, 8, 47, 25, 588606), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_breakout_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:25.887940Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:25.888684Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_breakout_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:25.889487Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.889983Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.890287Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.890549Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.891056Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.891637Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.891915Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.892220Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.892744Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.893001Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.893231Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.893576Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.894017Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.894283Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.894486Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.894678Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.895041Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.895295Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.895488Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.895678Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:25.896022Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:25.896268Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.896459Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:25.896648Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:26.480805Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 26, 139161), datetime.datetime(2025, 9, 20, 8, 47, 26, 139161), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'algorithmic_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:26.481149Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:26.481576Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35malgorithmic_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:26.481901Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:26.482069Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.482189Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.482304Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:26.482617Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:26.482771Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.482902Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.483013Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:26.483220Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:26.483368Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.483476Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.483580Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:26.483781Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:26.483927Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.484033Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.484138Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:26.484337Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:26.484481Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.484623Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.484734Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:26.484935Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:26.485079Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.485184Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:26.485289Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.010321Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 26, 723579), datetime.datetime(2025, 9, 20, 8, 47, 26, 723579), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:27.010654Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:27.010966Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mpairs_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:27.011269Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.011432Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.011545Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.011653Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.011857Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.012003Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.012109Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.012212Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.012406Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.012548Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.012650Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.012750Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.012940Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.013078Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.013192Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.013296Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.013668Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.013934Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.014108Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.014288Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.014571Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.014796Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.014947Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.015095Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.077797Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:47:27.312926Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:47:27.360327Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:47:27.454262Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:53922 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:47:27.543506Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 27, 254599), datetime.datetime(2025, 9, 20, 8, 47, 27, 254599), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:27.543866Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:27.544194Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstatistical_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:27.544536Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.544720Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.544849Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.544974Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.545203Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.545369Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.545611Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.545878Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.546170Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.546404Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.546540Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.546659Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.546920Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.547126Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.547253Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.547371Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.547595Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.547757Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.547876Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.547990Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:27.548211Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:27.548371Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.548487Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:27.548602Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.180650Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 27, 793736), datetime.datetime(2025, 9, 20, 8, 47, 27, 793736), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:28.180989Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:28.181295Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmarket_making[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:28.181723Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.181892Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.182008Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.182120Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.182326Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.182475Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.182583Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.182687Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.182888Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.183030Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.183135Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.183238Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.183432Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.183573Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.183675Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.183779Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.183970Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.184111Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.184215Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.184316Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.184522Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.184691Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.184808Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.184911Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.711965Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 28, 422896), datetime.datetime(2025, 9, 20, 8, 47, 28, 422896), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'scalping_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:28.712270Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:28.712578Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mscalping_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:28.712899Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.713064Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.713177Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.713368Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.713743Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.713898Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.714006Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.714113Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.714314Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.714464Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.714555Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.714644Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.714815Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.714998Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.715099Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.715188Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.715361Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.715484Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.715572Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.715660Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:28.715827Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:28.715947Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.716036Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:28.716124Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:29.258493Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 28, 918351), datetime.datetime(2025, 9, 20, 8, 47, 28, 918351), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'swing_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:29.259053Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:29.259571Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mswing_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:29.260092Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.260381Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.260589Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.260786Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.261150Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.261547Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.261799Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.262142Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.262538Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.262798Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.271409Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.271932Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.272566Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.273212Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.273623Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.273875Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.274529Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.274923Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.275222Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.275480Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.275980Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.276255Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.276447Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.276646Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.830694Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 29, 545986), datetime.datetime(2025, 9, 20, 8, 47, 29, 545986), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'position_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:29.831236Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:29.831698Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mposition_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:29.832138Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.832414Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.832602Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.832789Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.833116Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.833345Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.838308Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.838607Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.838904Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.839065Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.839322Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.839622Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.840024Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.840272Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.840451Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.840692Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.840926Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.841063Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.841175Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.841269Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:29.841466Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:29.841605Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.841697Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:29.841786Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:30.409194Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 30, 50558), datetime.datetime(2025, 9, 20, 8, 47, 30, 50558), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:30.409536Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:30.409850Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mrisk_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:30.410136Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.410320Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.410432Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.410538Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.410734Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.410874Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.410976Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.411075Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.411259Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.411393Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.411492Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.411589Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.411771Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.411906Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.412004Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.412100Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.412278Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.412411Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.412506Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.412600Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.412859Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.413012Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.413109Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.413222Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:30.936690Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 30, 646481), datetime.datetime(2025, 9, 20, 8, 47, 30, 646481), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:30.937913Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:30.938511Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mportfolio_optimization[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:30.938987Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.939345Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.939501Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.939696Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.940049Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.940291Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.940431Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.940568Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.941019Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.941226Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.941357Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.941540Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.941803Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.942022Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.942161Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.942289Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.942534Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.942707Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.942833Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.942962Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:30.943200Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:30.943374Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.943501Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:30.943629Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:31.488145Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 47, 31, 148676), datetime.datetime(2025, 9, 20, 8, 47, 31, 148676), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'strategy_performance')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:47:31.488466Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:47:31.488773Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstrategy_performance[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:47:31.489062Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:31.489227Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.489341Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.489536Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:31.489734Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:31.489864Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.489956Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.490047Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:31.490215Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:31.490339Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.490428Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.490518Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:31.490685Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:31.490807Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.490894Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.490994Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:31.491353Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:31.491625Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.491837Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.492064Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:47:31.492458Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:47:31.492731Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.492941Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:47:31.493165Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:47:31.975678Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.34091758728027344[0m [36mstatement[0m=[35mSELECT CAST($1 AS TEXT) AS anon_1, CAST($2 AS VARCHAR(50)) AS anon_2, CAST($3 AS JSON) AS anon_3, trading_strategies.id, trading_strategies.user_id, trading_strategies.name, trading_strategies.descrip...[0m
[2m2025-09-20T08:47:31.992701Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/strategies/marketplace[0m [36mprocess_time[0m=[35m15.283s[0m [36mrequest_id[0m=[35me8bbbae0[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:46902 - "GET /api/v1/strategies/marketplace?sort_by=performance&include_performance=true HTTP/1.1" 200 OK
[2m2025-09-20T08:47:41.375860Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
INFO:     127.0.0.1:53610 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:47:57.476556Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:47:57.681283Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:47:57.724093Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:47:57.809113Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:53626 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:47:58.537647Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:47:58.537949Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:47:58.538131Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:47:58.538276Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
INFO:     127.0.0.1:42326 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:48:27.837849Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:48:28.080295Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:48:28.134201Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:48:28.239627Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:42330 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:48:32.021039Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:48:32.838246Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 32, 549161), datetime.datetime(2025, 9, 20, 8, 48, 32, 549161), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:32.838707Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:32.839021Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfutures_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:32.839382Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:32.839530Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.839629Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.839724Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:32.839901Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:32.840025Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.840115Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.840203Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:32.840371Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:32.840493Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.840582Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.840669Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:32.840835Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:32.840954Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.841055Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.841144Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:32.841307Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:32.841557Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.842166Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.842320Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:32.842539Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:32.842678Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.842799Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:32.842907Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.396623Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 33, 48740), datetime.datetime(2025, 9, 20, 8, 48, 33, 48740), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:33.396948Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:33.397662Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:33.398550Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.399042Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.399337Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.399586Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.400167Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.400511Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.400642Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.400791Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.401044Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.401191Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.401294Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.401437Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.401730Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.401878Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.401977Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.402076Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.402263Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.402400Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.402498Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.402595Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.402777Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.402907Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.403023Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.403121Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.948040Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 33, 656758), datetime.datetime(2025, 9, 20, 8, 48, 33, 656758), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'perpetual_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:33.948590Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:33.949266Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mperpetual_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:33.949889Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.950141Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.950328Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.950506Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.950989Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.951240Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.951362Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.951466Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.951661Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.951791Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.951886Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.951978Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.952151Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.952354Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.952459Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.952552Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.952749Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.952906Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.952995Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.953081Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:33.953247Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:33.953369Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.953591Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:33.953806Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:34.494016Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 34, 156259), datetime.datetime(2025, 9, 20, 8, 48, 34, 156259), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'leverage_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:34.494359Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:34.494632Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mleverage_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:34.494899Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:34.495041Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.495143Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.495239Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:34.495418Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:34.495544Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.495638Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.495728Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:34.495898Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:34.496055Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.496308Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.496465Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:34.496812Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:34.497073Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.497274Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.497678Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:34.498456Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:34.499003Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.499272Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.499518Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:34.500021Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:34.500377Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.500660Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:34.500913Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.030427Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 34, 740556), datetime.datetime(2025, 9, 20, 8, 48, 34, 740556), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'complex_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:35.031232Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:35.032015Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcomplex_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:35.032543Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.032860Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.033065Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.033264Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.033807Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.034140Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.034397Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.034609Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.035177Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.035559Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.035741Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.035890Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.036183Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.036333Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.036433Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.036531Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.036715Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.036847Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.036942Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.037036Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.037233Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.037361Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.037678Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.037850Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:35.595306Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 35, 242973), datetime.datetime(2025, 9, 20, 8, 48, 35, 242973), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'margin_status')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:35.595634Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:35.595898Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmargin_status[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:35.596176Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.596320Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.596421Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.596533Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.596718Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.596863Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.597002Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.597342Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.598136Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.598763Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.599038Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.599264Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.599699Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.600050Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.600333Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.600564Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.601105Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.601505Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.601712Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.601832Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:35.602081Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:35.602257Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.602417Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:35.602533Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.137292Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 35, 842040), datetime.datetime(2025, 9, 20, 8, 48, 35, 842040), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'funding_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:36.137766Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:36.138094Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfunding_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:36.138428Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.138606Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.138733Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.138853Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.139076Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.139238Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.139355Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.139469Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.139682Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.139837Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.139964Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.140079Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.140290Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.140445Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.140558Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.140670Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.140876Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.141030Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.141142Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.141252Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.141521Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.141690Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.141804Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.141915Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.690917Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 36, 350862), datetime.datetime(2025, 9, 20, 8, 48, 36, 350862), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'basis_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:36.691235Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:36.691516Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mbasis_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:36.691794Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.691948Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.692055Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.692157Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.692346Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.692480Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.692579Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.692677Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.692856Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.692988Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.693085Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.693180Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.693356Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.693582Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.693684Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.693780Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.693961Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.694090Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.694199Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.694297Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:36.694475Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:36.694605Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.694701Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:36.694796Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:37.235144Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 36, 934449), datetime.datetime(2025, 9, 20, 8, 48, 36, 934449), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_chain')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:37.235600Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:37.236017Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_chain[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:37.236449Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.236709Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.236878Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.237037Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.237339Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.237707Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.237920Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.238079Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.238376Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.238584Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.238735Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.238885Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.239166Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.239373Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.239523Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.239672Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.239950Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.240154Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.240304Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.240452Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.240730Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.240934Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.241084Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.241229Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.774387Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 37, 442723), datetime.datetime(2025, 9, 20, 8, 48, 37, 442723), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'calculate_greeks')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:37.774690Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:37.775009Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcalculate_greeks[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:37.775296Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.775445Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.775549Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.775684Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.775879Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.776012Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.776109Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.776205Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.776400Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.776532Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.776627Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.776721Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.776896Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.777024Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.777117Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.777210Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.777384Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.777600Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.777701Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.777795Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:37.777976Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:37.778104Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.778196Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:37.778288Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:38.302490Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 38, 15765), datetime.datetime(2025, 9, 20, 8, 48, 38, 15765), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'liquidation_price')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:38.302802Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:38.303089Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mliquidation_price[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:38.303425Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.303579Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.303683Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.303782Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.303979Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.304116Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.304213Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.304308Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.304485Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.304614Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.304708Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.304803Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.304975Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.305102Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.305195Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.305287Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.305577Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.305727Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.305822Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.305917Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.306093Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.306222Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.306315Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.306408Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:38.968067Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 38, 617244), datetime.datetime(2025, 9, 20, 8, 48, 38, 617244), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'hedge_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:38.968687Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:38.969149Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mhedge_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:38.970100Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.970391Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.970573Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.970745Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.971067Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.971294Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.971457Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.971615Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.971907Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.972178Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.972344Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.972502Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.972794Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.973012Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.973169Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.973324Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.973661Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.973880Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.974040Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.974195Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:38.974483Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:38.974693Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.974849Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:38.975025Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:39.507596Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 39, 214588), datetime.datetime(2025, 9, 20, 8, 48, 39, 214588), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:39.507885Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:39.508174Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_momentum_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:39.508467Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:39.508620Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.508728Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.508831Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:39.509020Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:39.509155Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.509276Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.509374Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:39.509719Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:39.509858Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.509955Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.510050Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:39.510228Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:39.510358Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.510452Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.510545Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:39.510720Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:39.510846Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.510939Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.511032Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:39.511243Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:39.511373Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.511464Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:39.511555Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:40.055898Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 39, 719927), datetime.datetime(2025, 9, 20, 8, 48, 39, 719927), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_mean_reversion')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:40.056241Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:40.056543Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_mean_reversion[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:40.056840Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.057004Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.057226Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.057337Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.057772Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.058014Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.058176Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.058367Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.058641Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.058821Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.058974Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.059119Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.059401Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.059598Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.059728Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.059860Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.060134Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.060318Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.060453Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.060580Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.060817Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.060995Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.061125Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.061255Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:40.583820Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 40, 296971), datetime.datetime(2025, 9, 20, 8, 48, 40, 296971), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_breakout_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:40.584163Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:40.584501Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_breakout_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:40.584813Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.584981Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.585101Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.585215Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.585518Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.585728Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.585940Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.586066Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.586285Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.586438Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.586545Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.586652Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.586852Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.586997Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.587103Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.587209Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.587404Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.587548Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.587651Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.587754Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:40.587979Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:40.588144Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.588251Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:40.588355Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.126723Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 40, 792310), datetime.datetime(2025, 9, 20, 8, 48, 40, 792310), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'algorithmic_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:41.127024Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:41.127298Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35malgorithmic_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:41.127603Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.127757Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.127881Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.128005Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.128226Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.128362Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.128462Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.128558Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.128735Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.128866Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.128964Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.129059Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.129234Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.129363Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.129607Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.129770Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.130215Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.130518Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.130933Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.131309Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.131760Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.132095Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.132373Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.132603Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.377196Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:48:41.655703Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 41, 369015), datetime.datetime(2025, 9, 20, 8, 48, 41, 369015), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:41.656125Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:41.656506Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mpairs_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:41.656894Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.657113Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.657269Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.657595Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.658070Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.658293Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.658443Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.658587Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.658861Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.659058Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.659217Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.659361Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.659629Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.659821Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.659960Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.660099Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.660360Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.660551Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.660689Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.660824Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:41.661080Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:41.661269Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.661430Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:41.661586Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.268442Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 41, 883506), datetime.datetime(2025, 9, 20, 8, 48, 41, 883506), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:42.268717Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:42.268960Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstatistical_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:42.269205Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.269352Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.269562Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.269686Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.269843Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.269950Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.270028Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.270104Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.270246Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.270351Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.270426Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.270500Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.270640Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.270742Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.270816Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.270889Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.271026Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.271138Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.271213Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.271285Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.271520Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.271669Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.271742Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.271815Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.835780Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 42, 512629), datetime.datetime(2025, 9, 20, 8, 48, 42, 512629), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:42.836076Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:42.836358Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmarket_making[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:42.836673Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.836823Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.836924Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.837020Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.837195Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.837322Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.837501Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.837622Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.837801Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.837925Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.838016Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.838107Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.838272Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.838416Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.838514Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.838610Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.838789Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.838922Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.839019Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.839114Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:42.839292Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:42.839424Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.839521Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:42.839616Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:43.387162Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 43, 42095), datetime.datetime(2025, 9, 20, 8, 48, 43, 42095), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'scalping_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:43.387588Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:43.388050Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mscalping_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:43.388450Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.388686Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.388828Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.388961Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.389215Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.389389Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.389637Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.389784Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.390045Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.390225Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.390399Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.390547Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.390823Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.391013Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.391137Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.391260Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.391493Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.391674Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.391799Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.391918Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.392146Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.392312Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.392433Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.392552Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.944886Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 43, 633748), datetime.datetime(2025, 9, 20, 8, 48, 43, 633748), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'swing_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:43.945350Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:43.945906Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mswing_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:43.946522Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.946846Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.947203Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.947504Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.948089Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.948272Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.948397Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.948499Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.948678Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.948806Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.948897Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.948987Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.949181Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.949309Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.949457Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.949663Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.949906Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.950038Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.950128Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.950217Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:43.950384Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:43.950506Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.950595Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:43.950682Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
INFO:     127.0.0.1:40006 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:48:44.488542Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 44, 150676), datetime.datetime(2025, 9, 20, 8, 48, 44, 150676), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'position_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:44.488819Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:44.489114Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mposition_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:44.489490Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:44.489680Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.489792Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.489946Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:44.490171Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:44.490302Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.490396Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.490488Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:44.490659Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:44.490784Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.490876Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.490964Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:44.491129Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:44.491251Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.491340Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.491426Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:44.491591Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:44.491712Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.491800Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.491886Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:44.492049Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:44.492170Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.492272Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:44.492360Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:45.026425Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 44, 734883), datetime.datetime(2025, 9, 20, 8, 48, 44, 734883), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:45.026690Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:45.026927Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mrisk_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:45.027180Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.027305Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.027391Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.027471Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.027627Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.027752Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.027831Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.027907Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.028050Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.028155Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.028231Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.028306Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.028446Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.028551Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.028627Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.028702Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.028840Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.028943Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.029017Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.029092Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.029267Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.029541Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.029863Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.030133Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.572431Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 45, 236267), datetime.datetime(2025, 9, 20, 8, 48, 45, 236267), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:45.572818Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:45.573116Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mportfolio_optimization[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:45.573514Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.573772Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.573885Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.573986Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.574178Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.574309Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.574404Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.574496Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.574669Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.574794Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.574885Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.574975Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.575160Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.575285Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.575377Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.575467Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.575635Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.575756Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.575845Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.575934Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:45.576099Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:45.576219Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.576309Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:45.576410Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:48:46.118363Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 48, 45, 822473), datetime.datetime(2025, 9, 20, 8, 48, 45, 822473), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'strategy_performance')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:48:46.118796Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:48:46.119213Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstrategy_performance[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:48:46.119628Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:46.119857Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.120054Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.120233Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:46.120534Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:46.120763Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.120921Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.121089Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:46.121378Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:46.121655Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.121827Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.121984Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:46.122285Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:46.122491Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.122660Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.122821Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:46.123095Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:46.123330Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.123490Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.123650Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:46.123925Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:48:46.124133Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.124249Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:48:46.124392Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:48:46.545767Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2911949157714844[0m [36mstatement[0m=[35mSELECT CAST($1 AS TEXT) AS anon_1, CAST($2 AS VARCHAR(50)) AS anon_2, CAST($3 AS JSON) AS anon_3, trading_strategies.id, trading_strategies.user_id, trading_strategies.name, trading_strategies.descrip...[0m
[2m2025-09-20T08:48:46.566677Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/strategies/marketplace[0m [36mprocess_time[0m=[35m14.546s[0m [36mrequest_id[0m=[35m26149329[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:42330 - "GET /api/v1/strategies/marketplace?sort_by=performance&include_performance=true HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:48:58.586625Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:48:58.826525Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:48:58.874666Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:48:58.977374Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:40416 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:49:07.381293Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:49:07.383715Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
INFO:     127.0.0.1:41360 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:49:29.318446Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:49:29.558580Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:49:29.609125Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:49:29.705114Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:36542 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:49:36.197613Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:49:36.760627Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:49:39.707690Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:49:39.861036Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:49:39.862715Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5434.306383132935[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:49:41.480833Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:49:41.617015Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:49:42.056229Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
INFO:     127.0.0.1:36548 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:49:44.889177Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:49:45.150836Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:49:45.152070Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5288.904428482056[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:49:46.596922Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:49:46.864172Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:49:47.279409Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:49:47.379489Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 47, 19582), datetime.datetime(2025, 9, 20, 8, 49, 47, 19582), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:47.379988Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:47.380514Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfutures_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:47.381075Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.381495Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.381808Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.382066Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.382514Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.382796Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.383085Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.383295Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.383687Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.383959Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.384159Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.384364Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.384742Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.385010Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.385209Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.385438Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.385854Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.386250Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.386472Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.386665Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.387034Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.387283Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.387471Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.387659Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:49:47.978409Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 47, 626351), datetime.datetime(2025, 9, 20, 8, 49, 47, 626351), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:47.978843Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:47.979178Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:47.979449Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.979599Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.979699Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.979794Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.979970Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.980095Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.980186Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.980276Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.980517Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.980673Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.980793Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.980897Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.981111Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.981252Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.981348Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.981594Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.981802Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.981936Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.982033Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.982129Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:47.982307Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:47.982438Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.982534Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:47.982627Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:48.546274Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 48, 183625), datetime.datetime(2025, 9, 20, 8, 49, 48, 183625), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'perpetual_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:48.546614Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:48.546915Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mperpetual_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:48.547206Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:48.547368Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.547476Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.547602Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:48.547827Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:48.547968Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.548069Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.548169Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:48.548368Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:48.548508Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.548607Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.548714Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:48.548901Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:48.549031Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.549140Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.549224Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:48.549509Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:48.549700Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.549781Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.549860Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:48.550008Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:48.550115Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.550191Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:48.550266Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.081010Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:49:49.154895Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 48, 812483), datetime.datetime(2025, 9, 20, 8, 49, 48, 812483), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'leverage_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:49.155315Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:49.155745Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mleverage_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:49.156224Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.156567Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.156766Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.156950Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.157657Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.158299Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.158778Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.159089Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.159792Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.160282Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.160624Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.160928Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.161595Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.162064Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.162381Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.162854Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.163219Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.163441Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.163587Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.163748Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.164019Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.164216Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.164367Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.164533Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.353430Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:49:49.355045Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4202.45361328125[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:49:49.708501Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 49, 370087), datetime.datetime(2025, 9, 20, 8, 49, 49, 370087), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'complex_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:49.708920Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:49.709282Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcomplex_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:49.709888Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.710204Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.710407Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.710602Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.710927Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.711157Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.711346Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.711505Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.711839Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.712035Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.712199Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.712346Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.712630Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.712833Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.712993Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.713154Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.713478Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.713702Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.713863Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.714011Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:49.714294Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:49.714498Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.714658Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:49.714820Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:50.730485Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 50, 383748), datetime.datetime(2025, 9, 20, 8, 49, 50, 383748), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'margin_status')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:50.731498Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:50.732875Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmargin_status[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:50.734253Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:50.740081Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.741088Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.742143Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:50.743386Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:50.744280Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.744800Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.745693Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:50.746857Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:50.748203Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.749279Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.750320Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:50.751707Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:50.752666Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.753360Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.754260Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:50.755437Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:50.756368Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.758735Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.759760Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:50.760903Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:50.761910Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.762392Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:50.762755Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:50.842298Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:49:51.101302Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:49:51.304183Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 50, 970070), datetime.datetime(2025, 9, 20, 8, 49, 50, 970070), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'funding_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:51.304611Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:51.305015Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfunding_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:51.305555Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:51.305733Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.305839Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.305937Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:51.306119Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:51.306247Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.306338Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.306428Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:51.306597Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:51.306720Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.306809Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.306933Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:51.307290Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:51.307554Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.307782Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.308057Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:51.308505Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:51.308648Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.308743Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.308833Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:51.309007Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:51.309130Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.309217Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:51.309306Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:49:52.162072Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 51, 553162), datetime.datetime(2025, 9, 20, 8, 49, 51, 553162), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'basis_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:52.162363Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:52.162669Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mbasis_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:52.162991Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.163148Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.163253Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.163352Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.163551Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.163682Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.163779Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.163873Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.164046Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.164174Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.164267Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.164358Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.164530Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.164656Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.164747Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.164838Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.165008Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.165132Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.165223Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.165312Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.165572Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.165721Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.165827Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.165922Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:49:52.712073Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 52, 376554), datetime.datetime(2025, 9, 20, 8, 49, 52, 376554), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_chain')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:52.712642Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:52.713531Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_chain[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:52.714554Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.715217Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.715687Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.716168Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.716991Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.717706Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.718295Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.718783Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.719611Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.720219Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.720672Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.721130Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.722016Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.722622Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.723069Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.724030Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.724997Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.725343Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.725813Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.726066Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:52.726511Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:52.726827Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.727051Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:52.727271Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.299013Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 52, 966438), datetime.datetime(2025, 9, 20, 8, 49, 52, 966438), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'calculate_greeks')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:53.299348Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:53.299627Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcalculate_greeks[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:53.299885Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.300027Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.300126Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.300221Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.300397Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.300523Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.300614Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.300703Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.300869Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.300992Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.301081Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.301169Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.301332Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.301597Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.301700Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.301790Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.301968Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.302093Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.302216Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.302309Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.302476Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.302600Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.302689Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.302776Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:49:53.635891Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:49:53.805934Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:49:53.807057Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4451.49040222168[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:49:53.860532Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 53, 515694), datetime.datetime(2025, 9, 20, 8, 49, 53, 515694), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'liquidation_price')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:53.861028Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:53.861795Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mliquidation_price[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:53.862166Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.862341Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.862588Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.862719Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.862927Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.863055Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.863148Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.863238Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.863405Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.863528Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.863618Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.863705Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.863868Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.863989Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.864078Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.864165Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.864381Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.864520Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.864618Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.864712Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:53.864887Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:53.865021Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.865116Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:53.865210Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:54.706176Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 54, 135906), datetime.datetime(2025, 9, 20, 8, 49, 54, 135906), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'hedge_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:54.706472Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:54.707059Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mhedge_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:54.707401Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:54.707563Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.707670Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.707769Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:54.707960Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:54.708095Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.708192Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.708288Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:54.708465Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:54.708594Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.708689Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.708781Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:54.708954Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:54.709080Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.709172Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.709263Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:54.709502Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:54.709661Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.709757Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.709851Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:54.710030Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:54.710160Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.710251Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:54.710363Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.294056Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 54, 957664), datetime.datetime(2025, 9, 20, 8, 49, 54, 957664), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:55.294412Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:55.294775Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_momentum_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:55.295058Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.295209Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.295313Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.295411Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.295594Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.295726Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.295840Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.295935Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.296111Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.296280Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.296376Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.296471Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.296647Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.296774Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.296866Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.296958Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.297129Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.297255Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.297346Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.297596Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.297921Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.298138Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.298282Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.298430Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.309242Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:49:55.749568Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T08:49:55.925221Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 55, 552863), datetime.datetime(2025, 9, 20, 8, 49, 55, 552863), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_mean_reversion')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:55.925951Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:55.926660Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_mean_reversion[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:55.927288Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.927588Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.927825Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.928060Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.928421Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.928661Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.928833Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.929020Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.929357Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.929663Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.929866Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.930045Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.930369Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.930569Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.930718Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.930863Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.931133Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.931334Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.931484Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.931636Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:55.931902Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:55.932101Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.932254Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:55.932404Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:56.580444Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 56, 217752), datetime.datetime(2025, 9, 20, 8, 49, 56, 217752), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_breakout_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:56.581257Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:56.582560Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_breakout_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:56.583676Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:56.584305Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.584661Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.584968Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:56.585688Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:56.586182Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.586607Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.586913Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:56.587427Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:56.587686Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.587872Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.588051Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:56.588390Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:56.588641Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.588823Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.589001Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:56.589337Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:56.589728Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.593007Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.594044Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:56.595150Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:56.595781Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.596042Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:56.596220Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.224455Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 56, 846739), datetime.datetime(2025, 9, 20, 8, 49, 56, 846739), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'algorithmic_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:57.225337Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:57.226299Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35malgorithmic_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:57.226978Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.227669Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.228031Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.228367Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.228944Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.229370Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.230159Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.230295Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.230573Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.230790Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.230892Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.231017Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.231222Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.231414Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.231521Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.231662Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.231895Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.232035Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.232190Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.232295Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.232535Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.232715Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.232821Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.232916Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.269994Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:49:57.425388Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:49:57.426471Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3618.988513946533[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:49:57.779691Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 57, 444550), datetime.datetime(2025, 9, 20, 8, 49, 57, 444550), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:57.780115Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:57.780551Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mpairs_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:57.780985Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.781229Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.781469Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.781748Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.782145Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.782402Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.782593Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.782785Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.783144Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.783412Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.783604Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.783813Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.784227Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.784498Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.784698Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.784891Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.785349Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.785907Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.786119Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.786326Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:57.786671Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:57.786908Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.787084Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:57.787259Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:58.881505Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 58, 379390), datetime.datetime(2025, 9, 20, 8, 49, 58, 379390), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:58.881832Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:58.882143Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstatistical_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:58.882449Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:58.882604Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.882712Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.882815Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:58.883006Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:58.883140Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.883238Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.883333Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:58.883511Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:58.883642Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.883736Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.883856Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:58.884085Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:58.884215Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.884307Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.884399Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:58.884569Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:58.884696Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.884790Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.884882Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:58.885050Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:58.885176Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.885267Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:58.885358Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:59.017306Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:49:59.017734Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:49:59.017964Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:49:59.018136Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:49:59.154565Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:49:59.466190Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 59, 123378), datetime.datetime(2025, 9, 20, 8, 49, 59, 123378), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:49:59.466602Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:49:59.466993Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmarket_making[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:49:59.467436Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:59.467683Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.467851Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.468028Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:59.468369Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:59.468570Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.468720Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.468872Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:59.469152Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:59.469447Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.469730Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.469882Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:59.470172Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:59.470370Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.470517Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.470665Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:59.470927Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:59.471125Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.471269Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.471418Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:59.471691Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:49:59.471892Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.472045Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:49:59.472201Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:49:59.510638Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:50:00.143112Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:50:00.350981Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 49, 59, 710693), datetime.datetime(2025, 9, 20, 8, 49, 59, 710693), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'scalping_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:50:00.352197Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:50:00.352772Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mscalping_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:50:00.353582Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.353796Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.353914Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.354022Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.354305Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.354857Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.355120Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.355391Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.356108Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.356486Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.356886Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.357153Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.357847Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.360868Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.361206Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.361633Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.362113Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.362435Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.362625Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.362843Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.363164Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.363389Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.363561Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.363721Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.392398Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:50:00.443967Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:50:00.538634Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:51068 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:50:00.948054Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 50, 0, 606289), datetime.datetime(2025, 9, 20, 8, 50, 0, 606289), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'swing_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:50:00.948400Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:50:00.948698Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mswing_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:50:00.948996Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.949153Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.949263Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.949368Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.949700Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.949847Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.949950Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.950049Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.950235Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.950371Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.950470Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.950601Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.950797Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.950932Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.951031Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.951127Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.951505Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.951636Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.951726Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.951811Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:00.951974Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:00.952090Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.952176Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:00.952263Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:01.494401Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 50, 1, 156001), datetime.datetime(2025, 9, 20, 8, 50, 1, 156001), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'position_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:50:01.494987Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:50:01.495747Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mposition_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:50:01.496546Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:01.496907Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.497101Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.497297Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:01.497733Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:01.498046Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.498252Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.498407Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:01.498691Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:01.498899Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.499053Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.499205Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:01.499476Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:01.499668Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.499852Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.500004Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:01.500271Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:01.500462Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.500606Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.500749Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:01.501008Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:01.501226Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.501494Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:01.501735Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:01.603584Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:50:01.802897Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:50:01.804559Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4377.626419067383[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:50:01.805176Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T08:50:02.107985Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 50, 1, 746089), datetime.datetime(2025, 9, 20, 8, 50, 1, 746089), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:50:02.108544Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:50:02.109153Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mrisk_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:50:02.110131Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.110716Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.111182Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.111416Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.111987Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.112265Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.112456Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.112658Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.113053Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.113305Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.113550Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.113742Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.114091Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.114329Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.114504Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.114691Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.115017Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.115257Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.115433Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.115608Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.115934Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.116183Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.116375Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.116560Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:50:02.662791Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 50, 2, 324729), datetime.datetime(2025, 9, 20, 8, 50, 2, 324729), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:50:02.663502Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:50:02.664193Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mportfolio_optimization[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:50:02.664763Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.665085Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.665310Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.665761Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.666394Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.666701Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.666914Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.667119Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.667478Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.667685Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.667833Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.667978Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.668251Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.668552Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.668712Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.668863Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.669143Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.669347Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.669539Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.669687Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:02.669962Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:02.670163Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.670311Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:02.670456Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:03.319711Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 50, 2, 923613), datetime.datetime(2025, 9, 20, 8, 50, 2, 923613), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'strategy_performance')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:50:03.320199Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:50:03.320650Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstrategy_performance[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:50:03.321099Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:03.321350Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.321631Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.321839Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:03.322233Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:03.322509Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.322724Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.322943Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:03.323532Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:03.324063Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.324366Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.324495Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:03.324727Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:03.324874Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.325725Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.325873Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:03.326129Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:03.326291Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.326395Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.326494Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:03.326683Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:50:03.327015Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.327238Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:50:03.327450Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:50:03.554347Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/strategies/marketplace[0m [36mprocess_time[0m=[35m16.958s[0m [36mrequest_id[0m=[35mb49ac608[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:36548 - "GET /api/v1/strategies/marketplace?sort_by=performance&include_performance=true HTTP/1.1" 200 OK
1 change detected
INFO:     127.0.0.1:42746 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:50:30.562089Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:50:30.802447Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:50:30.850968Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:50:30.946250Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:42748 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:50:41.482198Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
INFO:     127.0.0.1:47178 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:51:00.975125Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:51:01.270059Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:01.321655Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:01.418523Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:47180 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:51:03.574451Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:51:03.574785Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 11 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:51:03.575350Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:51:03.577631Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:51:04.393884Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 4, 31244), datetime.datetime(2025, 9, 20, 8, 51, 4, 31244), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'futures_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:04.394388Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:04.394893Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfutures_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:04.395448Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.395760Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.395985Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.396222Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.396698Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.397056Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.397466Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.397759Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.398665Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.399289Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.399640Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.399829Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.402406Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.403242Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.403426Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.403590Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.403921Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.404985Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.405284Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.406591Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.407034Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.407279Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.407445Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.407607Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.983969Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 4, 647235), datetime.datetime(2025, 9, 20, 8, 51, 4, 647235), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:04.984577Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:04.985213Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:04.986323Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.986729Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.987043Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.987297Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.987802Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.988161Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.988432Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.988696Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.989196Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.990419Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.990980Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.991206Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.992416Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.992890Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.993270Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.993554Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.994244Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.995200Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.996228Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:04.998598Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:04.999623Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:04.999960Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.000222Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.000684Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:05.586092Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 5, 210243), datetime.datetime(2025, 9, 20, 8, 51, 5, 210243), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'perpetual_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:05.586648Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:05.587171Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mperpetual_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:05.587629Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:05.587928Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.588132Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.588367Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:05.588766Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:05.589029Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.589185Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.589334Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:05.589669Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:05.589979Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.590126Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.590264Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:05.590524Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:05.590713Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.590850Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.590981Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:05.591302Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:05.591502Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.591644Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.591790Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:05.592058Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:05.592266Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.592498Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:05.592733Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:06.169957Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 5, 828305), datetime.datetime(2025, 9, 20, 8, 51, 5, 828305), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'leverage_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:06.170550Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:06.171359Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mleverage_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:06.172072Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.172527Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.172774Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.172970Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.173376Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.173713Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.173886Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.174055Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.174353Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.174562Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.174715Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.174869Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.175151Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.175354Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.175505Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.175655Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.175934Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.176158Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.176336Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.176501Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.176800Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.177024Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.177185Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.177354Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.672814Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 6, 381436), datetime.datetime(2025, 9, 20, 8, 51, 6, 381436), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'complex_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:06.673133Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:06.673461Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcomplex_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:06.673813Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.673979Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.674091Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.674199Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.674399Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.674542Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.674647Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.674749Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.674938Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.675076Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.675175Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.675271Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.675455Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.675589Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.675686Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.675783Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.675964Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.676098Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.676773Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.676894Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:06.677114Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:06.677262Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.677446Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:06.677639Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:07.382107Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 7, 20313), datetime.datetime(2025, 9, 20, 8, 51, 7, 20313), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'margin_status')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:07.382613Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:07.383163Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmargin_status[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:07.383823Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.384493Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.384886Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.385279Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.386006Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.386476Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.386821Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.387171Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.387651Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.387996Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.389573Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.390290Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.390987Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.391298Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.391480Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.391642Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.391953Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.392178Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.392340Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.392499Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.392797Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.393003Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.393163Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.393312Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.396735Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:51:07.397789Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:51:07.914981Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 7, 607660), datetime.datetime(2025, 9, 20, 8, 51, 7, 607660), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'funding_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:07.915577Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:07.916285Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mfunding_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:07.933100Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.938459Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.938680Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.938920Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.939343Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.939619Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.939818Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.940019Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.940690Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.941117Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.941348Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.951321Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.952203Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.953090Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.953499Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.953811Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.954364Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.954768Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.955070Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.955350Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:07.955920Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:07.956303Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.956575Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:07.956861Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:08.366033Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/paper-trading/setup[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m5a4161af[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:51:08.369189Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:51:08.537827Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 8, 200283), datetime.datetime(2025, 9, 20, 8, 51, 8, 200283), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'basis_trade')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:08.538272Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:08.538709Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mbasis_trade[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:08.539208Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:08.539461Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.539643Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.539824Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:08.540129Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:08.540358Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.540528Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.540714Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:08.541153Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:08.541440Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.541649Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.541830Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:08.542165Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:08.542403Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.542575Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.542808Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:08.543148Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:08.543376Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.543549Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.543719Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:08.544022Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:08.544251Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.544576Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:08.544777Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:08.587958Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/paper-trading/setup[0m [36mprocess_time[0m=[35m0.222s[0m [36mrequest_id[0m=[35m5a4161af[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:44812 - "POST /api/v1/paper-trading/setup HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:51:08.695505Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:44812 - "GET /api/v1/paper-trading/stats HTTP/1.1" 200 OK
[2m2025-09-20T08:51:09.129948Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 8, 762578), datetime.datetime(2025, 9, 20, 8, 51, 8, 762578), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'options_chain')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:09.130461Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:09.130865Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35moptions_chain[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:09.131282Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.131520Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.131697Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.131896Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.132224Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.132471Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.132654Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.132831Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.133155Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.133448Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.133632Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.133847Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.134219Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.134454Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.134614Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.134766Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.135079Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.135314Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.135495Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.135728Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.137341Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.137842Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.138040Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.138201Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:09.687150Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 9, 391182), datetime.datetime(2025, 9, 20, 8, 51, 9, 391182), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'calculate_greeks')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:09.687867Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:09.688631Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mcalculate_greeks[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:09.689368Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.690092Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.690437Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.690634Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.690932Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.691104Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.691614Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.693062Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.695362Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.695650Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.695801Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.695937Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.696405Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.696686Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.696820Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.696940Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.697170Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.697382Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.697562Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.697661Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:09.697843Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:09.697972Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.698063Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:09.698155Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.278141Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 9, 936370), datetime.datetime(2025, 9, 20, 8, 51, 9, 936370), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'liquidation_price')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:10.278588Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:10.278889Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mliquidation_price[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:10.279170Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.279321Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.279427Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.279525Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.279709Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.279839Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.279932Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.280024Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.280196Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.280336Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.280431Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.280522Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.280691Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.280815Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.280905Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.280993Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.281160Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.281283Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.281373Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.281530Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.281854Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.282083Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.282241Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.282385Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:10.786689Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 10, 492980), datetime.datetime(2025, 9, 20, 8, 51, 10, 492980), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'hedge_position')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:10.788135Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:10.789884Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mhedge_position[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:10.791422Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.792356Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.792822Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.793091Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.793914Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.794766Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.795161Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.795614Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.796310Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.797383Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.799670Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.803221Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.804146Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.804683Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.805009Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.805331Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.806141Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.806682Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.806950Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.807172Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:10.807591Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:10.807867Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.808143Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:10.808358Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.399534Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 11, 48819), datetime.datetime(2025, 9, 20, 8, 51, 11, 48819), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_momentum_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:11.400312Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:11.401186Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_momentum_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:11.414346Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.414768Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.415042Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.415296Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.415733Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.416006Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.416199Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.416387Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.416836Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.417191Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.417719Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.418319Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.418975Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.419486Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.419842Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.420162Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.420787Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.421359Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.421846Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.422217Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.422685Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.422957Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.423148Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.423372Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:11.946057Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 11, 639575), datetime.datetime(2025, 9, 20, 8, 51, 11, 639575), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_mean_reversion')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:11.946787Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:11.948332Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_mean_reversion[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:11.949207Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.949709Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.950003Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.950279Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.954882Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.955470Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.955754Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.956064Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.956559Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.956991Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.957271Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.957617Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.958084Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.958435Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.958665Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.958936Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.959648Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.963954Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.964289Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.964541Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:11.965017Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:11.965533Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.965874Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:11.966176Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:12.605755Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 12, 212868), datetime.datetime(2025, 9, 20, 8, 51, 12, 212868), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'spot_breakout_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:12.606311Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:12.606803Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mspot_breakout_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:12.607369Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:12.607662Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.607887Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.608087Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:12.608456Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:12.608921Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.609123Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.609348Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:12.609859Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:12.610140Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.610349Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.610552Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:12.610928Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:12.611193Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.611407Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.611630Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:12.612014Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:12.612331Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.612540Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.612713Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:12.613027Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:12.613255Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.613485Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:12.613719Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.177657Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 12, 864219), datetime.datetime(2025, 9, 20, 8, 51, 12, 864219), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'algorithmic_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:13.178286Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:13.179050Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35malgorithmic_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:13.179707Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.180405Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.180797Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.181050Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.181784Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.182378Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.182698Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.182986Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.183766Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.184353Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.184742Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.185046Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.186287Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.186820Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.187509Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.189567Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.190150Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.190422Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.190604Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.190782Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.191099Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.191363Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.191587Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.191764Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
INFO:     127.0.0.1:44812 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:51:13.783436Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 13, 433331), datetime.datetime(2025, 9, 20, 8, 51, 13, 433331), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'pairs_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:13.784000Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:13.784496Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mpairs_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:13.785055Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.785388Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.785668Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.785888Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.786343Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.786677Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.786922Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.787134Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.787533Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.787818Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.788025Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.788265Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.788643Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.788918Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.789111Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.789294Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.789710Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.789979Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.790175Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.790348Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:13.790674Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:13.790884Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.791035Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:13.791184Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.346267Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 14, 20898), datetime.datetime(2025, 9, 20, 8, 51, 14, 20898), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'statistical_arbitrage')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:14.346805Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:14.347388Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstatistical_arbitrage[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:14.347957Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.348414Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.348633Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.348840Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.349331Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.349925Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.350175Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.350476Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.351657Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.352518Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.352983Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.353247Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.360303Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.360708Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.360938Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.361139Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.361598Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.361987Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.362181Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.362360Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.362702Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.362939Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.363108Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.363274Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.975537Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 14, 604119), datetime.datetime(2025, 9, 20, 8, 51, 14, 604119), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'market_making')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:14.976058Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:14.976576Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mmarket_making[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:14.977084Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.977376Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.977775Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.977976Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.978587Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.979155Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.979526Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.979864Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.980595Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.981116Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.981687Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.982275Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.983430Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.984182Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.995121Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.995423Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.995873Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.996167Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.996365Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.996553Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:14.997140Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:14.997691Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.998004Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:14.998272Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:15.521529Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 15, 203337), datetime.datetime(2025, 9, 20, 8, 51, 15, 203337), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'scalping_strategy')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:15.522802Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:15.523488Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mscalping_strategy[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:15.524427Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:15.525139Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.525502Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.525760Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:15.526257Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:15.526589Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.526789Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.526978Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:15.527347Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:15.527608Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.527797Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.527990Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:15.528348Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:15.528705Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.528930Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.529134Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:15.529619Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:15.529992Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.530211Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.530411Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:15.534828Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:15.535418Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.535673Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:15.535950Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:15.799201Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m3f572c1c[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:51:15.809672Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     ('127.0.0.1', 47646) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
[2m2025-09-20T08:51:16.039364Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m39d8fde2-5d27-4154-b9f4-59905d88b862[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:16.040595Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.242s[0m [36mrequest_id[0m=[35m3f572c1c[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:44812 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T08:51:16.148513Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mb06f7853[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
INFO:     ('127.0.0.1', 47662) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
[2m2025-09-20T08:51:16.162394Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     connection open
[2m2025-09-20T08:51:16.220057Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 15, 777714), datetime.datetime(2025, 9, 20, 8, 51, 15, 777714), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'swing_trading')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:16.221108Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:16.222416Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mswing_trading[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:16.222997Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.223332Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.223540Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.223749Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.224267Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.224548Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.224761Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.224968Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.225352Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.225731Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.238447Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.238906Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.239677Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.240090Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.240303Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.240593Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.241137Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.241730Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.242172Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.242575Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.243335Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.245530Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.246221Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.246817Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.449791Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m5e12d667-4ee5-48fd-97b2-559aa1f43ac1[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:16.451544Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.303s[0m [36mrequest_id[0m=[35mb06f7853[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:44812 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T08:51:16.859350Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 16, 521242), datetime.datetime(2025, 9, 20, 8, 51, 16, 521242), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'position_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:16.860507Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:16.861784Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mposition_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:16.862655Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.863309Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.863847Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.864265Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.864996Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.865610Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.867134Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.868149Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.869955Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.870822Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.871392Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.871935Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.873084Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.873609Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.874101Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.874642Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.875264Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.875665Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.875953Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.876233Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:16.876761Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:16.877150Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.877370Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:16.877690Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:17.540500Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 17, 185313), datetime.datetime(2025, 9, 20, 8, 51, 17, 185313), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'risk_management')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:17.540993Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:17.541540Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mrisk_management[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:17.542169Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:17.542474Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.542689Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.542898Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:17.543334Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:17.543586Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.543764Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.543937Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:17.544277Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:17.544513Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.544703Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.544894Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:17.545235Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:17.545576Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.545788Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.545985Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:17.546347Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:17.546572Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.546742Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.546909Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:17.547210Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:17.547432Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.547634Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:17.547812Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:18.007970Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m3e0009a9[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:51:18.009502Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:51:18.158738Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 17, 811048), datetime.datetime(2025, 9, 20, 8, 51, 17, 811048), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'portfolio_optimization')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:18.159190Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:18.159632Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mportfolio_optimization[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:18.160144Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.160432Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.160643Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.160840Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.161212Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.161552Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.161768Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.161983Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.162366Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.162599Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.162778Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.162958Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.163327Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.163577Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.163754Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.163934Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.164308Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.164576Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.164779Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.164980Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.165344Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.165687Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.166316Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.166804Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.297285Z[0m [[32m[1minfo     [0m] [1mAutonomous mode configuration [0m [[34m[1mapp.api.v1.endpoints.trading[0m] [36menable[0m=[35mTrue[0m [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:18.345718Z[0m [[32m[1minfo     [0m] [1mü§ñ Starting autonomous mode for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mMasterSystemController[0m] [36mmode[0m=[35mbalanced[0m
[2m2025-09-20T08:51:18.346003Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable - storing autonomous config in memory[0m [[34m[1mMasterSystemController[0m] 
[2m2025-09-20T08:51:18.346183Z[0m [[32m[1minfo     [0m] [1mAutonomous mode started       [0m [[34m[1mUnifiedAIManager[0m] [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:18.346717Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mprocess_time[0m=[35m0.339s[0m [36mrequest_id[0m=[35m3e0009a9[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:44812 - "POST /api/v1/trading/autonomous/toggle HTTP/1.1" 200 OK
[2m2025-09-20T08:51:18.753096Z[0m [[31m[1merror    [0m] [1mFailed to get strategy performance data[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT count(trades.id) AS total_trades, sum(trades.profit_realized_usd) AS total_pnl, avg(trades.profit_realized_usd) AS avg_trade_pnl, sum(CASE WHEN (trades.profit_realized_usd > $1::INTEGER) THEN $2::INTEGER ELSE $3::INTEGER END) AS winning_trades, sum(CASE WHEN (trades.profit_realized_usd < $4::INTEGER) THEN $5::INTEGER ELSE $6::INTEGER END) AS losing_trades, sum(CASE WHEN (trades.profit_realized_usd > $7::INTEGER) THEN trades.profit_realized_usd ELSE $8::INTEGER END) AS gross_profit, sum(CASE WHEN (trades.profit_realized_usd < $9::INTEGER) THEN trades.profit_realized_usd ELSE $10::INTEGER END) AS gross_loss, max(trades.profit_realized_usd) AS largest_win, min(trades.profit_realized_usd) AS largest_loss, sum(trades.total_value) AS total_value, sum(trades.fees_paid) AS total_fees, avg(trades.profit_realized_usd) AS pnl_avg, avg(trades.profit_realized_usd * trades.profit_realized_usd) AS pnl_sq_avg 
FROM trades JOIN trading_strategies ON trades.strategy_id = trading_strategies.id 
WHERE trades.status = $11::tradestatus AND trades.is_simulation IS false AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) >= $12::TIMESTAMP WITHOUT TIME ZONE AND coalesce(trades.completed_at, trades.executed_at, trades.created_at) <= $13::TIMESTAMP WITHOUT TIME ZONE AND trades.user_id = $14::UUID AND trading_strategies.name = $15::VARCHAR]
[parameters: (0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 'COMPLETED', datetime.datetime(2025, 8, 21, 8, 51, 18, 419388), datetime.datetime(2025, 9, 20, 8, 51, 18, 419388), UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'strategy_performance')]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:51:18.753534Z[0m [[31m[1merror    [0m] [1mStrategy performance analysis failed[0m [[34m[1mTradingStrategiesService[0m] [36merror[0m=[35mname 'total_trades' is not defined[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/trading_strategies.py", line 5051, in strategy_performance
    if total_trades > 0 and perf_result["performance_metrics"]["winning_trades_pct"] < 55:
NameError: name 'total_trades' is not defined
[2m2025-09-20T08:51:18.753856Z[0m [[32m[1minfo     [0m] [1müöÄ Starting REAL backtest      [0m [[34m[1mRealBacktestingEngine[0m] [36mperiod[0m=[35m2023-01-01 to 2024-01-01[0m [36mstrategy[0m=[35mstrategy_performance[0m [36msymbols[0m=[35m['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT'][0m
[2m2025-09-20T08:51:18.754154Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.754315Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.754430Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BTC/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.754541Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BTC/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.754746Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.754891Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.754996Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ETH/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.755101Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ETH/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.755293Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.755435Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.755537Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for BNB/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.755654Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for BNB/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.755848Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.755989Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.756091Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for SOL/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.756192Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for SOL/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.756371Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.756493Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.756582Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for ADA/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.756670Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for ADA/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
[2m2025-09-20T08:51:18.756833Z[0m [[31m[1merror    [0m] [1mFailed to fetch OHLCV data    [0m [[34m[1mRealMarketDataService[0m] [36merror[0m=[35mtoo many values to unpack (expected 2)[0m
[2m2025-09-20T08:51:18.756954Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from binance: too many values to unpack (expected 2)[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.757042Z[0m [[31m[1merror    [0m] [1m‚ùå Could not fetch real price for DOT/USDT[0m [[34m[1mRealMarketDataService[0m] 
[2m2025-09-20T08:51:18.757130Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è No data for DOT/USDT       [0m [[34m[1mRealBacktestingEngine[0m] 
1 change detected
[2m2025-09-20T08:51:18.996035Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/strategies/marketplace[0m [36mprocess_time[0m=[35m15.420s[0m [36mrequest_id[0m=[35m1461a85c[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:47180 - "GET /api/v1/strategies/marketplace?sort_by=performance&include_performance=true HTTP/1.1" 200 OK
[2m2025-09-20T08:51:19.821151Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mf29c2f07[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:51:19.823479Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:51:20.027655Z[0m [[32m[1minfo     [0m] [1mAutonomous mode configuration [0m [[34m[1mapp.api.v1.endpoints.trading[0m] [36menable[0m=[35mFalse[0m [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:20.027938Z[0m [[32m[1minfo     [0m] [1müõë Stopping autonomous mode for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mMasterSystemController[0m] 
[2m2025-09-20T08:51:20.028097Z[0m [[31m[1merror    [0m] [1mFailed to stop autonomous mode[0m [[34m[1mUnifiedAIManager[0m] [36merror[0m=[35m'str' object has no attribute 'value'[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:20.028604Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mprocess_time[0m=[35m0.207s[0m [36mrequest_id[0m=[35mf29c2f07[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:47180 - "POST /api/v1/trading/autonomous/toggle HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:51:21.005818Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m0311a10d[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:51:21.007355Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:51:21.247569Z[0m [[32m[1minfo     [0m] [1mAutonomous mode configuration [0m [[34m[1mapp.api.v1.endpoints.trading[0m] [36menable[0m=[35mTrue[0m [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:21.297194Z[0m [[32m[1minfo     [0m] [1mü§ñ Starting autonomous mode for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mMasterSystemController[0m] [36mmode[0m=[35mbalanced[0m
[2m2025-09-20T08:51:21.297541Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable - storing autonomous config in memory[0m [[34m[1mMasterSystemController[0m] 
[2m2025-09-20T08:51:21.297816Z[0m [[32m[1minfo     [0m] [1mAutonomous mode started       [0m [[34m[1mUnifiedAIManager[0m] [36mmode[0m=[35mbalanced[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:51:21.298709Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/trading/autonomous/toggle[0m [36mprocess_time[0m=[35m0.293s[0m [36mrequest_id[0m=[35m0311a10d[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:47180 - "POST /api/v1/trading/autonomous/toggle HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:51:37.753045Z[0m [[31m[1merror    [0m] [1mMetrics collector error       [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:51:41.484542Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:51:59.367139Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:51:59.367612Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:51:59.367924Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:51:59.368283Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
[2m2025-09-20T08:52:02.084966Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2862429618835449[0m [36mstatement[0m=[35mSELECT DISTINCT exchange_accounts.user_id 
FROM exchange_accounts 
WHERE exchange_accounts.status = $1::exchangestatus AND exchange_accounts.trading_enabled = true[0m
[2m2025-09-20T08:52:02.086303Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:52:02.262224Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:52:02.262705Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:52:02.538148Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2728283405303955[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:52:02.713563Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.44641900062561035[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T08:52:02.850744Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_7d56b051[0m
[2m2025-09-20T08:52:02.851013Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_c3c2ccad[0m
[2m2025-09-20T08:52:02.851149Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_071f8c49[0m
[2m2025-09-20T08:52:03.183214Z[0m [[32m[1minfo     [0m] [1mKraken server time synced     [0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36moffset[0m=[35m1.1488919258117676[0m
[2m2025-09-20T08:52:03.183808Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358324332[0m [36mfallback_uses[0m=[35m24[0m [36mlocal_count[0m=[35m24[0m [36mnode_hash[0m=[35m610[0m [36mnonce[0m=[35m1758358324966[0m
[2m2025-09-20T08:52:03.225875Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m962.6851081848145[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2269.1300000000006[0m
[2m2025-09-20T08:52:03.440591Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:52:03.506945Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1243.6785697937012[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1755.94[0m
1 change detected
[2m2025-09-20T08:52:04.787163Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:52:07.223532Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:52:07.224147Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4960.8314037323[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T08:52:07.224603Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4961.867570877075[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m5138.318061828613[0m [36mtotal_value_usd[0m=[35m4025.0700000000006[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:52:07.225994Z[0m [[33m[1mwarning  [0m] [1mBalance sync failed for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:52560 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:52:41.487134Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:53:03.468958Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
INFO:     127.0.0.1:54894 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:53:04.160565Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:53:06.408202Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:53:07.063590Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:53:07.064331Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5257.999897003174[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:53:07.399669Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:53:07.400589Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:53:08.443431Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:53:08.832217Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:53:12.114530Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:53:12.494378Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:53:12.495375Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5430.7920932769775[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:53:13.965853Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:53:14.602405Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
[2m2025-09-20T08:53:17.778375Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:53:18.496168Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:53:18.496972Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m6001.211881637573[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:53:19.940406Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:53:20.517946Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:53:23.290461Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:53:23.493149Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:53:23.494410Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4997.095823287964[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:53:25.036421Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:53:25.449768Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:53:27.319431Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:53:28.602717Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:53:28.603734Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5108.859062194824[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:53:30.150022Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:53:30.456610Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:53:32.966441Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:53:33.449280Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:53:33.450365Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4846.206903457642[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:53:33.450740Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
INFO:     127.0.0.1:39716 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:53:41.489691Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:53:59.930649Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:53:59.930872Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:53:59.930982Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:53:59.931076Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:36552 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
[2m2025-09-20T08:54:32.791049Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:54:33.138639Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:54:33.186581Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:54:33.286813Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:45276 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
INFO:     127.0.0.1:45276 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:54:41.490937Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:54306 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:55:03.303914Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:55:03.601566Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:55:03.643233Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:55:03.731653Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:54310 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:55:07.408132Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:55:07.408934Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:52662 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:55:33.752135Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:55:34.102911Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.22657179832458496[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:55:34.103567Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:55:34.145024Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:55:34.227870Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:52674 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:55:41.492031Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:46474 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:56:00.379034Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:56:00.379430Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:56:00.379662Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:56:00.379853Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
[2m2025-09-20T08:56:04.248423Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:56:04.249376Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 12 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:56:04.250108Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T08:56:04.251755Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:56:04.456668Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:56:04.499792Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:56:04.581840Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:46488 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
INFO:     127.0.0.1:40768 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:56:34.672222Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:56:34.875559Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:56:34.918696Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:56:35.051275Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:40772 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:56:35.138377Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:56:35.655798Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:56:38.338652Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:56:38.496546Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:56:38.497503Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5046.505689620972[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:56:40.217120Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:56:40.593921Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:56:41.493574Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:56:42.684157Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:56:42.864567Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:56:42.865908Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4367.949724197388[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
INFO:     127.0.0.1:41898 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:56:44.228546Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:56:44.499815Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:56:46.895624Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:56:47.068699Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:56:47.069769Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4203.290939331055[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:56:48.646689Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:56:48.902659Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:56:51.079468Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:56:51.256349Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:56:51.258544Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4188.083171844482[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
1 change detected
[2m2025-09-20T08:56:53.019391Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T08:56:53.281638Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T08:56:55.549703Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T08:56:55.708914Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:56:55.710215Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4450.989246368408[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T08:56:57.466103Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T08:56:57.751755Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
[2m2025-09-20T08:57:00.005622Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T08:57:00.208052Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T08:57:00.209244Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4498.586893081665[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T08:57:00.209810Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T08:57:05.075683Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:57:05.320628Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:57:05.372071Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:57:05.470046Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:41904 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T08:57:07.410439Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:57:07.411277Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:55708 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:57:23.879555Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/templates[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35me95ef90d[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:23.880722Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/templates[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35me95ef90d[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:55714 - "OPTIONS /api/v1/strategies/templates HTTP/1.1" 200 OK
[2m2025-09-20T08:57:23.914905Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:55714 - "GET /api/v1/strategies/templates HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:57:29.566994Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/validate[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35maaea20e4[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:29.569187Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/validate[0m [36mprocess_time[0m=[35m0.002s[0m [36mrequest_id[0m=[35maaea20e4[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:56430 - "OPTIONS /api/v1/strategies/validate HTTP/1.1" 200 OK
[2m2025-09-20T08:57:29.588030Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/strategies/validate[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mc2bf5814[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:29.627274Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:57:29.842570Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/strategies/validate[0m [36mprocess_time[0m=[35m0.255s[0m [36mrequest_id[0m=[35mc2bf5814[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:56430 - "POST /api/v1/strategies/validate HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:57:35.433612Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/submissions[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35md5b6ac71[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:35.435738Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/submissions[0m [36mprocess_time[0m=[35m0.002s[0m [36mrequest_id[0m=[35md5b6ac71[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:57:35.443043Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/requirements[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m9faae328[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:35.446265Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/requirements[0m [36mprocess_time[0m=[35m0.003s[0m [36mrequest_id[0m=[35m9faae328[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:56432 - "OPTIONS /api/v1/strategies/publisher/submissions HTTP/1.1" 200 OK
INFO:     127.0.0.1:56440 - "OPTIONS /api/v1/strategies/publisher/requirements HTTP/1.1" 200 OK
[2m2025-09-20T08:57:35.464100Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:57:35.470838Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:56440 - "GET /api/v1/strategies/publisher/requirements HTTP/1.1" 200 OK
[2m2025-09-20T08:57:35.725112Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:56432 - "GET /api/v1/strategies/publisher/submissions HTTP/1.1" 200 OK
[2m2025-09-20T08:57:35.935573Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:57:35.977031Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:57:36.058206Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:56440 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:57:41.495077Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:57:42.245370Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/stats[0m [36mquery[0m=[35mperiod=30d[0m [36mrequest_id[0m=[35mc7fd686c[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:42.247094Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/stats[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35mc7fd686c[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:56450 - "OPTIONS /api/v1/strategies/publisher/stats?period=30d HTTP/1.1" 200 OK
[2m2025-09-20T08:57:42.257190Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/strategy-earnings[0m [36mquery[0m=[35mperiod=30d[0m [36mrequest_id[0m=[35m61e8753c[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:42.260801Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/strategy-earnings[0m [36mprocess_time[0m=[35m0.004s[0m [36mrequest_id[0m=[35m61e8753c[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:56450 - "OPTIONS /api/v1/strategies/publisher/strategy-earnings?period=30d HTTP/1.1" 200 OK
[2m2025-09-20T08:57:42.273043Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/earnings-history[0m [36mquery[0m=[35mperiod=30d[0m [36mrequest_id[0m=[35m2dfbe91a[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:42.274126Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/earnings-history[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m2dfbe91a[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:56450 - "OPTIONS /api/v1/strategies/publisher/earnings-history?period=30d HTTP/1.1" 200 OK
[2m2025-09-20T08:57:42.279550Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/reviews[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m7e70fa26[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:42.280095Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/reviews[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m7e70fa26[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:56450 - "OPTIONS /api/v1/strategies/publisher/reviews HTTP/1.1" 200 OK
[2m2025-09-20T08:57:42.295220Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/payouts[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mee833b67[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:42.295790Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/strategies/publisher/payouts[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35mee833b67[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:56450 - "OPTIONS /api/v1/strategies/publisher/payouts HTTP/1.1" 200 OK
[2m2025-09-20T08:57:42.311438Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:57:42.562632Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:57:42.575040Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:57:42.576850Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:57:42.594734Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:56450 - "GET /api/v1/strategies/publisher/stats?period=30d HTTP/1.1" 200 OK
INFO:     127.0.0.1:51702 - "GET /api/v1/strategies/publisher/earnings-history?period=30d HTTP/1.1" 200 OK
INFO:     127.0.0.1:51688 - "GET /api/v1/strategies/publisher/strategy-earnings?period=30d HTTP/1.1" 200 OK
1 change detected
INFO:     127.0.0.1:51688 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:57:44.211917Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.34091925621032715[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T08:57:44.260624Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.34133076667785645[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
1 change detected
INFO:     127.0.0.1:51714 - "GET /api/v1/strategies/publisher/reviews HTTP/1.1" 200 OK
INFO:     127.0.0.1:51726 - "GET /api/v1/strategies/publisher/payouts HTTP/1.1" 200 OK
[2m2025-09-20T08:57:46.946423Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m63c6db4f[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:46.947522Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m63c6db4f[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:51726 - "OPTIONS /api/v1/ab-testing/metrics HTTP/1.1" 200 OK
[2m2025-09-20T08:57:46.982434Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35md504f3a4[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:57:46.984353Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mprocess_time[0m=[35m0.002s[0m [36mrequest_id[0m=[35md504f3a4[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:51714 - "OPTIONS /api/v1/ab-testing/tests HTTP/1.1" 200 OK
[2m2025-09-20T08:57:47.013808Z[0m [[31m[1merror    [0m] [1mab_testing.production_mode_not_implemented[0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36mmessage[0m=[35mA/B Testing API called in production mode without database implementation[0m
[2m2025-09-20T08:57:47.014324Z[0m [[31m[1merror    [0m] [1mab_testing.get_metrics_failed [0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36merror[0m=[35m[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 295, in get_ab_testing_metrics
    await _check_demo_mode()  # Ensure demo mode for in-memory operations
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 243, in _check_demo_mode
    raise HTTPException(
fastapi.exceptions.HTTPException
[2m2025-09-20T08:57:47.018144Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to retrieve A/B testing metrics: [0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:47.020425Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mprocess_time[0m=[35m0.011s[0m [36mrequest_id[0m=[35mb3824e79[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:51726 - "GET /api/v1/ab-testing/metrics HTTP/1.1" 500 Internal Server Error
[2m2025-09-20T08:57:47.034111Z[0m [[31m[1merror    [0m] [1mab_testing.production_mode_not_implemented[0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36mmessage[0m=[35mA/B Testing API called in production mode without database implementation[0m
[2m2025-09-20T08:57:47.034585Z[0m [[31m[1merror    [0m] [1mab_testing.get_tests_failed   [0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36merror[0m=[35m[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 318, in get_ab_tests
    await _check_demo_mode()  # Ensure demo mode for in-memory operations
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 243, in _check_demo_mode
    raise HTTPException(
fastapi.exceptions.HTTPException
[2m2025-09-20T08:57:47.035472Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to retrieve A/B tests: [0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:47.036795Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mprocess_time[0m=[35m0.009s[0m [36mrequest_id[0m=[35m5cb36493[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:51714 - "GET /api/v1/ab-testing/tests HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:57:48.056046Z[0m [[31m[1merror    [0m] [1mab_testing.production_mode_not_implemented[0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36mmessage[0m=[35mA/B Testing API called in production mode without database implementation[0m
[2m2025-09-20T08:57:48.056308Z[0m [[31m[1merror    [0m] [1mab_testing.get_metrics_failed [0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36merror[0m=[35m[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 295, in get_ab_testing_metrics
    await _check_demo_mode()  # Ensure demo mode for in-memory operations
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 243, in _check_demo_mode
    raise HTTPException(
fastapi.exceptions.HTTPException
[2m2025-09-20T08:57:48.056692Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to retrieve A/B testing metrics: [0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:48.057231Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mprocess_time[0m=[35m0.002s[0m [36mrequest_id[0m=[35m8f5ebed5[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:51714 - "GET /api/v1/ab-testing/metrics HTTP/1.1" 500 Internal Server Error
[2m2025-09-20T08:57:48.071527Z[0m [[31m[1merror    [0m] [1mab_testing.production_mode_not_implemented[0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36mmessage[0m=[35mA/B Testing API called in production mode without database implementation[0m
[2m2025-09-20T08:57:48.071944Z[0m [[31m[1merror    [0m] [1mab_testing.get_tests_failed   [0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36merror[0m=[35m[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 318, in get_ab_tests
    await _check_demo_mode()  # Ensure demo mode for in-memory operations
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 243, in _check_demo_mode
    raise HTTPException(
fastapi.exceptions.HTTPException
[2m2025-09-20T08:57:48.072763Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to retrieve A/B tests: [0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:48.073716Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mprocess_time[0m=[35m0.005s[0m [36mrequest_id[0m=[35mef0a624e[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:51714 - "GET /api/v1/ab-testing/tests HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:57:50.073746Z[0m [[31m[1merror    [0m] [1mab_testing.production_mode_not_implemented[0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36mmessage[0m=[35mA/B Testing API called in production mode without database implementation[0m
[2m2025-09-20T08:57:50.074152Z[0m [[31m[1merror    [0m] [1mab_testing.get_metrics_failed [0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36merror[0m=[35m[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 295, in get_ab_testing_metrics
    await _check_demo_mode()  # Ensure demo mode for in-memory operations
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 243, in _check_demo_mode
    raise HTTPException(
fastapi.exceptions.HTTPException
[2m2025-09-20T08:57:50.074826Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to retrieve A/B testing metrics: [0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:50.075657Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mprocess_time[0m=[35m0.005s[0m [36mrequest_id[0m=[35mfd3b19b0[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:51714 - "GET /api/v1/ab-testing/metrics HTTP/1.1" 500 Internal Server Error
[2m2025-09-20T08:57:50.091952Z[0m [[31m[1merror    [0m] [1mab_testing.production_mode_not_implemented[0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36mmessage[0m=[35mA/B Testing API called in production mode without database implementation[0m
[2m2025-09-20T08:57:50.092161Z[0m [[31m[1merror    [0m] [1mab_testing.get_tests_failed   [0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36merror[0m=[35m[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 318, in get_ab_tests
    await _check_demo_mode()  # Ensure demo mode for in-memory operations
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 243, in _check_demo_mode
    raise HTTPException(
fastapi.exceptions.HTTPException
[2m2025-09-20T08:57:50.092436Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to retrieve A/B tests: [0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:50.092754Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mprocess_time[0m=[35m0.002s[0m [36mrequest_id[0m=[35md3c4ac42[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:51714 - "GET /api/v1/ab-testing/tests HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:57:54.110674Z[0m [[31m[1merror    [0m] [1mab_testing.production_mode_not_implemented[0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36mmessage[0m=[35mA/B Testing API called in production mode without database implementation[0m
[2m2025-09-20T08:57:54.110904Z[0m [[31m[1merror    [0m] [1mab_testing.get_metrics_failed [0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36merror[0m=[35m[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 295, in get_ab_testing_metrics
    await _check_demo_mode()  # Ensure demo mode for in-memory operations
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 243, in _check_demo_mode
    raise HTTPException(
fastapi.exceptions.HTTPException
[2m2025-09-20T08:57:54.111196Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to retrieve A/B testing metrics: [0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:54.111565Z[0m [[31m[1merror    [0m] [1mab_testing.production_mode_not_implemented[0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36mmessage[0m=[35mA/B Testing API called in production mode without database implementation[0m
[2m2025-09-20T08:57:54.111685Z[0m [[31m[1merror    [0m] [1mab_testing.get_tests_failed   [0m [[34m[1mapp.api.v1.endpoints.ab_testing[0m] [36merror[0m=[35m[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 318, in get_ab_tests
    await _check_demo_mode()  # Ensure demo mode for in-memory operations
  File "/home/kopi/CryptoUniverse-fresh/app/api/v1/endpoints/ab_testing.py", line 243, in _check_demo_mode
    raise HTTPException(
fastapi.exceptions.HTTPException
[2m2025-09-20T08:57:54.111912Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to retrieve A/B tests: [0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:54.112285Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/metrics[0m [36mprocess_time[0m=[35m0.005s[0m [36mrequest_id[0m=[35m85672de1[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:57:54.112701Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/ab-testing/tests[0m [36mprocess_time[0m=[35m0.004s[0m [36mrequest_id[0m=[35m84683ec8[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:51714 - "GET /api/v1/ab-testing/metrics HTTP/1.1" 500 Internal Server Error
INFO:     127.0.0.1:51730 - "GET /api/v1/ab-testing/tests HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:57:56.603299Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:51714 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:58:00.738019Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:58:00.738554Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:58:00.738892Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T08:58:00.739165Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:58:05.312457Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/users[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35me5ea9465[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:58:05.316511Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/system/status[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mbe40e6f2[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:58:05.318953Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/users/pending-verification[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m5ef3c534[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:58:05.320300Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/users[0m [36mprocess_time[0m=[35m0.008s[0m [36mrequest_id[0m=[35me5ea9465[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:58:05.321746Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/system/status[0m [36mprocess_time[0m=[35m0.005s[0m [36mrequest_id[0m=[35mbe40e6f2[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:58:05.322411Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/users/pending-verification[0m [36mprocess_time[0m=[35m0.004s[0m [36mrequest_id[0m=[35m5ef3c534[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:53024 - "OPTIONS /api/v1/admin/users HTTP/1.1" 200 OK
INFO:     127.0.0.1:53032 - "OPTIONS /api/v1/admin/system/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:53044 - "OPTIONS /api/v1/admin/users/pending-verification HTTP/1.1" 200 OK
[2m2025-09-20T08:58:05.338484Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/audit-logs[0m [36mquery[0m=[35mlimit=10[0m [36mrequest_id[0m=[35md54db60d[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:58:05.341778Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/audit-logs[0m [36mprocess_time[0m=[35m0.003s[0m [36mrequest_id[0m=[35md54db60d[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:53058 - "OPTIONS /api/v1/admin/audit-logs?limit=10 HTTP/1.1" 200 OK
[2m2025-09-20T08:58:05.372990Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/users[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m21fe4c84[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:58:05.375332Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/system/status[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m92d726db[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:58:05.377044Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/users[0m [36mprocess_time[0m=[35m0.004s[0m [36mrequest_id[0m=[35m21fe4c84[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:58:05.378238Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/system/status[0m [36mprocess_time[0m=[35m0.003s[0m [36mrequest_id[0m=[35m92d726db[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:53070 - "OPTIONS /api/v1/admin/users HTTP/1.1" 200 OK
[2m2025-09-20T08:58:05.394133Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/users/pending-verification[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m2b16c8ba[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
INFO:     127.0.0.1:53072 - "OPTIONS /api/v1/admin/system/status HTTP/1.1" 200 OK
[2m2025-09-20T08:58:05.403298Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/audit-logs[0m [36mquery[0m=[35mlimit=10[0m [36mrequest_id[0m=[35mab846458[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:58:05.407608Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:58:05.408691Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/users/pending-verification[0m [36mprocess_time[0m=[35m0.015s[0m [36mrequest_id[0m=[35m2b16c8ba[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T08:58:05.409533Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/admin/audit-logs[0m [36mprocess_time[0m=[35m0.006s[0m [36mrequest_id[0m=[35mab846458[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:53024 - "OPTIONS /api/v1/admin/users/pending-verification HTTP/1.1" 200 OK
INFO:     127.0.0.1:53032 - "OPTIONS /api/v1/admin/audit-logs?limit=10 HTTP/1.1" 200 OK
[2m2025-09-20T08:58:05.428536Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:58:05.444114Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:58:05.449723Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:58:05.728836Z[0m [[31m[1merror    [0m] [1mFailed to get global system status[0m [[34m[1mMasterSystemController[0m] [36merror[0m=[35m'NoneType' object has no attribute 'keys'[0m
INFO:     127.0.0.1:53070 - "GET /api/v1/admin/users/pending-verification HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:58:05.897437Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:58:06.134108Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.33832645416259766[0m [36mstatement[0m=[35mSELECT audit_logs.id, audit_logs.user_id, audit_logs.event_type, audit_logs.event_data, audit_logs.level, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER...[0m
[2m2025-09-20T08:58:06.144846Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:53058 - "GET /api/v1/admin/system/status HTTP/1.1" 200 OK
[2m2025-09-20T08:58:06.208317Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:53070 - "GET /api/v1/admin/users/pending-verification HTTP/1.1" 200 OK
INFO:     127.0.0.1:53044 - "GET /api/v1/admin/users HTTP/1.1" 200 OK
[2m2025-09-20T08:58:06.350511Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:58:06.382487Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:58:06.482631Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:58:06.484750Z[0m [[31m[1merror    [0m] [1mFailed to get global system status[0m [[34m[1mMasterSystemController[0m] [36merror[0m=[35m'NoneType' object has no attribute 'keys'[0m
INFO:     127.0.0.1:53072 - "GET /api/v1/admin/audit-logs?limit=10 HTTP/1.1" 200 OK
[2m2025-09-20T08:58:06.583338Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:58:06.608249Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:53032 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
INFO:     127.0.0.1:53058 - "GET /api/v1/admin/system/status HTTP/1.1" 200 OK
1 change detected
INFO:     127.0.0.1:53070 - "GET /api/v1/admin/users HTTP/1.1" 200 OK
[2m2025-09-20T08:58:07.362203Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3069922924041748[0m [36mstatement[0m=[35mSELECT audit_logs.id, audit_logs.user_id, audit_logs.event_type, audit_logs.event_data, audit_logs.level, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER...[0m
INFO:     127.0.0.1:53044 - "GET /api/v1/admin/audit-logs?limit=10 HTTP/1.1" 200 OK
1 change detected
INFO:     ('127.0.0.1', 60602) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
[2m2025-09-20T08:58:14.093431Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mfe6b03aa[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:58:14.106233Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:58:14.118633Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mbdff97ca[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
INFO:     ('127.0.0.1', 60638) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
[2m2025-09-20T08:58:14.125369Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     connection open
INFO:     127.0.0.1:60654 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T08:58:14.320954Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m00ffb028-dcd6-485e-a690-fd014b4b23f4[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:58:14.322147Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.229s[0m [36mrequest_id[0m=[35mfe6b03aa[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:60610 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T08:58:14.366374Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m1b60a678-59f2-4b5a-a000-55a284d5321d[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:58:14.368577Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.250s[0m [36mrequest_id[0m=[35mbdff97ca[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:60626 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:58:36.635641Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:58:36.871138Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:58:36.967745Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:58:37.064738Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:60662 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
[2m2025-09-20T08:58:41.496544Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:57306 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:59:07.087335Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:07.377635Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:59:07.414438Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T08:59:07.416551Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T08:59:07.418886Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:59:07.500483Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:57314 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
INFO:     127.0.0.1:55650 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:59:24.538593Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mquery[0m=[35mperiod=month&limit=50[0m [36mrequest_id[0m=[35mcdb61a03[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:59:24.539987Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35mcdb61a03[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:55664 - "OPTIONS /api/v1/credits/transaction-history?period=month&limit=50 HTTP/1.1" 200 OK
[2m2025-09-20T08:59:24.561129Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:24.894272Z[0m [[31m[1merror    [0m] [1mFailed to get transaction history[0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:59:24.942757Z[0m [[31m[1merror    [0m] [1mDatabase operation failed     [0m [[34m[1mapp.core.database[0m] [36merror[0m=[35m[0m
[2m2025-09-20T08:59:24.943545Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to get transaction history: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:59:24.944765Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mprocess_time[0m=[35m0.388s[0m [36mrequest_id[0m=[35mf4e8db0d[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:55664 - "GET /api/v1/credits/transaction-history?period=month&limit=50 HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:59:25.962494Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:59:26.254073Z[0m [[31m[1merror    [0m] [1mFailed to get transaction history[0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:59:26.295026Z[0m [[31m[1merror    [0m] [1mDatabase operation failed     [0m [[34m[1mapp.core.database[0m] [36merror[0m=[35m[0m
[2m2025-09-20T08:59:26.295699Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to get transaction history: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:59:26.296235Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mprocess_time[0m=[35m0.336s[0m [36mrequest_id[0m=[35mb4918f47[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:55664 - "GET /api/v1/credits/transaction-history?period=month&limit=50 HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:59:28.314543Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:28.655920Z[0m [[31m[1merror    [0m] [1mFailed to get transaction history[0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:59:28.703290Z[0m [[31m[1merror    [0m] [1mDatabase operation failed     [0m [[34m[1mapp.core.database[0m] [36merror[0m=[35m[0m
[2m2025-09-20T08:59:28.703722Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to get transaction history: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:59:28.704124Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mprocess_time[0m=[35m0.391s[0m [36mrequest_id[0m=[35m018772b1[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:55664 - "GET /api/v1/credits/transaction-history?period=month&limit=50 HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:59:32.728722Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:33.081962Z[0m [[31m[1merror    [0m] [1mFailed to get transaction history[0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:59:33.129159Z[0m [[31m[1merror    [0m] [1mDatabase operation failed     [0m [[34m[1mapp.core.database[0m] [36merror[0m=[35m[0m
[2m2025-09-20T08:59:33.129653Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to get transaction history: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:59:33.130111Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mprocess_time[0m=[35m0.402s[0m [36mrequest_id[0m=[35m75724976[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:55664 - "GET /api/v1/credits/transaction-history?period=month&limit=50 HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:59:36.668811Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/credits/purchase-options[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m36df1f54[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T08:59:36.669371Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mOPTIONS[0m [36mpath[0m=[35m/api/v1/credits/purchase-options[0m [36mprocess_time[0m=[35m0.001s[0m [36mrequest_id[0m=[35m36df1f54[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:55664 - "OPTIONS /api/v1/credits/purchase-options HTTP/1.1" 200 OK
[2m2025-09-20T08:59:36.679735Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:55664 - "GET /api/v1/credits/purchase-options HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:59:37.530323Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:37.858673Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T08:59:37.908190Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T08:59:38.003916Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:55664 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:59:39.124730Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:39.411623Z[0m [[31m[1merror    [0m] [1mFailed to get transaction history[0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
[2m2025-09-20T08:59:39.455041Z[0m [[31m[1merror    [0m] [1mDatabase operation failed     [0m [[34m[1mapp.core.database[0m] [36merror[0m=[35m[0m
[2m2025-09-20T08:59:39.455837Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to get transaction history: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:59:39.458015Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mprocess_time[0m=[35m0.337s[0m [36mrequest_id[0m=[35m49b4cec1[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:55664 - "GET /api/v1/credits/transaction-history?period=month&limit=50 HTTP/1.1" 500 Internal Server Error
1 change detected
[2m2025-09-20T08:59:40.548385Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:40.886471Z[0m [[31m[1merror    [0m] [1mFailed to get transaction history[0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
1 change detected
[2m2025-09-20T08:59:40.933129Z[0m [[31m[1merror    [0m] [1mDatabase operation failed     [0m [[34m[1mapp.core.database[0m] [36merror[0m=[35m[0m
[2m2025-09-20T08:59:40.933692Z[0m [[33m[1mwarning  [0m] [1mHTTP exception                [0m [[34m[1mmain[0m] [36mdetail[0m=[35mFailed to get transaction history: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column credit_transactions.provider does not exist
[SQL: SELECT credit_transactions.id, credit_transactions.account_id, credit_transactions.transaction_type, credit_transactions.amount, credit_transactions.description, credit_transactions.balance_before, credit_transactions.balance_after, credit_transactions.trade_id, credit_transactions.credit_pack_id, credit_transactions.usd_value, credit_transactions.profit_amount_usd, credit_transactions.provider, credit_transactions.reference_id, credit_transactions.stripe_payment_intent_id, credit_transactions.billing_history_id, credit_transactions.meta_data, credit_transactions.source, credit_transactions.ip_address, credit_transactions.expires_at, credit_transactions.expired_at, credit_transactions.status, credit_transactions.created_at, credit_transactions.processed_at 
FROM credit_transactions JOIN credit_accounts ON credit_transactions.account_id = credit_accounts.id 
WHERE credit_accounts.user_id = $1::UUID ORDER BY credit_transactions.created_at DESC 
 LIMIT $2::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 50)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mstatus_code[0m=[35m500[0m
[2m2025-09-20T08:59:40.934308Z[0m [[31m[1merror    [0m] [1mRequest completed with server error[0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/credits/transaction-history[0m [36mprocess_time[0m=[35m0.387s[0m [36mrequest_id[0m=[35m3b3cb9b5[0m [36mstatus_code[0m=[35m500[0m
INFO:     127.0.0.1:55664 - "GET /api/v1/credits/transaction-history?period=month&limit=50 HTTP/1.1" 500 Internal Server Error
[2m2025-09-20T08:59:41.497699Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T08:59:42.556939Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
INFO:     127.0.0.1:55664 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T08:59:43.366217Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:43.398990Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
INFO:     127.0.0.1:55664 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
INFO:     127.0.0.1:55664 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:59:44.808612Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3247072696685791[0m [36mstatement[0m=[35mINSERT INTO exchange_balances (id, account_id, symbol, asset_type, total_balance, available_balance, locked_balance, usd_value, balance_change_24h, is_active, sync_enabled, created_at, updated_at, las...[0m
[2m2025-09-20T08:59:46.192377Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:59:46.193662Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m2.829s[0m [36mrequest_id[0m=[35m604f6240[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:44476 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:59:46.201732Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:46.211998Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T08:59:46.791441Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.32669901847839355[0m [36mstatement[0m=[35mSELECT exchange_api_keys.id, exchange_api_keys.account_id, exchange_api_keys.key_name, exchange_api_keys.key_type, exchange_api_keys.encrypted_api_key, exchange_api_keys.encrypted_secret_key, exchange...[0m
[2m2025-09-20T08:59:49.256517Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:59:49.260083Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m3.059s[0m [36mrequest_id[0m=[35m035619f2[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:44476 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:59:49.758382Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:59:49.760203Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kucoin/balances[0m [36mprocess_time[0m=[35m3.549s[0m [36mrequest_id[0m=[35m169990af[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:55664 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:59:49.782054Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:49.785645Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:50.266435Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_9eed661e[0m
[2m2025-09-20T08:59:50.266818Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_1a849046[0m
[2m2025-09-20T08:59:50.267071Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_4b543624[0m
[2m2025-09-20T08:59:50.675103Z[0m [[32m[1minfo     [0m] [1mKraken server time synced     [0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36moffset[0m=[35m0.7330093383789062[0m
[2m2025-09-20T08:59:50.676953Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358791409[0m [36mfallback_uses[0m=[35m25[0m [36mlocal_count[0m=[35m25[0m [36mnode_hash[0m=[35m325[0m [36mnonce[0m=[35m1758358791759[0m
1 change detected
[2m2025-09-20T08:59:50.889691Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:59:51.690536Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
INFO:     127.0.0.1:55664 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T08:59:52.109229Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:59:54.463166Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:59:54.560435Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:59:54.561244Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.778s[0m [36mrequest_id[0m=[35m06387149[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:44476 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
[2m2025-09-20T08:59:54.570185Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T08:59:54.983013Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_44540d61[0m
[2m2025-09-20T08:59:54.983282Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_cf0ceb14[0m
[2m2025-09-20T08:59:54.983405Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358795716[0m [36mfallback_uses[0m=[35m26[0m [36mlocal_count[0m=[35m26[0m [36mnode_hash[0m=[35m443[0m [36mnonce[0m=[35m1758358796185[0m
[2m2025-09-20T08:59:55.280822Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T08:59:56.510731Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
1 change detected
[2m2025-09-20T08:59:58.865111Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:59:58.956158Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T08:59:58.957301Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.388s[0m [36mrequest_id[0m=[35m0dd7de89[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:44476 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
[2m2025-09-20T09:00:01.411922Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:00:01.412151Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:00:01.412268Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:00:01.412362Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
[2m2025-09-20T09:00:03.582646Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T09:00:04.017774Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T09:00:06.134193Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:00:06.296391Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:00:06.297516Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m6087.044715881348[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:00:08.027630Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:00:08.270235Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:08.319656Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:08.364576Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:00:08.415963Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:53080 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:00:08.750030Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:00:11.184158Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:00:11.621036Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:00:11.622143Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5324.201822280884[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:00:13.694945Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
INFO:     127.0.0.1:37454 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T09:00:14.144141Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T09:00:16.568129Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T09:00:16.733059Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:00:16.734710Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5112.080097198486[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:00:16.907747Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:00:16.922799Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:00:17.183513Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:37458 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T09:00:17.664670Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:00:17.708655Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.523618221282959[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:00:17.709497Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:17.709678Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:17.963621Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.25203537940979004[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
1 change detected
[2m2025-09-20T09:00:18.163583Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2502412796020508[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T09:00:18.215088Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.503258466720581[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:00:18.324040Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_6d3409c7[0m
[2m2025-09-20T09:00:18.324440Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_8a7e4e18[0m
[2m2025-09-20T09:00:18.324637Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358819057[0m [36mfallback_uses[0m=[35m27[0m [36mlocal_count[0m=[35m27[0m [36mnode_hash[0m=[35m345[0m [36mnonce[0m=[35m1758358819429[0m
INFO:     127.0.0.1:37458 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T09:00:18.650980Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m941.0126209259033[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.27[0m
[2m2025-09-20T09:00:18.660493Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:00:18.840327Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:00:19.064839Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1354.8202514648438[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1752.75[0m
[2m2025-09-20T09:00:19.207730Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T09:00:19.961724Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:00:21.324187Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:00:21.664174Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:00:21.676536Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4940.802574157715[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:00:22.183627Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T09:00:22.184113Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:00:22.831364Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4352900981903076[0m [36mstatement[0m=[35mSELECT exchange_balances.id, exchange_balances.account_id, exchange_balances.symbol, exchange_balances.asset_type, exchange_balances.total_balance, exchange_balances.available_balance, exchange_balanc...[0m
[2m2025-09-20T09:00:22.929910Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3963.080000000001[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T09:00:23.612638Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:00:23.736460Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:00:23.824898Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.920s[0m [36mrequest_id[0m=[35m1e0bb1a2[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:37454 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T09:00:23.881924Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:00:24.092905Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:24.138637Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:24.139214Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T09:00:24.381019Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:00:24.429985Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2854292392730713[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:00:24.597135Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4518096446990967[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:00:24.791437Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_795858f8[0m
[2m2025-09-20T09:00:24.791815Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_ac428d97[0m
[2m2025-09-20T09:00:24.792036Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358825525[0m [36mfallback_uses[0m=[35m28[0m [36mlocal_count[0m=[35m28[0m [36mnode_hash[0m=[35m329[0m [36mnonce[0m=[35m1758358825882[0m
[2m2025-09-20T09:00:25.103587Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m962.9342555999756[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.0800000000002[0m
[2m2025-09-20T09:00:25.188408Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:00:25.280192Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1139.791488647461[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.4300000000003[0m
1 change detected
[2m2025-09-20T09:00:26.407218Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:00:26.443413Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:00:26.619868Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:00:26.621661Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4944.275379180908[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:00:28.412293Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T09:00:28.766102Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:00:28.766552Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4626.020908355713[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:00:28.766905Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4627.6843547821045[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4674.009084701538[0m [36mtotal_value_usd[0m=[35m4015.51[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:28.768247Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:00:28.799587Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:00:28.884063Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:00:29.143992Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:29.154774Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3963.080000000001[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:29.243508Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:29.243754Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:29.491041Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.21276640892028809[0m [36mstatement[0m=[35mSELECT portfolios.total_value_usd, portfolios.created_at 
FROM portfolios 
WHERE portfolios.user_id = $1::UUID AND portfolios.created_at >= $2::TIMESTAMP WITHOUT TIME ZONE AND portfolios.created_at <=...[0m
[2m2025-09-20T09:00:29.493750Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24843382835388184[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:00:29.689036Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.44335460662841797[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:00:29.786289Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_7b768583[0m
[2m2025-09-20T09:00:29.786544Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_1e03c61d[0m
[2m2025-09-20T09:00:29.786660Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358830519[0m [36mfallback_uses[0m=[35m29[0m [36mlocal_count[0m=[35m29[0m [36mnode_hash[0m=[35m373[0m [36mnonce[0m=[35m1758358830921[0m
1 change detected
[2m2025-09-20T09:00:30.092230Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m848.1490612030029[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.29[0m
[2m2025-09-20T09:00:30.092563Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m848.4988212585449[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.0700000000002[0m
[2m2025-09-20T09:00:30.139403Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:00:30.236428Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.356s[0m [36mrequest_id[0m=[35m9c75e2e6[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T09:00:30.425173Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:00:30.537343Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:00:30.584185Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:00:30.586483Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3964.000463485718[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:00:30.586940Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
[2m2025-09-20T09:00:31.738700Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:00:32.885498Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/paper-trading/setup[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m5996dbca[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T09:00:32.889068Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:00:33.126701Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/paper-trading/setup[0m [36mprocess_time[0m=[35m0.241s[0m [36mrequest_id[0m=[35m5996dbca[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:46466 - "POST /api/v1/paper-trading/setup HTTP/1.1" 200 OK
[2m2025-09-20T09:00:33.178671Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:46466 - "GET /api/v1/paper-trading/stats HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:00:34.144438Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T09:00:34.144920Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:00:34.441879Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3963.080000000001[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T09:00:34.987057Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:00:35.075689Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.193s[0m [36mrequest_id[0m=[35m3f0ec1a3[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:37466 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:00:38.441841Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:00:38.688374Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T09:00:38.738193Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:00:38.838189Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:37466 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
[2m2025-09-20T09:00:41.499323Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:37466 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T09:01:07.419491Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:01:07.420645Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T09:01:09.177340Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:01:09.177748Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 13 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T09:01:09.178107Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T09:01:09.181217Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T09:01:09.390411Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:09.433237Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:09.518020Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:34176 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
INFO:     127.0.0.1:34176 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T09:01:14.159226Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
[2m2025-09-20T09:01:14.161553Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
[2m2025-09-20T09:01:14.173784Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
[2m2025-09-20T09:01:14.177558Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
[2m2025-09-20T09:01:14.178490Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
[2m2025-09-20T09:01:14.190849Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
INFO:     connection closed
1 change detected
[2m2025-09-20T09:01:16.358522Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:16.363191Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:16.639858Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:16.662352Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:16.668436Z[0m [[32m[1minfo     [0m] [1mGetting credit balance        [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:16.684439Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:34246 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
INFO:     127.0.0.1:34246 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T09:01:16.719343Z[0m [[32m[1minfo     [0m] [1mRetrieved credit account      [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36mavailable_credits[0m=[35m900[0m [36mtotal_credits[0m=[35m1000[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:16.813915Z[0m [[33m[1mwarning  [0m] [1mProfit query failed, using 0  [0m [[34m[1mapp.api.v1.endpoints.credits[0m] [36merror[0m=[35m(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: character varying = tradestatus
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT sum(trades.profit_realized_usd) AS sum_1 
FROM trades 
WHERE trades.user_id = $1::UUID AND trades.status = $2::tradestatus AND trades.is_simulation = false AND trades.profit_realized_usd > $3::INTEGER]
[parameters: (UUID('7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af'), 'COMPLETED', 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)[0m
INFO:     127.0.0.1:34192 - "GET /api/v1/credits/balance HTTP/1.1" 200 OK
INFO:     127.0.0.1:34176 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T09:01:16.878880Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:16.888132Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:16.896574Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:34220 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T09:01:16.935372Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:16.935747Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:16.980850Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:17.709308Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.7707138061523438[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
1 change detected
[2m2025-09-20T09:01:17.843756Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20361781120300293[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T09:01:17.896602Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.9570765495300293[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:18.016481Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_c37bfaff[0m
[2m2025-09-20T09:01:18.016916Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_b93fb0ce[0m
[2m2025-09-20T09:01:18.017174Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358878750[0m [36mfallback_uses[0m=[35m30[0m [36mlocal_count[0m=[35m30[0m [36mnode_hash[0m=[35m153[0m [36mnonce[0m=[35m1758358878933[0m
[2m2025-09-20T09:01:18.293615Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:18.332185Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2202897071838379[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:18.339143Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3183937072753906[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
INFO:     127.0.0.1:34220 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T09:01:18.422271Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:34176 - "GET /api/v1/exchanges/list HTTP/1.1" 200 OK
[2m2025-09-20T09:01:18.566260Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1629.7600269317627[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.6400000000003[0m
[2m2025-09-20T09:01:18.702987Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1766.460657119751[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.9[0m
INFO:     127.0.0.1:34220 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T09:01:18.807217Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
INFO:     127.0.0.1:34220 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T09:01:19.489346Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:19.566638Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35mb4e9ee02[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T09:01:19.567573Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m6406e562[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T09:01:19.569718Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:19.573191Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:19.781984Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35m3bf9cdf7-2e98-4e7b-b5b0-631e18151efb[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:19.783553Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.216s[0m [36mrequest_id[0m=[35m6406e562[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34176 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
INFO:     ('127.0.0.1', 49410) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
[2m2025-09-20T09:01:19.847442Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35mbf6df241-666a-406c-88e8-0801b174de40[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:19.850461Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.284s[0m [36mrequest_id[0m=[35mb4e9ee02[0m [36mstatus_code[0m=[35m200[0m
INFO:     ('127.0.0.1', 49418) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
INFO:     127.0.0.1:34220 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:01:20.659175Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:20.660341Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m3.774s[0m [36mrequest_id[0m=[35m2e2419eb[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34192 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T09:01:20.681906Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:20.727465Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T09:01:21.866473Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:21.867323Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4930.8202266693115[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:01:21.867732Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4931.912183761597[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4988.828420639038[0m [36mtotal_value_usd[0m=[35m4016.5400000000004[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:21.868249Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:01:22.175024Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3963.680000000001[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:22.551355Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
INFO:     127.0.0.1:34192 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T09:01:22.674948Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T09:01:23.207947Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_7f7fe19d[0m
[2m2025-09-20T09:01:23.208430Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_1183b718[0m
[2m2025-09-20T09:01:23.208681Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358883941[0m [36mfallback_uses[0m=[35m31[0m [36mlocal_count[0m=[35m31[0m [36mnode_hash[0m=[35m141[0m [36mnonce[0m=[35m1758358884113[0m
[2m2025-09-20T09:01:23.436174Z[0m [[32m[1minfo     [0m] [1mUpdated 28 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange binance[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:23.438583Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/binance/balances[0m [36mprocess_time[0m=[35m2.759s[0m [36mrequest_id[0m=[35m7934134d[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34220 - "GET /api/v1/exchanges/binance/balances HTTP/1.1" 200 OK
[2m2025-09-20T09:01:23.480028Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:23.491521Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:01:24.000552Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.24494719505310059[0m [36mstatement[0m=[35mSELECT exchange_balances.balance_change_24h, exchange_balances.usd_value 
FROM exchange_balances JOIN exchange_accounts ON exchange_accounts.id = exchange_balances.account_id 
WHERE exchange_accounts....[0m
[2m2025-09-20T09:01:24.382899Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:01:24.486625Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m7.849s[0m [36mrequest_id[0m=[35m522da566[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34208 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T09:01:24.559574Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:24.830423Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:25.070472Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3702816963195801[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T09:01:25.071384Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T09:01:25.175580Z[0m [[32m[1minfo     [0m] [1mUpdated 10 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kucoin[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
INFO:     127.0.0.1:34220 - "GET /api/v1/exchanges/kucoin/balances HTTP/1.1" 200 OK
[2m2025-09-20T09:01:25.273944Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:25.274863Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:25.606012Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.32256197929382324[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:25.806504Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.5198657512664795[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:26.024309Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_668baaa6[0m
[2m2025-09-20T09:01:26.024610Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_e4a1deaa[0m
[2m2025-09-20T09:01:26.024734Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358886757[0m [36mfallback_uses[0m=[35m32[0m [36mlocal_count[0m=[35m32[0m [36mnode_hash[0m=[35m51[0m [36mnonce[0m=[35m1758358886840[0m
[2m2025-09-20T09:01:26.278285Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:01:26.408166Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1132.228136062622[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.9100000000003[0m
[2m2025-09-20T09:01:26.422760Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1146.5964317321777[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.6400000000003[0m
[2m2025-09-20T09:01:27.132348Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:27.231670Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:27.232965Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.559s[0m [36mrequest_id[0m=[35me2ae5ab0[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34192 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
[2m2025-09-20T09:01:27.244954Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T09:01:27.542069Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:27.752067Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_0331781b[0m
[2m2025-09-20T09:01:27.754142Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_172c5b0c[0m
[2m2025-09-20T09:01:27.754338Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358888487[0m [36mfallback_uses[0m=[35m33[0m [36mlocal_count[0m=[35m33[0m [36mnode_hash[0m=[35m751[0m [36mnonce[0m=[35m1758358889271[0m
[2m2025-09-20T09:01:28.156044Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:01:29.486921Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:29.561915Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:29.742532Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:29.742860Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4466.546297073364[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:01:29.743080Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4468.275785446167[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4671.701669692993[0m [36mtotal_value_usd[0m=[35m4016.5500000000006[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:29.743357Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:01:29.800004Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:29.851879Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:29.852244Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:30.070930Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20522594451904297[0m [36mstatement[0m=[35mSELECT exchange_balances.id, exchange_balances.account_id, exchange_balances.symbol, exchange_balances.asset_type, exchange_balances.total_balance, exchange_balances.available_balance, exchange_balanc...[0m
[2m2025-09-20T09:01:30.075362Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.22111010551452637[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:30.181204Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3964.7700000000013[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:30.236114Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3814067840576172[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:30.351048Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_fde23daa[0m
[2m2025-09-20T09:01:30.351378Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_f1087120[0m
[2m2025-09-20T09:01:30.351507Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358891084[0m [36mfallback_uses[0m=[35m34[0m [36mlocal_count[0m=[35m34[0m [36mnode_hash[0m=[35m779[0m [36mnonce[0m=[35m1758358891897[0m
1 change detected
[2m2025-09-20T09:01:30.558607Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:30.640890Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m788.200855255127[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.6400000000003[0m
[2m2025-09-20T09:01:30.710957Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m858.3745956420898[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.8400000000006[0m
[2m2025-09-20T09:01:31.042542Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:01:31.132561Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.575s[0m [36mrequest_id[0m=[35m042d2c2a[0m [36mstatus_code[0m=[35m200[0m
1 change detected
[2m2025-09-20T09:01:31.330315Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m14.43897795677185[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m11[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:31.331560Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m14.649s[0m [36mrequest_id[0m=[35m50a52b44[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34236 - "GET /api/v1/trading/market-overview HTTP/1.1" 200 OK
[2m2025-09-20T09:01:31.377620Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:31.739742Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:31.834152Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:31.882982Z[0m [[32m[1minfo     [0m] [1mUpdated 0 balance records for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af, exchange kraken[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:31.884202Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/exchanges/kraken/balances[0m [36mprocess_time[0m=[35m4.641s[0m [36mrequest_id[0m=[35m30f69b92[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34192 - "GET /api/v1/exchanges/kraken/balances HTTP/1.1" 200 OK
[2m2025-09-20T09:01:32.092511Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:34192 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
[2m2025-09-20T09:01:32.349609Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     127.0.0.1:34192 - "GET /api/v1/trading/status HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:01:34.059173Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:34.059705Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4207.031726837158[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:01:34.060181Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4207.868337631226[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4260.17951965332[0m [36mtotal_value_usd[0m=[35m4016.480000000001[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:34.060788Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:01:34.391577Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3964.7700000000013[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T09:01:34.972462Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:01:35.060277Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m5.499s[0m [36mrequest_id[0m=[35m9701b491[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34220 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T09:01:35.115623Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:35.354368Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:35.404707Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:35.405119Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:35.640133Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.23256611824035645[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
1 change detected
[2m2025-09-20T09:01:35.970169Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.5610294342041016[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:36.191251Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_fb968f39[0m
[2m2025-09-20T09:01:36.191611Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_a8dfb8ad[0m
[2m2025-09-20T09:01:36.191806Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358896924[0m [36mfallback_uses[0m=[35m35[0m [36mlocal_count[0m=[35m35[0m [36mnode_hash[0m=[35m926[0m [36mnonce[0m=[35m1758358897885[0m
[2m2025-09-20T09:01:36.302112Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:36.546759Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:36.659863Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:36.660469Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1254.6391487121582[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.4700000000003[0m
[2m2025-09-20T09:01:36.693118Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:36.708915Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:36.709332Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:36.750864Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1344.9053764343262[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.6100000000001[0m
[2m2025-09-20T09:01:37.013942Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.29193830490112305[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:37.290480Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.28333592414855957[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T09:01:37.305377Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.5826902389526367[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:37.572564Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_04a7e1d4[0m
[2m2025-09-20T09:01:37.572806Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_ab48028d[0m
[2m2025-09-20T09:01:37.572923Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358898305[0m [36mfallback_uses[0m=[35m36[0m [36mlocal_count[0m=[35m36[0m [36mnode_hash[0m=[35m511[0m [36mnonce[0m=[35m1758358898852[0m
1 change detected
[2m2025-09-20T09:01:37.923507Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:37.952996Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1242.6283359527588[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.4700000000003[0m
[2m2025-09-20T09:01:37.954409Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1244.0104484558105[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.52[0m
[2m2025-09-20T09:01:37.955350Z[0m [[31m[1merror    [0m] [1mMetrics collector error       [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:01:38.037284Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:01:39.142435Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:01:40.299651Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:40.300111Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4894.229888916016[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:01:40.300389Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4895.251750946045[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4946.027517318726[0m [36mtotal_value_usd[0m=[35m4016.0800000000004[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:40.300737Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:01:40.433824Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
1 change detected
[2m2025-09-20T09:01:40.556962Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3964.7700000000013[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:40.670282Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:40.720482Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:40.720764Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:41.036490Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3132169246673584[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:41.192655Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4688076972961426[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:41.331243Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_1829c812[0m
[2m2025-09-20T09:01:41.331491Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_f48fc6ba[0m
[2m2025-09-20T09:01:41.331634Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358902064[0m [36mfallback_uses[0m=[35m37[0m [36mlocal_count[0m=[35m37[0m [36mnode_hash[0m=[35m69[0m [36mnonce[0m=[35m1758358902170[0m
[2m2025-09-20T09:01:41.504827Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T09:01:41.566715Z[0m [[33m[1mwarning  [0m] [1mUsing mock portfolio data due to error: [0m [[34m[1mapp.api.v1.endpoints.trading[0m] 
[2m2025-09-20T09:01:41.568440Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:01:41.617881Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m896.604061126709[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.38[0m
[2m2025-09-20T09:01:41.647097Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:41.726218Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1005.0294399261475[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.4700000000003[0m
[2m2025-09-20T09:01:42.459850Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
1 change detected
[2m2025-09-20T09:01:42.557632Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m7.440s[0m [36mrequest_id[0m=[35meaa3ff5d[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T09:01:42.856367Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20126867294311523[0m [36mstatement[0m=[35mSELECT exchange_balances.id, exchange_balances.account_id, exchange_balances.symbol, exchange_balances.asset_type, exchange_balances.total_balance, exchange_balances.available_balance, exchange_balanc...[0m
[2m2025-09-20T09:01:43.015559Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:43.152627Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2918968200683594[0m [36mstatement[0m=[35mSELECT exchange_accounts.id AS exchange_accounts_id, exchange_accounts.user_id AS exchange_accounts_user_id, exchange_accounts.exchange_name AS exchange_accounts_exchange_name, exchange_accounts.excha...[0m
[2m2025-09-20T09:01:43.155873Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3964.7700000000013[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     ('127.0.0.1', 45222) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
[2m2025-09-20T09:01:43.508948Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m861e39e1[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T09:01:43.526319Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:43.536959Z[0m [[32m[1minfo     [0m] [1mRequest started               [0m [[34m[1mapp.middleware.logging[0m] [36mclient[0m=[35m127.0.0.1[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mquery[0m=[35mNone[0m [36mrequest_id[0m=[35m639693be[0m [36muser_agent[0m=[35mMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Sa[0m
[2m2025-09-20T09:01:43.541766Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
INFO:     ('127.0.0.1', 45246) - "WebSocket /api/v1/ai-consensus/ws" [accepted]
INFO:     connection open
[2m2025-09-20T09:01:43.674049Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:01:43.766017Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m7.466s[0m [36mrequest_id[0m=[35mbd705aac[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T09:01:43.781156Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35mcfba1d5a-88c8-425e-9acb-94ec278dc35e[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:43.791878Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.283s[0m [36mrequest_id[0m=[35m861e39e1[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:34192 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
INFO:     127.0.0.1:45224 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
[2m2025-09-20T09:01:43.970900Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.29830050468444824[0m [36mstatement[0m=[35mSELECT users.id, users.email, users.hashed_password, users.is_active, users.is_verified, users.role, users.status, users.tenant_id, users.two_factor_enabled, users.two_factor_secret, users.failed_logi...[0m
[2m2025-09-20T09:01:43.973958Z[0m [[32m[1minfo     [0m] [1mNew chat session created      [0m [[34m[1mapp.api.v1.endpoints.unified_chat[0m] [36msession_id[0m=[35me9614d05-abcb-49e6-b815-0ab481a89ca3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:43.975664Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/api/v1/chat/session/new[0m [36mprocess_time[0m=[35m0.439s[0m [36mrequest_id[0m=[35m639693be[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:45226 - "POST /api/v1/chat/session/new HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:01:45.219694Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:45.220468Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4499.029636383057[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:01:45.221013Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4500.147342681885[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4550.7214069366455[0m [36mtotal_value_usd[0m=[35m4015.8500000000004[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:45.221655Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
1 change detected
[2m2025-09-20T09:01:45.495308Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3964.7700000000013[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:46.366501Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:01:46.457624Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m6.025s[0m [36mrequest_id[0m=[35mb1d09393[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:45212 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T09:01:46.493891Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:46.764269Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T09:01:46.814321Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:46.814584Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
INFO:     127.0.0.1:45212 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T09:01:47.031124Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.2150585651397705[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:47.252391Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.43602538108825684[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:47.395763Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_f5721a51[0m
[2m2025-09-20T09:01:47.396011Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_1933eada[0m
[2m2025-09-20T09:01:47.396127Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358908129[0m [36mfallback_uses[0m=[35m38[0m [36mlocal_count[0m=[35m38[0m [36mnode_hash[0m=[35m181[0m [36mnonce[0m=[35m1758358908348[0m
[2m2025-09-20T09:01:47.633244Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:01:48.156876Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1341.9044017791748[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.14[0m
[2m2025-09-20T09:01:48.226731Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m10.934664249420166[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m12[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:48.228008Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m11.536s[0m [36mrequest_id[0m=[35md1e534c4[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:39186 - "GET /api/v1/trading/market-overview HTTP/1.1" 200 OK
[2m2025-09-20T09:01:48.700074Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1885.1933479309082[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.6300000000006[0m
[2m2025-09-20T09:01:48.895336Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:01:51.195604Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:51.196063Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4381.116628646851[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:01:51.196390Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4381.754159927368[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4432.147026062012[0m [36mtotal_value_usd[0m=[35m4015.7700000000004[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:51.196831Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:01:51.606614Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3964.7700000000013[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
1 change detected
[2m2025-09-20T09:01:52.064570Z[0m [[33m[1mwarning  [0m] [1mRedis unavailable for blacklist check, proceeding without[0m [[34m[1mapp.api.v1.endpoints.auth[0m] 
[2m2025-09-20T09:01:52.189947Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
[2m2025-09-20T09:01:52.266341Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:52.282563Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m5.790s[0m [36mrequest_id[0m=[35m1225cb2e[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:45226 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T09:01:52.310248Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:52.310669Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:52.648082Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3301401138305664[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:52.815446Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.4929845333099365[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:01:52.930658Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_a6943a66[0m
[2m2025-09-20T09:01:52.930896Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_66d51037[0m
[2m2025-09-20T09:01:52.931018Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358913664[0m [36mfallback_uses[0m=[35m39[0m [36mlocal_count[0m=[35m39[0m [36mnode_hash[0m=[35m91[0m [36mnonce[0m=[35m1758358913794[0m
1 change detected
[2m2025-09-20T09:01:53.137365Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:53.224951Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m913.158655166626[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.5900000000001[0m
[2m2025-09-20T09:01:53.447374Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m1136.0175609588623[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.7500000000005[0m
1 change detected
[2m2025-09-20T09:01:54.278072Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m22.65906000137329[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m13[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:54.279289Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/market-overview[0m [36mprocess_time[0m=[35m22.902s[0m [36mrequest_id[0m=[35mf62b0049[0m [36mstatus_code[0m=[35m200[0m
[2m2025-09-20T09:01:54.473923Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
1 change detected
[2m2025-09-20T09:01:56.773175Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:01:56.774240Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4461.894989013672[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:01:56.775022Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4464.195728302002[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4508.64839553833[0m [36mtotal_value_usd[0m=[35m4016.3400000000006[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:56.775874Z[0m [[32m[1minfo     [0m] [1mGetting portfolio status for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] 
[2m2025-09-20T09:01:57.074727Z[0m [[32m[1minfo     [0m] [1mStarting P&L calculation      [0m [[34m[1mapp.services.portfolio_risk_core[0m] [36mcurrent_value[0m=[35m3964.7700000000013[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:01:57.642314Z[0m [[31m[1merror    [0m] [1mFailed to estimate total P&L percentage for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mPortfolioRiskServiceExtended[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
Traceback (most recent call last):
  File "/home/kopi/CryptoUniverse-fresh/app/services/portfolio_risk_core.py", line 2053, in estimate_total_pnl_percentage
    async with AsyncSessionLocal() as db:
NameError: name 'AsyncSessionLocal' is not defined
1 change detected
[2m2025-09-20T09:01:57.740560Z[0m [[33m[1mwarning  [0m] [1mSlow request detected         [0m [[34m[1mapp.middleware.logging[0m] [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/api/v1/trading/portfolio[0m [36mprocess_time[0m=[35m5.677s[0m [36mrequest_id[0m=[35m0c559e8e[0m [36mstatus_code[0m=[35m200[0m
INFO:     127.0.0.1:39186 - "GET /api/v1/trading/portfolio HTTP/1.1" 200 OK
[2m2025-09-20T09:02:01.800084Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:02:01.800488Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:02:01.800725Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:02:01.800937Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T09:02:07.918512Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:02:08.114607Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:02:08.114850Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:02:08.382095Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.26586270332336426[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
1 change detected
[2m2025-09-20T09:02:08.525928Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.40935730934143066[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:02:08.611318Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_53f97250[0m
[2m2025-09-20T09:02:08.611565Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_91fda596[0m
[2m2025-09-20T09:02:08.611666Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758358929344[0m [36mfallback_uses[0m=[35m40[0m [36mlocal_count[0m=[35m40[0m [36mnode_hash[0m=[35m717[0m [36mnonce[0m=[35m1758358930101[0m
[2m2025-09-20T09:02:08.829029Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:02:09.064415Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m949.148416519165[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2262.27[0m
[2m2025-09-20T09:02:09.100582Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m985.3799343109131[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1753.69[0m
1 change detected
[2m2025-09-20T09:02:10.141023Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
1 change detected
[2m2025-09-20T09:02:12.594144Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:02:12.594741Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4479.533433914185[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:02:12.595100Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4480.184555053711[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m4676.578998565674[0m [36mtotal_value_usd[0m=[35m4015.96[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:02:12.596503Z[0m [[33m[1mwarning  [0m] [1mBalance sync failed for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:45202 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:02:41.505960Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
INFO:     127.0.0.1:45208 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
1 change detected
[2m2025-09-20T09:03:07.422203Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:03:07.423161Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
INFO:     127.0.0.1:43458 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:03:32.181702Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:03:32.636676Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
[2m2025-09-20T09:03:34.921257Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:03:35.199274Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:03:35.201076Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4613.045454025269[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:03:36.744597Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:03:36.988763Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
[2m2025-09-20T09:03:38.898936Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:03:39.195438Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:03:39.197255Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3995.6085681915283[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:03:40.539259Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T09:03:40.912719Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:03:41.506562Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
[2m2025-09-20T09:03:43.408360Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:03:43.711495Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:03:43.712602Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4514.591217041016[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:03:45.100253Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:03:45.377414Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
INFO:     127.0.0.1:43468 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
[2m2025-09-20T09:03:47.552621Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
1 change detected
[2m2025-09-20T09:03:47.853423Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:03:47.854945Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4141.854047775269[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:03:49.264010Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T09:03:49.577574Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
1 change detected
1 change detected
1 change detected
[2m2025-09-20T09:03:51.956066Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:03:52.210629Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:03:52.212216Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4356.746435165405[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
1 change detected
[2m2025-09-20T09:03:53.564233Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
1 change detected
[2m2025-09-20T09:03:53.984274Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:03:55.943232Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:03:56.251634Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:03:56.253103Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4040.3361320495605[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:03:56.253675Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
1 change detected
[2m2025-09-20T09:04:02.566630Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:04:02.566859Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:04:02.566981Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:04:02.567079Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
1 change detected
1 change detected
INFO:     127.0.0.1:34332 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
[2m2025-09-20T09:04:41.508791Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
1 change detected
1 change detected
INFO:     127.0.0.1:34338 - "GET /api/v1/monitoring/alerts HTTP/1.1" 200 OK
1 change detected
1 change detected
1 change detected
2 changes detected
1 change detected
2 changes detected
569 changes detected
1 change detected
851 changes detected
1 change detected
[2m2025-09-20T09:05:07.424141Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:05:07.425252Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
452 changes detected
117 changes detected
WARNING:  WatchFiles detected changes in 'app/services/paper_trading_engine.py', 'app/services/master_controller.py', 'app/api/v1/endpoints/auth.py', 'app/services/unified_strategy_service.py', 'app/api/v1/endpoints/trading.py', 'app/core/database.py'. Reloading...
INFO:     Shutting down
[2m2025-09-20T09:05:07.973356Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
[2m2025-09-20T09:05:07.973920Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
[2m2025-09-20T09:05:07.974378Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
[2m2025-09-20T09:05:07.974753Z[0m [[32m[1minfo     [0m] [1mAI consensus WebSocket disconnected[0m [[34m[1mapp.api.v1.endpoints.ai_consensus[0m] 
INFO:     connection closed
INFO:     connection closed
INFO:     connection closed
INFO:     connection closed
INFO:     Waiting for connections to close. (CTRL+C to force quit)
[2m2025-09-20T09:05:41.514241Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:06:03.187230Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:06:03.187573Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:06:03.187759Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:06:03.187876Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:06:41.516132Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:06:58.563391Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:06:59.031961Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:07:01.944860Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:07:02.100164Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:07:02.101811Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5847.153663635254[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:07:03.570187Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:07:03.941388Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:07:06.455950Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:07:06.607021Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:07:06.608277Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4506.110191345215[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:07:07.471069Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:07:07.471860Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:07:08.581292Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:07:08.932723Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:07:11.313077Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:07:11.689308Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:07:11.690429Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5081.686735153198[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:07:13.243164Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:07:13.566957Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:07:15.283336Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:07:15.558727Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:07:15.559937Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3869.075298309326[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:07:17.280166Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:07:17.544559Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:07:19.958937Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:07:20.209922Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:07:20.211091Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4650.645971298218[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:07:21.523184Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:07:21.885431Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:07:23.856303Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:07:24.040930Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:07:24.042727Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m3831.188201904297[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:07:24.043356Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T09:07:24.044844Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:07:24.045133Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 14 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T09:07:24.045774Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T09:07:41.519103Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:08:03.696830Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:08:03.697080Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:08:03.697205Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:08:03.697297Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:08:41.521635Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:09:07.473976Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:09:07.475104Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:09:41.523088Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:10:04.317905Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:10:04.318132Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:10:04.318248Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:10:04.318364Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:10:26.361467Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m9[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:10:27.098792Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:10:29.774210Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:10:29.956840Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:10:29.958005Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5910.939693450928[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:10:31.995742Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:10:32.266255Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:10:34.402804Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:10:34.679893Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:10:34.681419Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4723.004341125488[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:10:36.706012Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:10:37.085763Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:10:39.556056Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:10:39.709707Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:10:39.710574Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5028.584957122803[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:10:41.529695Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:10:41.719465Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:10:41.973051Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:10:43.951373Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:10:44.118756Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:10:44.119842Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4408.87975692749[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:10:45.953836Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:10:46.205095Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:10:49.610783Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:10:49.768328Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:10:49.769616Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5649.324655532837[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:10:51.756490Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:10:52.087934Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:10:54.594306Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:10:54.795004Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:10:54.796318Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5026.002883911133[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:10:54.796867Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T09:11:07.478033Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:11:07.479123Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:11:38.058877Z[0m [[31m[1merror    [0m] [1mMetrics collector error       [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:11:41.531299Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:12:04.958104Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:12:04.958320Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:12:04.958416Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:12:04.958501Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:12:13.500674Z[0m [[32m[1minfo     [0m] [1mStarting enterprise portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:12:13.552161Z[0m [[32m[1minfo     [0m] [1mFound 3 active exchange accounts for portfolio aggregation[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchange_count[0m=[35m3[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:12:13.552495Z[0m [[32m[1minfo     [0m] [1müöÄ Starting parallel exchange balance fetching[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mexchanges[0m=[35m['binance', 'kucoin', 'kraken'][0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:12:13.756386Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.20148205757141113[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:12:13.923897Z[0m [[33m[1mwarning  [0m] [1mSlow database query           [0m [[34m[1mapp.core.database[0m] [36mduration[0m=[35m0.3682212829589844[0m [36mstatement[0m=[35mSELECT exchange_accounts.id, exchange_accounts.user_id, exchange_accounts.exchange_name, exchange_accounts.exchange_type, exchange_accounts.account_type, exchange_accounts.account_name, exchange_accou...[0m
[2m2025-09-20T09:12:14.030759Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_87545917[0m
[2m2025-09-20T09:12:14.031107Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_a46d5f6d[0m
[2m2025-09-20T09:12:14.031362Z[0m [[32m[1minfo     [0m] [1mDistributed Kraken nonce manager initialized[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mnode_id[0m=[35mDESKTOP-1E4LIG6_8b6c3d22[0m
[2m2025-09-20T09:12:14.346287Z[0m [[32m[1minfo     [0m] [1mKraken server time synced     [0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36moffset[0m=[35m0.9687080383300781[0m
[2m2025-09-20T09:12:14.347397Z[0m [[32m[1minfo     [0m] [1mEnterprise fallback nonce generated[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mbase_time_ms[0m=[35m1758359535316[0m [36mfallback_uses[0m=[35m41[0m [36mlocal_count[0m=[35m41[0m [36mnode_hash[0m=[35m885[0m [36mnonce[0m=[35m1758359536242[0m
[2m2025-09-20T09:12:14.384514Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched binance balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m28[0m [36mduration_ms[0m=[35m831.6366672515869[0m [36mexchange[0m=[35mbinance[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m2265.8300000000004[0m
[2m2025-09-20T09:12:14.691795Z[0m [[33m[1mwarning  [0m] [1mAttempt 1 failed, retrying in 1.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:12:14.933741Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kucoin balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m10[0m [36mduration_ms[0m=[35m1380.7084560394287[0m [36mexchange[0m=[35mkucoin[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m1754.48[0m
[2m2025-09-20T09:12:16.026665Z[0m [[33m[1mwarning  [0m] [1mAttempt 2 failed, retrying in 2.0s: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:12:18.530712Z[0m [[31m[1merror    [0m] [1mFailed to fetch Kraken balances: kraken API Error: ['EAPI:Invalid nonce'][0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] 
[2m2025-09-20T09:12:18.531048Z[0m [[32m[1minfo     [0m] [1m‚úÖ Successfully fetched kraken balances[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36masset_count[0m=[35m0[0m [36mduration_ms[0m=[35m4978.047609329224[0m [36mexchange[0m=[35mkraken[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [36mvalue_usd[0m=[35m0[0m
[2m2025-09-20T09:12:18.531392Z[0m [[32m[1minfo     [0m] [1m‚úÖ Portfolio aggregation completed[0m [[34m[1mapp.api.v1.endpoints.exchanges[0m] [36mfailed_exchanges[0m=[35m0[0m [36mparallel_fetch_duration_ms[0m=[35m4978.879690170288[0m [36msuccessful_exchanges[0m=[35m3[0m [36mtotal_assets[0m=[35m38[0m [36mtotal_duration_ms[0m=[35m5030.72190284729[0m [36mtotal_value_usd[0m=[35m4020.3100000000004[0m [36muser_id[0m=[35m7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m
[2m2025-09-20T09:12:18.532665Z[0m [[33m[1mwarning  [0m] [1mBalance sync failed for user 7a1ee8cd-bfc9-4e4e-85b2-69c8e91054af[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:12:41.534176Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:13:07.480230Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:13:07.481530Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:13:41.535842Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:13:56.537659Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:13:57.257187Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:14:00.229095Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:14:00.519760Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:14:00.520980Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5723.223447799683[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m1[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:14:02.457559Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m7[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:14:03.034600Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:14:05.062143Z[0m [[33m[1mwarning  [0m] [1mRedis ping failed             [0m [[34m[1mapp.core.redis[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:14:05.062537Z[0m [[31m[1merror    [0m] [1mRedis circuit breaker OPENED after 15 failures[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T09:14:05.063017Z[0m [[32m[1minfo     [0m] [1mRedis client created successfully[0m [[34m[1mapp.core.redis[0m] 
[2m2025-09-20T09:14:05.262580Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:14:05.401514Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:14:05.401759Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:14:05.401875Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:14:05.401969Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:14:05.463692Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:14:05.465219Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4943.902015686035[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m2[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:14:07.972660Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:14:08.262978Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:14:10.725605Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:14:10.936440Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:14:10.937486Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5471.410751342773[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m3[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:14:13.697964Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:14:14.117331Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:14:16.605834Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:14:16.767854Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:14:16.768747Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5830.617189407349[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m4[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:14:18.949935Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:14:19.384406Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:14:21.620054Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:14:21.784437Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:14:21.785942Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m5016.757965087891[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m5[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:14:24.026813Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m8[0m [36mperpetual_contracts[0m=[35m581[0m
[2m2025-09-20T09:14:24.300262Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for binance[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m0[0m [36munderlying_assets[0m=[35m0[0m [36mvolume_24h[0m=[35m0[0m
[2m2025-09-20T09:14:26.591118Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real futures discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mfunding_rates[0m=[35m0[0m [36mperpetual_contracts[0m=[35m500[0m
[2m2025-09-20T09:14:26.751364Z[0m [[32m[1minfo     [0m] [1m‚úÖ Real options discovery completed for bybit[0m [[34m[1mMarketAnalysisService[0m] [36mtotal_contracts[0m=[35m500[0m [36munderlying_assets[0m=[35m1[0m [36mvolume_24h[0m=[35m50000000[0m
[2m2025-09-20T09:14:26.752680Z[0m [[32m[1minfo     [0m] [1mMarket analysis request completed[0m [[34m[1mMarketAnalysisService[0m] [36mresponse_time[0m=[35m4966.194629669189[0m [36msuccess[0m=[35mTrue[0m [36mtotal_requests[0m=[35m6[0m [36muser_id[0m=[35msystem[0m
[2m2025-09-20T09:14:26.753258Z[0m [[32m[1minfo     [0m] [1mDiscovered 0 active trading symbols[0m [[34m[1mBackgroundServiceManager[0m] 
[2m2025-09-20T09:14:41.536944Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:15:07.484322Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:15:07.486488Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:15:41.537888Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:16:05.880410Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coingecko[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:16:05.880698Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from alpha_vantage[0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:16:05.880862Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from finnhub  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:16:05.880989Z[0m [[33m[1mwarning  [0m] [1mFailed to fetch from coincap  [0m [[34m[1mapp.services.market_data_feeds[0m] [36merror[0m=[35m'CircuitBreaker' object has no attribute 'get'[0m
[2m2025-09-20T09:16:41.539142Z[0m [[33m[1mwarning  [0m] [1mFailed to check autonomous users[0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
[2m2025-09-20T09:17:07.488670Z[0m [[33m[1mwarning  [0m] [1m‚ö†Ô∏è System health alerts       [0m [[34m[1mBackgroundServiceManager[0m] [36malerts[0m=[35m['Redis connection failed: Error 111 connecting to localhost:6379. 111.'][0m
[2m2025-09-20T09:17:07.490214Z[0m [[31m[1merror    [0m] [1mHealth monitor error          [0m [[34m[1mBackgroundServiceManager[0m] [36merror[0m=[35mError 111 connecting to localhost:6379. 111.[0m
